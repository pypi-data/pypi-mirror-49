
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Pythonic issues &#8212; simuPOP  documentation</title>
    <link rel="stylesheet" href="_static/simuPOP.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Loading simuPOP modules" href="userGuide_ch3_sec2.html" />
    <link rel="prev" title="Loading and running simuPOP" href="userGuide_ch3.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="pythonic-issues">
<h1>Pythonic issues<a class="headerlink" href="#pythonic-issues" title="Permalink to this headline">¶</a></h1>
<div class="section" id="from-simupop-import-v-s-import-simupop">
<h2><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">simuPOP</span> <span class="pre">import</span></code> * v.s. <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">simuPOP</span></code><a class="headerlink" href="#from-simupop-import-v-s-import-simupop" title="Permalink to this headline">¶</a></h2>
<p>Generally speaking, it is recommended to use <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">simuPOP</span></code> rather than
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">simuPOP</span> <span class="pre">import</span> <span class="pre">*</span></code> to import a simuPOP module. That is to say, instead of
using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">simuPOP</span> <span class="k">import</span> <span class="o">*</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">loci</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="n">simu</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">RandomMating</span><span class="p">())</span>
</pre></div>
</div>
<p>it is recommended that you use simuPOP like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">simuPOP</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">simuPOP</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">loci</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="n">simu</span> <span class="o">=</span> <span class="n">simuPOP</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">simuPOP</span><span class="o">.</span><span class="n">RandomMating</span><span class="p">())</span>
</pre></div>
</div>
<p>The major problem with <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">simuPOP</span> <span class="pre">import</span> <span class="pre">*</span></code> is that it imports all simuPOP
symbols to the global namespace and increases the likelihood of name clashes.
For example, if you import a module <code class="docutils literal notranslate"><span class="pre">myModule</span></code> after simuPOP, which happens to
have a variable named <code class="docutils literal notranslate"><span class="pre">MALE</span></code>, the following code might lead to a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>
indicating your input for parameter sex is wrong.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">simuPOP</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">myModule</span> <span class="k">import</span> <span class="o">*</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">loci</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="n">initSex</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="p">[</span><span class="n">MALE</span><span class="p">,</span> <span class="n">FEMALE</span><span class="p">])</span>
</pre></div>
</div>
<p>It can be even worse if the definition of <code class="docutils literal notranslate"><span class="pre">MALE</span></code> is changed to a different
value of the same type (e.g. to <code class="docutils literal notranslate"><span class="pre">FEMALE</span></code>) and your simulation might produce
erroranous result without a hint.</p>
<p>For the sake of brevity, all examples in this user’s guide use <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">simuPOP</span>
<span class="pre">as</span> <span class="pre">sim</span></code> as an alternative form of the <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">simuPOP</span></code> style. This saves some
keystrokes by referring simuPOP functions as <code class="docutils literal notranslate"><span class="pre">sim.Population()</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">simuPOP.Population()</span></code>. Note that simuPOP has a number of submodules, which
are not imported by default. The recommended syntax to load these modules is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># import and use submodule simuPOP.utils</span>
<span class="kn">from</span> <span class="nn">simuPOP</span> <span class="k">import</span> <span class="n">utils</span>
<span class="n">utils</span><span class="o">.</span><span class="n">simulateBackwardTrajectory</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">endGen</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">endFreq</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="references-and-the-clone-member-function">
<h2>References and the <code class="docutils literal notranslate"><span class="pre">clone()</span></code>member function<a class="headerlink" href="#references-and-the-clone-member-function" title="Permalink to this headline">¶</a></h2>
<p>Assignment in Python only creates a new reference to an existing object. For
example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">()</span>
<span class="n">pop1</span> <span class="o">=</span> <span class="n">pop</span>
</pre></div>
</div>
<p>creates a reference <code class="docutils literal notranslate"><span class="pre">pop1</span></code> to population <code class="docutils literal notranslate"><span class="pre">pop</span></code>. Modifying <code class="docutils literal notranslate"><span class="pre">pop1</span></code> will
modify <code class="docutils literal notranslate"><span class="pre">pop</span></code> as well and the removal of <code class="docutils literal notranslate"><span class="pre">pop</span></code> will invalidate <code class="docutils literal notranslate"><span class="pre">pop1</span></code>. For
example, a reference to the first Population in a simulator is returned from
function <code class="docutils literal notranslate"><span class="pre">func()</span></code> in Example <a class="reference internal" href="#lst-reference-to-population"><span class="std std-ref">lst_Reference_to_Population</span></a>. The subsequent use of this <code class="docutils literal notranslate"><span class="pre">pop</span></code> object may
crash simuPOP because the simulator <code class="docutils literal notranslate"><span class="pre">simu</span></code> is destroyed, along with all its
internal populations, after <code class="docutils literal notranslate"><span class="pre">func()</span></code> is finished, leaving <code class="docutils literal notranslate"><span class="pre">pop</span></code> referring to
an invalid object.</p>
<p id="lst-reference-to-population"><strong>Example</strong>: <em>Reference to a population in a
simulator</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">simu</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">Population</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">RandomMating</span><span class="p">(),</span> <span class="n">rep</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># return a reference to the first Population in the simulator</span>
    <span class="k">return</span> <span class="n">simu</span><span class="o">.</span><span class="n">population</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">pop</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
<span class="c1"># simuPOP will crash because pop refers to an invalid Population.</span>
<span class="n">pop</span><span class="o">.</span><span class="n">popSize</span><span class="p">()</span>
</pre></div>
</div>
<p>If you would like to have an independent copy of a population, you can use the
<code class="docutils literal notranslate"><span class="pre">clone()</span></code> member function. Example <a class="reference internal" href="#lst-reference-to-population"><span class="std std-ref">lst_Reference_to_Population</span></a> would behave properly if the <code class="docutils literal notranslate"><span class="pre">return</span></code> statement
is replaced by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">simu</span><span class="o">.</span><span class="n">population</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</pre></div>
</div>
<p>although in this specific case, extracting the first population from the
simulator using the <code class="docutils literal notranslate"><span class="pre">extract</span></code> function</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">simu</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>would be more efficient.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">clone()</span></code> function exists for all simuPOP classes (objects) such as
<em>simulator</em>, <em>mating schemes</em> and <em>operators</em>. simuPOP also supports the
standard Python shallow and deep copy operations so you can also make a cloned
copy of <code class="docutils literal notranslate"><span class="pre">pop</span></code> using the <code class="docutils literal notranslate"><span class="pre">deepcopy</span></code> function defined in the Python <code class="docutils literal notranslate"><span class="pre">copy</span></code>
module</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="n">pop1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="zero-based-indexes-absolute-and-relative-indexes">
<h2>Zero-based indexes, absolute and relative indexes<a class="headerlink" href="#zero-based-indexes-absolute-and-relative-indexes" title="Permalink to this headline">¶</a></h2>
<p><strong>All arrays in simuPOP start at index 0</strong>. This conforms to Python and C++
indexes. To avoid confusion, I will refer the first locus as locus zero, the
second locus as locus one; the first individual in a population as Individual
zero, and so on.</p>
<p id="index-0">Another two important concepts are the <em>absolute index</em> and <em>relative index</em> of
a locus. The former index ignores chromosome structure. For example, if there
are 5 and 7 loci on the first two chromosomes, the absolute indexes of the two
chromosomes are (0, 1, 2, 3, 4), (5, 6, 7, 8, 9, 10, 11) and the relative
indexes are (0, 1, 2, 3, 4), (0, 1, 2, 3, 4, 5, 6). Absolute indexes are more
frequently used because they avoid the trouble of having to use two numbers
(chrom, index) to refer to a locus. Two functions <code class="docutils literal notranslate"><span class="pre">chromLocusPair(idx)</span></code> and
<code class="docutils literal notranslate"><span class="pre">absLocusIndex(chrom,index)</span></code> are provided to convert between these two kinds
of indexes. An individual can also be referred by its <em>absolute index</em> and
<em>relative index</em> where <em>relative index</em> is the index in its subpopulation.
Related member functions are <code class="docutils literal notranslate"><span class="pre">subPopIndPair(idx)</span></code> and <code class="docutils literal notranslate"><span class="pre">absIndIndex(idx,</span>
<span class="pre">subPop)</span></code>. Example <a class="reference internal" href="#absindex"><span class="std std-ref">absIndex</span></a> demonstrates the use of these
functions.</p>
<p id="absindex"><strong>Example</strong>: <em>Conversion between absolute and relative indexes</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">simuPOP</span> <span class="k">as</span> <span class="nn">sim</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pop</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">loci</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">chromLocusPair</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<span class="go">(1, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">absLocusIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">absIndIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">subPopIndPair</span><span class="p">(</span><span class="mi">25</span><span class="p">))</span>
<span class="go">(1, 15)</span>

<span class="go">now exiting runScriptInteractively...</span>
</pre></div>
</div>
<p><a class="reference external" href="absIndex.py">Download absIndex.py</a></p>
</div>
<div class="section" id="ranges-and-iterators">
<h2>Ranges and iterators<a class="headerlink" href="#ranges-and-iterators" title="Permalink to this headline">¶</a></h2>
<p>Ranges in simuPOP also conform to Python ranges. That is to say, a range has the
form of <code class="docutils literal notranslate"><span class="pre">[a,b)</span></code>where <code class="docutils literal notranslate"><span class="pre">a</span></code>belongs to the range, and <code class="docutils literal notranslate"><span class="pre">b</span></code>does not. For
example, <code class="docutils literal notranslate"><span class="pre">pop.chromBegin(1)</span></code>refers to the index of the first locus on
chromosome 1 (actually exists), and <code class="docutils literal notranslate"><span class="pre">pop.chromEnd(1)</span></code>refers to the index of
the last locus on chromosome 1 <strong>plus 1</strong>, which might or might not be a valid
index.</p>
<p>A number of simuPOP functions return Python iterators that can be used to
iterate through an internal array of objects. For example,
<code class="docutils literal notranslate"><span class="pre">Population.Individuals([subPop])</span></code> returns an iterator iterates through all
individuals, or all individuals in a (virtual) subpoulation.
<a class="reference internal" href="refManual_ch2_sec1.html#Simulator.populations" title="Simulator.populations"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulator.populations</span></code></a>() can be used to iterate through all populations
in a simulator. Example <a class="reference internal" href="#iterator"><span class="std std-ref">iterator</span></a> demonstrates the use of
ranges and iterators in simuPOP.</p>
<p id="iterator"><strong>Example</strong>: <em>Ranges and iterators</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">simuPOP</span> <span class="k">as</span> <span class="nn">sim</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pop</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loci</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">initGenotype</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">pop</span><span class="o">.</span><span class="n">individuals</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">chromBegin</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">pop</span><span class="o">.</span><span class="n">chromEnd</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">allele</span><span class="p">(</span><span class="n">loc</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">0</span>
<span class="go">2</span>
<span class="go">2</span>
<span class="go">1</span>
<span class="go">1</span>
<span class="go">1</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="go">2</span>
<span class="go">2</span>
<span class="go">1</span>
<span class="go">2</span>

<span class="go">now exiting runScriptInteractively...</span>
</pre></div>
</div>
<p><a class="reference external" href="iterator.py">Download iterator.py</a></p>
</div>
<div class="section" id="empty-all-avail-and-dynamic-values-for-parameters-loci-reps-ancgen-and-subpops">
<h2>Empty, <code class="docutils literal notranslate"><span class="pre">ALL_AVAIL</span></code> and dynamic values for parameters <code class="docutils literal notranslate"><span class="pre">loci</span></code>, <code class="docutils literal notranslate"><span class="pre">reps</span></code>, <code class="docutils literal notranslate"><span class="pre">ancGen</span></code> and <code class="docutils literal notranslate"><span class="pre">subPops</span></code><a class="headerlink" href="#empty-all-avail-and-dynamic-values-for-parameters-loci-reps-ancgen-and-subpops" title="Permalink to this headline">¶</a></h2>
<p>Parameters <code class="docutils literal notranslate"><span class="pre">loci</span></code>, <code class="docutils literal notranslate"><span class="pre">reps</span></code> and <code class="docutils literal notranslate"><span class="pre">subPops</span></code> are widely used in simuPOP to
specify which loci, replicates, ancestral generations, or (virtual) subpulations
a function or operator is applied to. These parameter accepts a list of indexes
such as <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code>, names such as <code class="docutils literal notranslate"><span class="pre">['a',</span> <span class="pre">'b']</span></code>, and take single form inputs
(e.g. <code class="docutils literal notranslate"><span class="pre">loci=1</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">loci=[1]</span></code>). For example,</p>
<ul class="simple">
<li><a class="reference internal" href="refManual_ch3_sec5.html#Recombinator" title="Recombinator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Recombinator</span></code></a>(<code class="docutils literal notranslate"><span class="pre">loci=[]</span></code>) recombine at no locus, and</li>
<li><a class="reference internal" href="refManual_ch3_sec5.html#Recombinator" title="Recombinator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Recombinator</span></code></a>(<code class="docutils literal notranslate"><span class="pre">loci=1</span></code>) recombine at locus 1</li>
<li><a class="reference internal" href="refManual_ch3_sec5.html#Recombinator" title="Recombinator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Recombinator</span></code></a>(<code class="docutils literal notranslate"><span class="pre">loci=[1,2,4]</span></code>) recombine at loci 1, 2, and 4</li>
<li><a class="reference internal" href="refManual_ch3_sec5.html#Recombinator" title="Recombinator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Recombinator</span></code></a>(<code class="docutils literal notranslate"><span class="pre">loci=[('1',</span> <span class="pre">20),</span> <span class="pre">('1',</span> <span class="pre">25)]</span></code>) recombine at loci
with position <code class="docutils literal notranslate"><span class="pre">20</span></code> and<code class="docutils literal notranslate"><span class="pre">25</span></code> on chromosome <code class="docutils literal notranslate"><span class="pre">1</span></code>. This usage is only
available for parameter <code class="docutils literal notranslate"><span class="pre">loci</span></code>.</li>
<li><a class="reference internal" href="refManual_ch3_sec5.html#Recombinator" title="Recombinator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Recombinator</span></code></a>(<code class="docutils literal notranslate"><span class="pre">loci=['a2',</span> <span class="pre">'a4']</span></code>) recombine at loci <code class="docutils literal notranslate"><span class="pre">'a2'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'a4'</span></code>.</li>
</ul>
<p>The last method is easier to understand in some cases. Moreover, when you use
loci names instead of indexes in an operator, this operator can be applied to
populations with loci at different locations. For example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MaSelector</span><span class="p">(</span><span class="n">loci</span><span class="o">=</span><span class="s1">&#39;a2&#39;</span><span class="p">,</span> <span class="n">fitness</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.01</span><span class="p">,</span><span class="mf">1.02</span><span class="p">])</span>
</pre></div>
</div>
<p>will be applied to locus <code class="docutils literal notranslate"><span class="pre">a2</span></code> regardless the actual location of this locus in
the population to which this operator is applied.</p>
<p>However, in the majority of the cases, these parameters take a default value
<code class="docutils literal notranslate"><span class="pre">ALL_AVAIL</span></code> which applies the function or operator to all available loci,
replicates or subpopulations. That is to say, <a class="reference internal" href="refManual_ch3_sec5.html#Recombinator" title="Recombinator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Recombinator</span></code></a>() or
<a class="reference internal" href="refManual_ch3_sec5.html#Recombinator" title="Recombinator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Recombinator</span></code></a>(<code class="docutils literal notranslate"><span class="pre">loci=ALL_AVAIL</span></code>) will recombine at all applicable
loci, which will vary from population to population. Value <code class="docutils literal notranslate"><span class="pre">UNSPECIFIED</span></code> is
sometimes used as default parameter of these parameters, indicating that no
value has been specified. Similarly, <code class="docutils literal notranslate"><span class="pre">subPops=[0,</span> <span class="pre">'Male']</span></code> can be used to
refer a virtual subpopulation with name <code class="docutils literal notranslate"><span class="pre">'Male'</span></code>, regardless its virtual
subpopulation index.</p>
<p>Besides <code class="docutils literal notranslate"><span class="pre">subPops=ALL_AVAIL</span></code>, which means <code class="docutils literal notranslate"><span class="pre">subPops=[0,1,2,3]</span></code> for a
population with 4 subpopulations, <code class="docutils literal notranslate"><span class="pre">ALL_AVAIL</span></code> could also be used as
<code class="docutils literal notranslate"><span class="pre">subPops=[(ALL_AVAIL,</span> <span class="pre">1)]</span></code> to specify a specific virtual subpopulation for all
subpopulations, or <code class="docutils literal notranslate"><span class="pre">subPops=[(1,</span> <span class="pre">ALL_AVAIL)]</span></code> or even <code class="docutils literal notranslate"><span class="pre">subPops=[(ALL_AVAIL,</span>
<span class="pre">ALL_AVAIL)]</span></code> to specify all virtual subpopulations in specified or all
subpopulations. This becomes handy when you, for example, would like to list all
male individuals in a population, regardless of number of subpopulations.</p>
</div>
<div class="section" id="user-defined-functions-and-class-withargs">
<h2>User-defined functions and class <a class="reference internal" href="refManual_ch2_sec5.html#WithArgs" title="WithArgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">WithArgs</span></code></a> *<a class="headerlink" href="#user-defined-functions-and-class-withargs" title="Permalink to this headline">¶</a></h2>
<p>Some simuPOP objects call user-defined functions to perform customized
operations. For example, a penetrance operator can call a user-defined function
with genotype at specified loci and use its return value to determine the
affection status of an individual.</p>
<p>simuPOP uses parameter names to determine which information should be passed to
such a function. For example, a <a class="reference internal" href="refManual_ch3_sec13.html#PyOperator" title="PyOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">PyOperator</span></code></a> will pass a reference to
each offspring to a function defined with parameter <code class="docutils literal notranslate"><span class="pre">off</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">func(off)</span></code>)
and references to offspring and his/her parents to a function defined with
parameters <code class="docutils literal notranslate"><span class="pre">off</span></code>, <code class="docutils literal notranslate"><span class="pre">dad</span></code>, and <code class="docutils literal notranslate"><span class="pre">mom</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">func(off,</span> <span class="pre">dad,</span> <span class="pre">mom)</span></code>). For
example, Example <a class="reference internal" href="#userfunc"><span class="std std-ref">userFunc</span></a> defines a function <code class="docutils literal notranslate"><span class="pre">func(geno,</span>
<span class="pre">smoking)</span></code> using parameters <code class="docutils literal notranslate"><span class="pre">geno</span></code> and <code class="docutils literal notranslate"><span class="pre">smoking</span></code> so operator
<a class="reference internal" href="refManual_ch3_sec7.html#PyPenetrance" title="PyPenetrance"><code class="xref py py-class docutils literal notranslate"><span class="pre">PyPenetrance</span></code></a> will pass genotype at specified loci and value at
information field <code class="docutils literal notranslate"><span class="pre">smoking</span></code> to this function.</p>
<p id="userfunc"><strong>Example</strong>: <em>Use of user-defined Python function in simuPOP</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">simuPOP</span> <span class="k">as</span> <span class="nn">sim</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pop</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">loci</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">infoFields</span><span class="o">=</span><span class="s1">&#39;smoking&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">initInfo</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">infoFields</span><span class="o">=</span><span class="s1">&#39;smoking&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">initGenotype</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># a penetrance function that depends on smoking</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">geno</span><span class="p">,</span> <span class="n">smoking</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">smoking</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span><span class="n">geno</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">geno</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.4</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span><span class="n">geno</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">geno</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.1</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">pyPenetrance</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">loci</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">numOfAffected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">dvars</span><span class="p">()</span><span class="o">.</span><span class="n">numOfAffected</span><span class="p">)</span>
<span class="go">352</span>
<span class="go">&gt;&gt;&gt;</span>

<span class="go">now exiting runScriptInteractively...</span>
</pre></div>
</div>
<p><a class="reference external" href="userFunc.py">Download userFunc.py</a></p>
<p>However, there are circumstances that you do not know the number or names of
parameters in advance so it is difficult to define such a function. For example,
your function may use an information field with programmed name
‘<code class="docutils literal notranslate"><span class="pre">off</span></code>’<code class="docutils literal notranslate"><span class="pre">+str(numOffspring)</span></code> where <code class="docutils literal notranslate"><span class="pre">numOffspring</span></code> is a parameter. In this
case, you can create a wrapper function object using <a class="reference internal" href="refManual_ch2_sec5.html#WithArgs" title="WithArgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">WithArgs</span></code></a>(<code class="docutils literal notranslate"><span class="pre">func,</span>
<span class="pre">args</span></code>) and list passed arguments in <code class="docutils literal notranslate"><span class="pre">args</span></code> (e.g. <a class="reference internal" href="refManual_ch2_sec5.html#WithArgs" title="WithArgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">WithArgs</span></code></a><code class="docutils literal notranslate"><span class="pre">(func,</span>
<span class="pre">args=['geno',</span> <span class="pre">'off'</span> <span class="pre">+</span> <span class="pre">str(numOffspring)]</span></code>). As long as simuPOP knows which
arguments to pass, your function can be defined in any format you want (e.g. use
*args parameters). Example <a class="reference internal" href="#withargs"><span class="std std-ref">WithArgs</span></a> provides such an example.</p>
<p id="withargs"><strong>Example</strong>: <em>Specify arguments of user-provided function using function WithArgs</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">simuPOP</span> <span class="k">as</span> <span class="nn">sim</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pop</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">loci</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">infoFields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">initInfo</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">infoFields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">initGenotype</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># a penetrance function that depends on unknown information fields</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="mf">0.4</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># function WithArgs tells PyPenetrance that func accepts fields x, y so that</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># it will pass values at fields x and y to func.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">pyPenetrance</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">loci</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">WithArgs</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">pop</span><span class="o">.</span><span class="n">infoFields</span><span class="p">()))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">numOfAffected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">dvars</span><span class="p">()</span><span class="o">.</span><span class="n">numOfAffected</span><span class="p">)</span>
<span class="go">427</span>

<span class="go">now exiting runScriptInteractively...</span>
</pre></div>
</div>
<p><a class="reference external" href="WithArgs.py">Download WithArgs.py</a></p>
</div>
<div class="section" id="exception-handling">
<h2>Exception handling *<a class="headerlink" href="#exception-handling" title="Permalink to this headline">¶</a></h2>
<p>As shown in Examples <a class="reference internal" href="userGuide_ch3_sec2.html#lst-use-of-standard-module"><span class="std std-ref">lst_Use_of_standard_module</span></a> and <a class="reference internal" href="userGuide_ch3_sec2.html#lst-use-of-optimized-module"><span class="std std-ref">lst_Use_of_optimized_module</span></a>, optimized modules raise less exceptions than
standard modules. More specifically, the standard modules check for invalid
inputs frequently and raise exceptions (e.g. out of bound loci indexes). In
constrast, the optimized modules only raise exceptions where proper values could
not be pre-determined (e.g. looking for an individual in a population with an
ID). <strong>Only exceptions that are raised in both types of modules are documented
in the simuPOP reference manual</strong>.</p>
<p>Generally speaking, <strong>you should avoid using exceptions to direct the logic of
your script</strong> (e.g. use a <code class="docutils literal notranslate"><span class="pre">try</span> <span class="pre">...</span> <span class="pre">except</span> <span class="pre">...</span></code> statement around a function to
find a valid input value). Because the optimized modules might not raise these
exceptions, such a script may crash or yield invalid results when an optimized
module is used. If you have to use such a structure, please check the reference
manual and see whether or not an exception will be raised in optimized modules.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">simuPOP</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="userGuide_ch1.html">Front Matter</a></li>
<li class="toctree-l1"><a class="reference internal" href="userGuide_ch2.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="userGuide_ch3.html">Loading and running simuPOP</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Pythonic issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#from-simupop-import-v-s-import-simupop"><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">simuPOP</span> <span class="pre">import</span></code> * v.s. <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">simuPOP</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#references-and-the-clone-member-function">References and the <code class="docutils literal notranslate"><span class="pre">clone()</span></code>member function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zero-based-indexes-absolute-and-relative-indexes">Zero-based indexes, absolute and relative indexes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ranges-and-iterators">Ranges and iterators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#empty-all-avail-and-dynamic-values-for-parameters-loci-reps-ancgen-and-subpops">Empty, <code class="docutils literal notranslate"><span class="pre">ALL_AVAIL</span></code> and dynamic values for parameters <code class="docutils literal notranslate"><span class="pre">loci</span></code>, <code class="docutils literal notranslate"><span class="pre">reps</span></code>, <code class="docutils literal notranslate"><span class="pre">ancGen</span></code> and <code class="docutils literal notranslate"><span class="pre">subPops</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-defined-functions-and-class-withargs">User-defined functions and class <code class="docutils literal notranslate"><span class="pre">WithArgs</span></code> *</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exception-handling">Exception handling *</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="userGuide_ch3_sec2.html">Loading simuPOP modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="userGuide_ch3_sec3.html">Online help system</a></li>
<li class="toctree-l2"><a class="reference internal" href="userGuide_ch3_sec4.html">Debug-related functions and operators *</a></li>
<li class="toctree-l2"><a class="reference internal" href="userGuide_ch3_sec5.html">Random number generator *</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="userGuide_ch4.html">Individuals and Populations</a></li>
<li class="toctree-l1"><a class="reference internal" href="userGuide_ch5.html">simuPOP Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="userGuide_ch6.html">Evolving populations</a></li>
<li class="toctree-l1"><a class="reference internal" href="userGuide_ch7.html">Utility Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="userGuide_ch8.html">A real world example</a></li>
<li class="toctree-l1"><a class="reference internal" href="refManual_ch1.html">Front Matter</a></li>
<li class="toctree-l1"><a class="reference internal" href="refManual_ch2.html">simuPOP Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="refManual_ch3.html">Operator References</a></li>
<li class="toctree-l1"><a class="reference internal" href="refManual_ch4.html">Utility Modules</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="userGuide.html">&lt;no title&gt;</a><ul>
  <li><a href="userGuide_ch3.html">Loading and running simuPOP</a><ul>
      <li>Previous: <a href="userGuide_ch3.html" title="previous chapter">Loading and running simuPOP</a></li>
      <li>Next: <a href="userGuide_ch3_sec2.html" title="next chapter">Loading simuPOP modules</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2004-2019, Bo Peng.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/userGuide_ch3_sec1.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>