{"version":3,"sources":["webpack:///./app/views/settings/project/projectTeams.jsx"],"names":["ProjectTeams","canCreateTeam","organization","_this","props","access","getOrganizationState","getAccess","has","handleRemove","teamSlug","state","loading","_this$props$params","params","orgId","projectId","removeTeamFromProject","api","then","handleRemovedTeam","catch","addErrorMessage","t","setState","prevState","projectTeams","filter","team","slug","handleAddedTeam","concat","handleAdd","_this$props$params2","addTeamToProject","error","handleCreateTeam","e","_this$props","project","stopPropagation","preventDefault","openCreateTeamModal","onClose","data","remountComponent","_this$props$params3","this","_this$props2","hasAccess","includes","confirmRemove","map","p","menuHeader","react__WEBPACK_IMPORTED_MODULE_5___default","a","createElement","StyledTeamsLabel","app_components_tooltip__WEBPACK_IMPORTED_MODULE_16__","disabled","title","tooltipOptions","placement","StyledCreateTeamLink","onClick","app_views_settings_components_settingsPageHeader__WEBPACK_IMPORTED_MODULE_14__","app_views_settings_components_teamSelect__WEBPACK_IMPORTED_MODULE_15__","selectedTeams","onAddTeam","onRemoveTeam","confirmLastTeamRemoveMessage","AsyncView","styled","target","space","Link","css","theme","gray2"],"mappings":"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","file":"ProjectTeams.js","sourcesContent":["import React from 'react';\nimport styled, {css} from 'react-emotion';\n\nimport {getOrganizationState} from 'app/mixins/organizationState';\nimport {openCreateTeamModal} from 'app/actionCreators/modal';\nimport {removeTeamFromProject, addTeamToProject} from 'app/actionCreators/projects';\nimport {addErrorMessage} from 'app/actionCreators/indicator';\nimport {t} from 'app/locale';\nimport AsyncView from 'app/views/asyncView';\nimport Link from 'app/components/link';\nimport SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';\nimport TeamSelect from 'app/views/settings/components/teamSelect';\nimport Tooltip from 'app/components/tooltip';\nimport space from 'app/styles/space';\n\nclass ProjectTeams extends AsyncView {\n  getEndpoints() {\n    const {orgId, projectId} = this.props.params;\n    return [['projectTeams', `/projects/${orgId}/${projectId}/teams/`]];\n  }\n\n  canCreateTeam = () => {\n    const {organization} = this.props;\n    const access = getOrganizationState(organization).getAccess();\n    return (\n      access.has('org:write') && access.has('team:write') && access.has('project:write')\n    );\n  };\n\n  handleRemove = teamSlug => {\n    if (this.state.loading) {\n      return;\n    }\n\n    const {orgId, projectId} = this.props.params;\n\n    removeTeamFromProject(this.api, orgId, projectId, teamSlug)\n      .then(() => this.handleRemovedTeam(teamSlug))\n      .catch(() => {\n        addErrorMessage(t('Could not remove the %s team', teamSlug));\n        this.setState({loading: false});\n      });\n  };\n\n  handleRemovedTeam = teamSlug => {\n    this.setState(prevState => {\n      return {\n        projectTeams: this.state.projectTeams.filter(team => {\n          return team.slug !== teamSlug;\n        }),\n      };\n    });\n  };\n\n  handleAddedTeam = team => {\n    this.setState(prevState => {\n      return {\n        projectTeams: this.state.projectTeams.concat([team]),\n      };\n    });\n  };\n\n  handleAdd = team => {\n    if (this.state.loading) {\n      return;\n    }\n    const {orgId, projectId} = this.props.params;\n\n    addTeamToProject(this.api, orgId, projectId, team).then(\n      () => {\n        this.handleAddedTeam(team);\n      },\n      () => {\n        this.setState({\n          error: true,\n          loading: false,\n        });\n      }\n    );\n  };\n\n  handleCreateTeam = e => {\n    const {project, organization} = this.props;\n\n    if (!this.canCreateTeam()) {\n      return;\n    }\n\n    e.stopPropagation();\n    e.preventDefault();\n\n    openCreateTeamModal({\n      project,\n      organization,\n      onClose: data => {\n        addTeamToProject(this.api, organization.slug, project.slug, data).then(\n          this.remountComponent,\n          this.remountComponent\n        );\n      },\n    });\n  };\n\n  renderBody() {\n    const {params, organization} = this.props;\n\n    const canCreateTeam = this.canCreateTeam();\n    const hasAccess = organization.access.includes('project:write');\n    const confirmRemove = t(\n      'This is the last team with access to this project. Removing it will mean ' +\n        'only owners and managers will be able to access the project pages. Are ' +\n        'you sure you want to remove this team from the project %s?',\n      params.projectId\n    );\n    const projectTeams = this.state.projectTeams.map(p => p.slug);\n\n    const menuHeader = (\n      <StyledTeamsLabel>\n        {t('Teams')}\n        <Tooltip\n          disabled={canCreateTeam}\n          title={t('You must be a project admin to create teams')}\n          tooltipOptions={{placement: 'top'}}\n        >\n          <StyledCreateTeamLink disabled={!canCreateTeam} onClick={this.handleCreateTeam}>\n            {t('Create Team')}\n          </StyledCreateTeamLink>\n        </Tooltip>\n      </StyledTeamsLabel>\n    );\n\n    return (\n      <div>\n        <SettingsPageHeader title={t('%s Teams', params.projectId)} />\n        <TeamSelect\n          organization={organization}\n          selectedTeams={projectTeams}\n          onAddTeam={this.handleAdd}\n          onRemoveTeam={this.handleRemove}\n          menuHeader={menuHeader}\n          confirmLastTeamRemoveMessage={confirmRemove}\n          disabled={!hasAccess}\n        />\n      </div>\n    );\n  }\n}\n\nconst StyledTeamsLabel = styled('div')`\n  font-size: 0.875em;\n  padding: ${space(0.5)};\n  text-transform: uppercase;\n`;\n\nconst StyledCreateTeamLink = styled(Link)`\n  float: right;\n  text-transform: none;\n  ${p =>\n    p.disabled &&\n    css`\n      cursor: not-allowed;\n      color: ${p.theme.gray2};\n      opacity: 0.6;\n    `};\n`;\n\nexport default ProjectTeams;\n"],"sourceRoot":""}