(function(t){function e(e){for(var i,o,s=e[0],c=e[1],l=e[2],d=0,f=[];d<s.length;d++)o=s[d],r[o]&&f.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(f.length)f.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},r={index:0},a=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("df31")},"01bd":function(t,e,n){"use strict";var i=n("b954"),r=n.n(i);r.a},"0372":function(t,e,n){"use strict";var i=n("18e4"),r=n.n(i);r.a},"18e4":function(t,e,n){},"2cdf":function(t,e,n){},"31fa":function(t,e,n){},"3e6b":function(t,e,n){"use strict";var i=n("2cdf"),r=n.n(i);r.a},4230:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i="/admin/api",r={accountsList:i+"/accounts",createAccountID:i+"/account/create_id",addAccount:i+"/accounts/add",addAccountName:i+"/accounts/add",deleteAccount:i+"/accounts/delete",account:i+"/account",goCreateAppUrl:i+"/go_create_app",goGetCode:i+"/go_get_code",stylizes:i+"/stylizes",uploadFile:i+"/upload",createFolder:i+"/create_folder"}},4235:function(t,e,n){"use strict";var i=n("873f"),r=n.n(i);r.a},"500d":function(t,e,n){"use strict";var i=n("e655"),r=n.n(i);r.a},"7a49":function(t,e,n){"use strict";var i=n("c9e3"),r=n.n(i);r.a},"815f":function(t,e,n){},"83d8":function(t,e,n){"use strict";var i=n("31fa"),r=n.n(i);r.a},"873f":function(t,e,n){},"992d":function(t,e,n){"use strict";var i=n("ea30"),r=n.n(i);r.a},ae02:function(t,e,n){"use strict";var i=n("bf26"),r=n.n(i);r.a},b82e:function(t,e,n){"use strict";var i=n("d7b8"),r=n.n(i);r.a},b954:function(t,e,n){},bf26:function(t,e,n){},c9e3:function(t,e,n){},d7b8:function(t,e,n){},dd79:function(t,e,n){"use strict";var i=n("815f"),r=n.n(i);r.a},df31:function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var i=n("a026"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"desktop full",on:{dragover:function(t){t.preventDefault()},drop:function(t){t.preventDefault()}}},[n("settings"),t._l(t.users,function(t){return n("user-icon",{key:t.id,attrs:{user:t}})}),t._l(t.windows,function(t){return n("window",{key:t.id,attrs:{id:t.id,user:t.user,file:t.file,z:t.z,uploads:t.uploads}})}),n("contextmenu",{attrs:{x:t.menu.x,y:t.menu.y,file:t.menu.file,id:t.menu.id},model:{value:t.menu.show,callback:function(e){t.$set(t.menu,"show",e)},expression:"menu.show"}})],2)},a=[],o=(n("7f7f"),n("96cf"),n("3b8d")),s="",c={accounts:s+"/accounts",loadFile:s+"/path"},l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"window",class:{active:t.$store.state.activeID===t.id,dragging:t.dragging,loading:t.loading},style:{"z-index":t.z},attrs:{tabindex:t.z},on:{focus:t.focus,blur:t.blur}},[n("div",{staticClass:"window--head"},[n("div",{staticClass:"name"},[t._v(" "+t._s(t.current.name))]),n("div",{staticClass:"controller",staticStyle:{"margin-right":"10px"}},[n("svg",{staticClass:"icon",class:{disabled:t.loading},attrs:{"aria-hidden":"true"},on:{click:function(e){return t.load(!0)}}},[n("use",{attrs:{"xlink:href":"#py_shuaxin"}})]),n("svg",{staticClass:"icon",class:{disabled:t.loading||t.historyIndex<=0},attrs:{"aria-hidden":"true"},on:{click:function(e){return t.go()}}},[n("use",{attrs:{"xlink:href":"#py_houtui"}})]),n("svg",{staticClass:"icon",class:{disabled:t.loading||t.historyIndex>=t.history.length-1},attrs:{"aria-hidden":"true"},on:{click:function(e){return t.go(1)}}},[n("use",{attrs:{"xlink:href":"#py_qianjin"}})])]),n("div",{staticClass:"controller"},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"},on:{click:t.close}},[n("use",{attrs:{"xlink:href":"#py_guanbi"}})])])]),n("div",{staticClass:"window--path"},[n("el-breadcrumb",{staticClass:"path",attrs:{separator:"/"}},[n("el-breadcrumb-item"),t._l(t.path,function(e,i){return n("el-breadcrumb-item",{key:i},[n("a",{on:{click:function(e){t.go(-(t.path.length-i-1))}}},[t._v(t._s(e))])])})],2),!1===t.loading&&t.showFolder?n("div",{staticClass:"controller"},[n("el-dropdown",{attrs:{size:"mini",trigger:"click"},on:{command:t.create}},[n("span",{staticClass:"el-dropdown-link"},[t._v("\n                创建"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"folder"}},[t._v("文件夹")]),n("el-dropdown-item",{attrs:{divided:""}}),n("el-dropdown-item",{attrs:{command:"text"}},[t._v("文本文件")])],1)],1),n("div",{on:{click:function(e){return t.upload("file")}}},[n("svg",{staticClass:"icon",class:{disabled:t.loading},attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan1"}})]),t._v("\n                文件\n            ")]),n("div",{on:{click:function(e){return t.upload("folder")}}},[n("svg",{staticClass:"icon",class:{disabled:t.loading},attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan1"}})]),t._v("\n                文件夹\n            ")])],1):t._e()],1),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.dragging,expression:"!dragging"}],staticClass:"window--body",class:{loading:t.loading}},[t.loading?n("window-loading"):t._e(),t.error?n("window-error",{attrs:{error:t.error}}):t._e(),[t.showFolder?[n("window-folder",{ref:"content",attrs:{user:t.user,id:t.id,file:t.current},on:{open:t.open,loadFinish:t.loadFinish,loadError:t.loadError}})]:t.showEditor?[n("window-editor",{ref:"content",attrs:{user:t.user,file:t.current},on:{loadFinish:t.loadFinish,loadError:t.loadError}})]:t.showViewer?[n("window-viewer",{ref:"content",attrs:{user:t.user,file:t.current},on:{loadFinish:t.loadFinish,loadError:t.loadError}})]:t.showPlayer?[n("window-player",{ref:"content",attrs:{user:t.user,file:t.current},on:{loadFinish:t.loadFinish,loadError:t.loadError}})]:t._e()]],2)])},u=[],d=(n("7514"),n("c5f6"),n("a481"),n("d225")),f=n("b0b4"),h=(n("ac4d"),n("8a81"),n("0d6d"),n("2ef0")),p=Object.freeze({Normal:Symbol("normal"),Image:Symbol("image"),Audio:Symbol("audio"),Video:Symbol("video"),Text:Symbol("text"),Code:Symbol("code"),Word:Symbol("word"),Excel:Symbol("excel"),PPT:Symbol("ppt"),Zip:Symbol("zip"),Folder:Symbol("folder"),PDF:Symbol("pdf")}),m=Object.freeze({Normal:Symbol("normal"),Uploading:Symbol("uploading"),Waiting:Symbol("waiting"),Deleting:Symbol("deleting"),UploadFail:Symbol("uploadFail")}),v=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],g=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],w=["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"],y=["application/zip","application/x-7z-compressed","application/x-rar-compressed","application/x-tar","application/x-bzip","application/x-bzip2"];function b(t,e){console.log("fileNameToType",t);for(var n=0;n<e.length;n++)if(-1!==t.lastIndexOf(e[n]))return!0;return!1}var x=[".py",".cs",".c",".htm",".js",".xml",".php",".jsp",".rb",".pl",".asp",".ini",".cg",".java",".as",".config",".hh",".hs",".css",".scss",".sass"],_=function(){function t(e,n,i){Object(d["a"])(this,t),this.name=e,this.mimeType=i,this.path=n.replace(/\/+/g,"/"),this.thumbnail=null,this.id=null}return Object(f["a"])(t,[{key:"setType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?this.type=t:this.mimeType?-1!==this.mimeType.indexOf("image/")?this.type=p.Image:-1!==this.mimeType.indexOf("audio/")?this.type=p.Audio:-1!==this.mimeType.indexOf("video/")?this.type=p.Video:b(this.name,x)?this.type=p.Code:-1!==v.indexOf(this.mimeType)?this.type=p.Word:-1!==g.indexOf(this.mimeType)?this.type=p.Excel:-1!==w.indexOf(this.mimeType)?this.type=p.PPT:-1!==y.indexOf(this.mimeType)?this.type=p.Zip:"text/plain"===this.mimeType?this.type=p.Text:"application/pdf"===this.mimeType?this.type=p.PDF:this.type=p.Normal:this.type=p.Folder,this}},{key:"setFromData",value:function(t){var e=Object(h["get"])(t,"thumbnails[0].small.url");return e&&(this.thumbnail=e),this.id=t.id,this.mimeType=Object(h["get"])(t,"file.mimeType"),t["parentReference"]&&(this.path="/drive/root:"===t["parentReference"]["path"]?"/":t["parentReference"]["path"].replace("/drive/root:","/")),this}},{key:"setState",value:function(t){return this.state=t,this}}]),t}(),C=function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(d["a"])(this,t),this.id=e,this.name=n,this.lock=i},k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"text-editor-container"},[n("div",{staticClass:"text-editor"}),n("div",{staticClass:"saving",class:{show:t.saving}},[t._v("保存中")])])},F=[],j=(n("4917"),n("6b54"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")}),O=[],E={name:"window-base-content",data:function(){return{loading:!1}},methods:{load:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=n.length>0&&void 0!==n[0]&&n[0],!this.loading){t.next=3;break}return t.abrupt("return");case 3:if(this.loading=!0,!this.loadContent){t.next=7;break}return t.next=7,this.loadContent(e);case 7:this.loading=!1,this.$emit("loadFinish");case 9:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){this.load()}},I=E,U=n("2877"),D=Object(U["a"])(I,j,O,!1,null,"05f4ddb7",null),S=D.exports,T=n("df7c"),P={extends:S,name:"window-editor",props:["id","user","file"],data:function(){return{$cm:null,saving:!1}},methods:{loadContent:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n,i,r,a,o,s,c,l,u,d=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=d.length>0&&void 0!==d[0]&&d[0],n=":"+Object(T["join"])(this.file.path,this.file.name),t.next=4,this.$store.dispatch("load",{force:e,user:this.user,path:n});case 4:return i=t.sent,r=i.data,t.next=8,this.$http.get(r["@microsoft.graph.downloadUrl"]);case 8:a=t.sent,o=a.data,this.$cm.setValue(o.toString()),s=this.file.name.match(/.+\.([^.]+)$/),console.log("editor 1",s),s&&(u=CodeMirror.findModeByExtension(s[1]),u&&(c=u.mode,l=u.mime)),console.log("editor 2",c,l),c?(this.$cm.setOption("mode",l),CodeMirror.autoLoadMode(this.$cm,c)):this.$cm.setOption("mode","text/plain");case 16:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),deleteCache:function(){this.$store.commit("deleteCache",{user:this.user,path:":"+this.file.path})},save:function(){var t=this;this.loading||this.saving||(this.saving=!0,this.$http({method:"post",url:"/admin/api/upload/"+this.user.id,params:{path:Object(T["join"])(this.file.path,this.file.name),type:"text"},data:this.$cm.getValue()}).then(function(){t.deleteCache()}).catch(function(e){t.$notify.error("".concat(t.file.name," 保存失败：").concat(e.response.data))}).finally(function(){t.saving=!1}))}},mounted:function(){CodeMirror.modeURL="https://cdn.bootcss.com/codemirror/5.48.0/mode/%N/%N.js",this.$cm=CodeMirror(this.$el.querySelector(".text-editor"),{lineNumbers:!0,extraKeys:{"Ctrl-S":this.save,"Cmd-S":this.save}})}},W=P,R=(n("0372"),Object(U["a"])(W,k,F,!1,null,null,null)),z=R.exports,L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"image-viewer"},[t.loading?t._e():n("img",{attrs:{src:t.src,alt:"图片"}})])},N=[],M={extends:S,name:"window-viewer",props:["user","file"],data:function(){return{src:""}},methods:{loadContent:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e){var n,i,r,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=":"+this.file.path+"/"+this.file.name,t.next=3,this.$store.dispatch("load",{user:this.user,path:n,force:e});case 3:return i=t.sent,r=i.data,this.src=r["@microsoft.graph.downloadUrl"],a=new Image,a.src=this.src,t.next=10,new Promise(function(t){a.addEventListener("load",function(){t()}),setTimeout(function(){t()},1e4)});case 10:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()}},A=M,V=(n("ae02"),Object(U["a"])(A,L,N,!1,null,"745f9efc",null)),Q=V.exports,q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"player"})},B=[],X={extends:S,name:"window-player",props:["user","file"],data:function(){return{}},methods:{loadContent:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e){var n,i,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log("player mounted"),n=":"+Object(T["join"])(this.file.path,this.file.name),t.next=4,this.$store.dispatch("load",{user:this.user,path:n,force:e});case 4:i=t.sent,r=i.data,console.log("player",n,r),new DPlayer({container:this.$el,video:{url:r["@microsoft.graph.downloadUrl"]}});case 8:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()},mounted:function(){this.load()}},Y=X,Z=(n("dd79"),Object(U["a"])(Y,q,B,!1,null,"0380c364",null)),J=Z.exports,G=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"folder-container",on:{dragenter:function(e){return e.preventDefault(),t.dragEnter(e)},dragover:function(t){t.preventDefault()},drop:function(e){return e.preventDefault(),t.dropFile(e)},paste:function(e){return e.preventDefault(),t.paste(e)}}},[t.isDragEnter?n("div",{ref:"dragLeave",staticClass:"upload-icon",on:{dragleave:function(e){return e.preventDefault(),t.dragLeave(e)}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"data-v-093dcf52":"","xlink:href":"#py_shangchuan1"}})]),t._m(0)]):t._e(),n("div",{staticClass:"folder"},t._l(t.files,function(e,i){return n("file-icon",{key:i,attrs:{parent:t.file,file:e,id:t.id},on:{dblclick:t.open}})}),1),t.nextPage?n("div",{staticClass:"next-page"},[n("el-button",{attrs:{type:"text",loading:t.loading},on:{click:t.loadNextPage}},[t._v("加载更多")])],1):t._e(),t.uploading.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[n("span",[t._v("上传中，同时上传："+t._s(t.queueConcurrency))]),n("el-button",{attrs:{type:"text"},on:{click:function(e){t.$store.state.settings=!0}}},[t._v("设置")])],1),n("div",{staticClass:"folder"},t._l(t.uploading,function(e,i){return n("file-icon",{key:i,attrs:{parent:t.file,file:e.file,id:t.id}})}),1)]):t._e(),t.uploadFails.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[t._v("上传失败\n            "),n("el-button",{attrs:{type:"text"},on:{click:t.clearUploadFail}},[t._v("清空")])],1),n("div",{staticClass:"folder"},t._l(t.uploadFails,function(e,i){return n("file-icon",{key:i,attrs:{parent:t.file,file:e.file,id:t.id}})}),1)]):t._e(),t.waiting.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[t._v("等候上传\n            "),n("el-button",{attrs:{type:"text"},on:{click:t.clearWaiting}},[t._v("全部取消")])],1),n("div",{staticClass:"folder"},t._l(t.waiting,function(e,i){return n("file-icon",{key:i,attrs:{parent:t.file,file:e.file,id:t.id}})}),1)]):t._e(),n("input",{ref:"fileInput",staticClass:"hidden-file-input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:t.selectUploadFiles}})])},H=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._v("\n            将文件 / 文件夹 上传到这个目录"),n("br")])}],K=n("75fc"),tt=(n("28a5"),n("ac6a"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"file",on:{dblclick:t.open,contextmenu:function(e){return e.preventDefault(),t.contextmenu(e)},click:t.click}},[n("div",{staticClass:"file-icon",class:{uploading:t.isUploading||t.isWaiting}},[t.image?n("img",{attrs:{src:t.file.thumbnail,alt:"图片"}}):n("svg",{staticClass:"icon file-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+t.icon}})]),!1===t.isNormal?n("div",{staticClass:"state-icon-container"},[t.isUploading?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan"}})]),n("div",[t._v("上传中")])]):t.isWaiting?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_yuyue-lishi-shijian"}})]),n("div",[t._v("等待上传")])]):t._e()]):t._e()]),n("div",{staticClass:"file-name"},[n("div",{staticClass:"file-name__ellipsis"},[t._v(t._s(t.file.name))]),n("div",{staticClass:"file-name__full"},[t._v(t._s(t.file.name))])])])}),et=[],nt={props:{id:String,parent:_,file:_},data:function(){return{image:null}},computed:{icon:function(){switch(this.file.type){case p.Folder:return Icons["folder"];case p.Audio:return Icons["audio"];case p.Video:return Icons["video"];case p.Image:return Icons["image"];case p.Text:return Icons["text"];case p.Zip:return Icons["zip"];case p.PDF:return Icons["pdf"];case p.Word:return Icons["word"];case p.Excel:return Icons["excel"];case p.PPT:return Icons["ppt"];case p.Code:return Icons["code"];default:return Icons["default"]}},isNormal:function(){return this.file.state===m.Normal},isUploading:function(){return this.file.state===m.Uploading},isWaiting:function(){return this.file.state===m.Waiting},isUploadFail:function(){return this.file.state===m.UploadFail}},methods:{open:function(){console.log("open",this.file),this.file.state===m.Normal&&this.$emit("dblclick",this.file)},contextmenu:function(t){(this.isWaiting||this.isUploading)&&this.$store.commit("appendMenuItem",{name:"取消上传",click:this.click}),this.$store.commit("contextmenu",{e:t,id:this.id,file:this.file})},click:function(){var t=this;if(!this.isNormal&&!this.isUploading)if(console.log("file click",{isWaiting:this.isWaiting,isUploadFail:this.isUploadFail}),this.isWaiting)this.$confirm("取消上传 ".concat(this.file.name," ？")).then(function(){t.$store.commit("cancelUploadFile",t.file)}).catch(function(){});else if(this.isUploadFail){var e=this.file.reason||"";this.$confirm("上传失败原因：".concat(e),"再次尝试上传 ".concat(this.file.name," ？")).then(function(){var e=t.$store.getters.getUploadingDataByFile(t.file);e&&t.$store.commit("uploadQueuePush",e)}).catch(function(){})}},loadThumbnail:function(){var t=this;if(this.image=null,this.file.state===m.Normal&&this.file.type===p.Image&&this.file.thumbnail){var e=new Image;e.src=this.file.thumbnail,e.addEventListener("load",function(){t.image=t.file.thumbnail})}}},watch:{file:function(){this.loadThumbnail()}},mounted:function(){this.loadThumbnail()}},it=nt,rt=(n("992d"),Object(U["a"])(it,tt,et,!1,null,"256c7b0d",null)),at=rt.exports,ot=Object.freeze({FileUploaded:Symbol("uploaded"),FileDeleted:Symbol("deleted")}),st=function(){function t(e,n,i){Object(d["a"])(this,t),this.id=Date.now().toString(32),this.user=e,this.file=n,this.z=i,this.events={}}return Object(f["a"])(t,[{key:"addEventListener",value:function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}},{key:"removeEventListener",value:function(t,e){if(this.events[t]){var n=this.events[t].indexOf(e);n>-1&&this.events[t].splice(n,1)}}},{key:"trigger",value:function(t,e){this.events[t]&&this.events[t].forEach(function(t){return t(e)})}},{key:"clearEventListener",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?this.events[t]=[]:this.events={}}}]),t}(),ct=n("431d"),lt=n("4230"),ut=n("df7c"),dt={extends:S,name:"window-folder",components:{FileIcon:at},props:["id","user","file"],data:function(){return{isDragEnter:!1,files:[],nextPage:null}},watch:{file:function(){this.nextPage=null,this.files.length=0,this.load()}},computed:{uploading:function(){return this.$store.getters.getUploading(this.user,this.file.path)},waiting:function(){return this.$store.getters.getUploading(this.user,this.file.path,m.Waiting)},uploadFails:function(){return this.$store.getters.getUploading(this.user,this.file.path,m.UploadFail)},queueConcurrency:{get:function(){return this.$store.getters.getUploadQueueConcurrency},set:function(t){console.log("改变队列数量",t),this.$store.commit("setUploadQueueConcurrency",t)}}},methods:{paste:function(t){console.log("粘贴事件",t);var e=t.clipboardData||t.originalEvent.clipboardData;e.items&&console.log("粘贴板有内容",e.items.length)},dragEnter:function(){this.isDragEnter||(this.isDragEnter=!0)},dragLeave:function(t){t.target===this.$refs.dragLeave&&(this.isDragEnter=!1)},click_upload:function(t){var e=this.$refs.fileInput;"folder"===t?(e.setAttribute("webkitdirectory",""),e.setAttribute("directory","")):(e.removeAttribute("webkitdirectory"),e.removeAttribute("directory")),this.$refs.fileInput.click()},selectUploadFiles:function(t){for(var e=this,n=t.target.files,i=function(t){var i=n[t],r=ut.join(e.file.path,e.file.name,i.webkitRelativePath);console.log("input file",i);var a=new _(i.name,r,i.type);a.file=i;var o=Object(h["findIndex"])(e.files,{path:i.path,name:i.name});o>-1&&e.$confirm("".concat(i.name," 已经存在，是否覆盖？")).then(function(){e.$store.commit("uploadFile",{id:e.id,path:e.file.path,file:a})}).catch(function(){}),e.$store.commit("uploadFile",{id:e.id,path:e.file.path,file:a})},r=0;r<n.length;r++)i(r)},dropFile:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e){var n,i=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.isDragEnter=!1,t.next=3,Object(ct["getFilesFromDataTransferItems"])(e.dataTransfer.items);case 3:n=t.sent,n.forEach(function(t){var e=t.filepath.split("/");e.pop();var n=ut.join.apply(ut,[i.file.path,i.file.name].concat(Object(K["a"])(e))),r=new _(t.name,n,t.type);r.file=t;var a=Object(h["findIndex"])(i.files,{path:r.path,name:r.name});a>-1?i.$confirm("".concat(r.name," 已经存在，是否覆盖？")).then(function(){i.$store.commit("uploadFile",{id:i.id,path:i.file.path,file:r})}).catch(function(){}):i.$store.commit("uploadFile",{id:i.id,path:i.file.path,file:r})});case 5:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),open:function(t){console.log("window-folder open",t),this.$emit("open",t)},loadContent:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n,i,r,a=this,o=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=o.length>0&&void 0!==o[0]&&o[0],n=ut.join(this.file.path,this.file.name),n="/"===n?"":":".concat(n,":"),n+="/children?expand=thumbnails",e&&(this.nextPage=null),t.prev=5,t.next=8,this.$store.dispatch("load",{user:this.user,path:n,force:e});case 8:i=t.sent,r=i.data,this.files=r.value.map(function(t){var e=ut.join(a.file.path,a.file.name),n=new _(t.name,e).setFromData(t);return n.setFromData(t).setType().setState(m.Normal)}),r["@odata.nextLink"]?this.nextPage=r["@odata.nextLink"].split("/root")[1]:this.nextPage=null,t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](5),this.$emit("loadError",t.t0.response.data);case 17:case"end":return t.stop()}},t,this,[[5,14]])}));function e(){return t.apply(this,arguments)}return e}(),loadNextPage:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n,i,r=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,this.$store.dispatch("load",{user:this.user,path:this.nextPage,force:!0});case 3:n=t.sent,i=n.data,(e=this.files).push.apply(e,Object(K["a"])(i.value.map(function(t){var e=ut.join(r.file.path,r.file.name),n=new _(t.name,e);return n.setFromData(t).setType().setState(m.Normal)}))),i["@odata.nextLink"]?this.nextPage=i["@odata.nextLink"].split("/root")[1]:this.nextPage=null,this.loading=!1;case 8:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),removeFile:function(t){var e=this.files.indexOf(t);e>-1&&this.files.splice(e,1)},fileUploaded:function(t){if(t.path===ut.join(this.file.path,this.file.name)){var e=Object(h["findIndex"])(this.files,{name:t.name});e>-1&&this.files.splice(e,1),this.files.push(t)}},clearWaiting:function(){var t=this;this.$confirm("确认清空等待上传的任务？").then(function(){t.$store.commit("clearUploadingFile",m.Waiting)}).catch(function(){})},clearUploadFail:function(){var t=this;this.$confirm("确认清空上传失败的任务？").then(function(){t.$store.commit("clearUploadingFile",m.UploadFail)}).catch(function(){})},create:function(t,e){var n=this;if(console.log("创建",t,e),t===p.Folder){var i="/"===ut.join(this.file.path,this.file.name)?"/root":"/items/"+this.file.id;this.$http.get(lt["a"].createFolder+"/"+this.user.id+"?path="+i+"&name="+e).then(function(t){var i=t.data;n.files.push(new _(e,ut.join(n.file.path,e)).setFromData(i).setType(p.Folder).setState(m.Normal))}).catch(function(){})}}},mounted:function(){this.$store.state.windows[this.id].addEventListener(ot.FileUploaded,this.fileUploaded),this.$store.state.windows[this.id].addEventListener(ot.FileDeleted,this.removeFile)},beforeDestroy:function(){this.$store.state.windows[this.id]&&(this.$store.state.windows[this.id].removeEventListener(ot.FileUploaded,this.fileUploaded),this.$store.state.windows[this.id].removeEventListener(ot.FileDeleted,this.removeFile))}},ft=dt,ht=(n("83d8"),Object(U["a"])(ft,G,H,!1,null,"59b00c22",null)),pt=ht.exports,mt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"loading"},[t._v("\n    读取中\n")])},vt=[],gt={name:"window-loading"},wt=gt,yt=(n("01bd"),Object(U["a"])(wt,mt,vt,!1,null,"09339c0c",null)),bt=yt.exports,xt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._v("错误："+t._s(t.error))])},_t=[],$t={name:"window-error",props:["error"]},Ct=$t,kt=Object(U["a"])(Ct,xt,_t,!1,null,"b8e6a73c",null),Ft=kt.exports,jt={components:{WindowError:Ft,WindowLoading:bt,WindowFolder:pt,WindowPlayer:J,WindowViewer:Q,WindowEditor:z},props:{id:String,user:C,file:_,z:Number},data:function(){return{loading:!1,dragging:!1,zIndex:0,active:!0,history:[],historyIndex:0,error:null}},methods:{upload:function(t){!1===this.loading&&this.$refs["content"].click_upload&&this.$refs["content"].click_upload(t)},close:function(){this.$store.commit("closeWindow",this.id)},focus:function(){this.$store.state.activeID!==this.id&&this.$store.commit("windowSetTop",this.id)},blur:function(){},loadFinish:function(){this.loading=!1},loadError:function(t){this.error=t,this.loading=!1},load:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n=this,i=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e=i.length>0&&void 0!==i[0]&&i[0],this.loading=!0,this.error=null,this.$nextTick(function(){n.$refs["content"].load(e)});case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),open:function(t){console.log("window.vue open",this.loading,t),this.loading||(this.history.splice(this.historyIndex+1),this.append(t),this.historyIndex++,this.load())},go:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(!this.loading){var e=this.historyIndex+t;e>=0&&e<this.history.length&&(this.historyIndex+=t)}},append:function(t){this.history.push(t)},create:function(t){var e=this;"folder"===t?this.$prompt("输入文件夹名称","创建文件夹").then(function(t){var n=t.value;e.$refs["content"].create(p.Folder,n)}).catch(function(){}):"text"===t&&this.$prompt("输入文本文件名称","创建文本文件").then(function(t){var n=t.value;e.$refs["content"].create(p.Text,n)}).catch(function(){})}},computed:{current:function(){return this.history[this.historyIndex]},showFolder:function(){return this.current.type===p.Folder},showPlayer:function(){return-1!==[p.Video,p.Audio].indexOf(this.current.type)},showEditor:function(){return-1!==[p.Code,p.Text].indexOf(this.current.type)},showViewer:function(){return-1!==[p.Image].indexOf(this.current.type)},path:function(){var t=this;return this.history.slice(0,this.historyIndex+1).map(function(e,n){return 0===n?t.user.name:e.name})}},beforeMount:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.append(this.file),t.next=3,this.load();case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),watch:{},mounted:function(){var t=this,e=$(this.$el),n=e.find(".window--head");e.mousedown(function(){t.focus()}).draggable({handle:n,cancel:".controller",start:function(){t.focus(),t.dragging=!0},stop:function(){t.dragging=!1}}).resizable({minHeight:150,minWidth:200,start:function(){t.dragging=!0},stop:function(){t.dragging=!1}})}},Ot=jt,Et=(n("3e6b"),Object(U["a"])(Ot,l,u,!1,null,"1b7c287f",null)),It=Et.exports,Ut=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user",on:{dblclick:t.open}},[n("div",{staticClass:"user-icon"},[n("svg",{staticClass:"icon main-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+t.icon}})]),t.user.lock?n("svg",{staticClass:"icon lock-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_lock"}})]):t._e()]),n("div",{staticClass:"user-name"},[t._v(t._s(t.user.name))])])},Dt=[],St={props:{user:C},data:function(){return{icon:Icons["user"]}},methods:{open:function(){this.$store.commit("createWindow",{user:this.user,file:new _("/","/").setType(),active:!0})}}},Tt=St,Pt=(n("4235"),Object(U["a"])(Tt,Ut,Dt,!1,null,"b1b9c9a0",null)),Wt=Pt.exports,Rt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.value?n("div",{staticClass:"contextmenu full",style:{"z-index":t.$store.state.z},on:{click:t.hide,contextmenu:function(e){return e.preventDefault(),t.hide(e)}}},[n("div",{staticClass:"contextmenu-list",style:{left:t.offsetX,top:t.offsetY}},t._l(t.list,function(e,i){return n("div",{key:i,on:{click:e.click}},[t._v(t._s(e.name))])}),0)]):t._e()},zt=[],Lt={name:"contextmenu",props:["value","x","y","id","file"],data:function(){return{list:[]}},methods:{hide:function(){this.$emit("input",!1),this.$store.state.menuExtraItems.length=0}},computed:{offsetX:function(){return this.x+2+"px"},offsetY:function(){return this.y+2+"px"}},watch:{file:function(){var t,e=this,n=this.$store.state.windows[this.id],i=n.user;this.list.length=0,this.file.state===m.Normal&&([p.Folder,p.Text,p.Code,p.Image,p.Video,p.Audio].indexOf(this.file.type)>-1&&this.list.push({name:"新窗口打开",click:function(){e.$store.commit("createWindowFromMenu",{file:e.file})}}),this.file.type!==p.Folder&&this.list.push({name:"下载文件",click:function(){window.open("/download/".concat(i.id,"?path=:").concat(Object(T["join"])(e.file.path,e.file.name)))}}),this.list.push({name:"删除文件",click:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm("确认删除文件 ".concat(e.file.name," ?")).then(function(){e.$http({method:"delete",url:"/admin/api/".concat(i.id,"?path=").concat(Object(T["join"])(e.file.path,e.file.name))}).then(function(){e.$notify.success("成功删除 ".concat(e.file.name)),n.trigger(ot.FileDeleted,e.file)}).catch(function(t){e.$notify.error("".concat(e.file.name," 删除失败：").concat(t.response.data))})}).catch(function(){});case 1:case"end":return t.stop()}},t)}));function r(){return t.apply(this,arguments)}return r}()})),(t=this.list).push.apply(t,Object(K["a"])(this.$store.state.menuExtraItems))}}},Nt=Lt,Mt=(n("500d"),Object(U["a"])(Nt,Rt,zt,!1,null,"7f9a61f3",null)),At=Mt.exports,Vt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"settings-container",class:{show:t.show},on:{click:function(e){return e.target!==e.currentTarget?null:t.save(e)}}},[t.show?t._e():n("a",{staticClass:"settings-icon",attrs:{title:"打开设置界面"},on:{click:function(e){t.show=!t.show}}},[n("i",{staticClass:"el-icon-s-tools"})]),t.show?n("el-card",[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t._v("全局设置")]),n("el-form",[n("el-form-item",{attrs:{label:"同时上传文件的数量"}},[n("el-input-number",{model:{value:t.concurrency,callback:function(e){t.concurrency=e},expression:"concurrency"}})],1)],1)],1):t._e()],1)},Qt=[],qt={name:"settings",data:function(){return{queueConcurrency:5}},computed:{show:{set:function(t){this.$store.state.settings=t},get:function(){return this.$store.state.settings}},concurrency:{set:function(t){t<1?t=1:t>11&&(t=10),this.queueConcurrency=t},get:function(){return this.queueConcurrency}}},methods:{save:function(){this.$store.commit("setUploadQueueConcurrency",this.queueConcurrency),this.show=!1}}},Bt=qt,Xt=(n("b82e"),Object(U["a"])(Bt,Vt,Qt,!1,null,"6d238952",null)),Yt=Xt.exports,Zt={components:{Settings:Yt,Contextmenu:At,UserIcon:Wt,Window:It},data:function(){return{defaultProps:{children:"children",label:"label"},users:[]}},computed:{windows:function(){return this.$store.state.windows},menu:function(){return this.$store.state.menu}},methods:{},beforeMount:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n,i,r,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.$store.commit("setVueInstance",this),t.next=3,this.$store.dispatch("api",{url:c.accounts});case 3:for(n in e=t.sent,this.users.length=0,e.data)i=e.data[n],r=new C(i.id,i.name),this.users.push(r);window.addEventListener("beforeunload",function(t){if(a.$store.state.uploadingLength>0){var e="\\o/";return(t||window.event).returnValue=e,e}});case 7:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},Jt=Zt,Gt=(n("7a49"),Object(U["a"])(Jt,r,a,!1,null,"05d5540c",null)),Ht=Gt.exports,Kt=n("2f62"),te=n("17d4"),ee=n.n(te),ne=n("bc3a");i["default"].use(Kt["a"]);var ie,re=ee()(function(t,e){var n=t.user,i=t.file;i.state=t.state=m.Uploading;var r=new FormData,a=Object(T["join"])(lt["a"].uploadFile,n.id)+"?type=file&path="+Object(T["join"])(i.path,i.name);r.append("file",i.file),ne({method:"post",url:a,data:r,headers:{"Content-Type":"multipart/form-data"}}).then(function(t){var n=t.data;console.log("SUCCESS!!"),i.setFromData(n),i.setType(),ie.$notify.success({title:"上传成功",message:i.name}),e&&e(!0)}).catch(function(t){var n=t.response;console.log("FAILURE!!",n),i.reason=n.data,ie.$notify.error({title:"上传失败："+i.name,message:i.reason}),e&&e(!1)})},5),ae=new Kt["a"].Store({state:{z:1,windows:{},menu:{show:!1,x:0,y:0,id:null,file:null},menuExtraItems:[],activeID:null,error:null,cache:{},uploading:[],uploadingLength:0,uploadQueueConcurrency:re.concurrency,settings:!1},getters:{getUploading:function(t){return function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.Uploading;return t.uploading.filter(function(t){return t.user===e&&t.path===n&&t.state===i})}},getUploadingDataByFile:function(t){return function(e){var n=Object(h["findIndex"])(t.uploading,["file",e]);return n>-1?t.uploading[n]:null}},getUploadQueueConcurrency:function(t){return t.uploadQueueConcurrency}},mutations:{setVueInstance:function(t,e){ie=e},setUploadQueueConcurrency:function(t,e){t.uploadQueueConcurrency=e,re.concurrency=e,console.log("改变后",re.concurrency)},setError:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"错误";t.error={title:n,content:e.data}},setCache:function(t,e){var n=e.url,i=e.res;t.cache[n]=i},createWindow:function(t,e){var n=e.user,r=e.file,a=e.active,o=void 0!==a&&a;console.log("createWindow");var s=new st(n,r,t.z);i["default"].set(t.windows,s.id,s),t.z++,o&&(t.activeID=s.id)},createWindowFromMenu:function(t,e){var n=e.file;this.commit("createWindow",{user:t.windows[t.menu.id].user,file:n,active:!0})},contextmenu:function(t,e){var n=e.e,i=e.id,r=e.file;console.log("右键",n,i,r),t.menu.show=!0,t.menu.x=n.clientX,t.menu.y=n.clientY,t.menu.file=r,t.menu.id=i},appendMenuItem:function(t,e){var n=e.name,i=e.click;t.menuExtraItems.push({name:n,click:i})},clearWindow:function(t){t.windows={}},closeWindow:function(t,e){t.windows[e].clearEventListener(),i["default"].delete(t.windows,e)},windowSetTop:function(t,e){t.activeID=e,t.windows[e].z=t.z;var n=Object(h["sortBy"])(t.windows,"z");n.forEach(function(t){var e=n.indexOf(t);t.z=e+1}),t.z=n.length+1},uploadFile:function(t,e){var n=e.id,i=e.path,r=e.file,a=t.windows[n].user,o={id:n,user:a,path:i,file:r,state:m.Waiting};this.commit("uploadQueuePush",o)},cancelUploadFile:function(t,e){var n=Object(h["findIndex"])(t.uploading,["file",e]);n>-1&&(t.uploading.splice(n,1),re.remove(function(t){var n=t.data;return n.file===e}))},uploadQueuePush:function(t,e){var n=e.id,i=e.file,r=t.uploading.indexOf(e);r>-1&&t.uploading.splice(r,1),t.uploading.push(e),i.state=e.state=m.Waiting,re.push(e,function(r){console.log("上传结果",i.path,r);var a=t.uploading.indexOf(e);a>-1&&t.uploading.splice(a,1),r?(i.state=m.Normal,t.windows[n].trigger(ot.FileUploaded,i)):(i.state=e.state=m.UploadFail,t.uploading.push(e))})},clearUploadingFile:function(t,e){t.uploading=t.uploading.filter(function(t){var n=t.file;return n.state!==e}),re.kill()},deleteCache:function(t,e){var n=e.user,i=e.path,r=c.loadFile+"/"+n.id+"?path="+i;delete t.cache[r]}},actions:{api:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e,n){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ne(n);case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t["catch"](0),e.commit("setError",t.t0.response),t.abrupt("return",null);case 10:case"end":return t.stop()}},t,null,[[0,6]])}));function e(e,n){return t.apply(this,arguments)}return e}(),load:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e,n){var i,r,a,o,s,l;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(i=n.user,r=n.path,a=n.force,o=void 0!==a&&a,s=c.loadFile+"/"+i.id+"?path="+encodeURIComponent(r),console.log("load",s,o),!e.state.cache[s]||o){t.next=5;break}return t.abrupt("return",e.state.cache[s]);case 5:return t.next=7,ne.get(s);case 7:return l=t.sent,200===l.status&&e.commit("setCache",{url:s,res:l}),t.abrupt("return",l);case 10:case"end":return t.stop()}},t)}));function e(e,n){return t.apply(this,arguments)}return e}()}}),oe=ae,se=(n("e008"),n("5c96")),ce=n.n(se);n("0fae");i["default"].config.productionTip=!1,i["default"].use(ce.a),i["default"].prototype.$http=n("bc3a"),new i["default"]({store:oe,render:function(t){return t(Ht)}}).$mount("#app")},e008:function(t,e,n){},e655:function(t,e,n){},ea30:function(t,e,n){}});