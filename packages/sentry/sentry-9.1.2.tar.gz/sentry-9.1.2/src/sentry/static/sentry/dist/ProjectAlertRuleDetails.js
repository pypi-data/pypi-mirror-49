(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{2359:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n.n(a),i=n(6),l=n.n(i),o=n(7),c=n.n(o),s=n(5),u=n.n(s),d=n(8),h=n.n(d),p=n(0),m=n.n(p),f=n(9),g=n(153),b=n(50),v=n.n(b),y=n(12),j=n.n(y),E=n(48),O=n.n(E),x=n(10),R=n(1),C=n.n(R),w=n(17),q=n.n(w),S=n(3),k=n(47),N=n(25),P=n(41),F=n(39),T=n(2),A=n(37),D=n(24),M=n(129),z=n(33),B=n(102),L=function(e){function t(){return r()(this,t),c()(this,u()(t).apply(this,arguments))}return h()(t,e),l()(t,[{key:"getChoiceField",value:function(e,t){var n,a=this;return void 0===this.props.data[e]&&t.choices.length?(n=t.choices[0][0],this.props.handlePropertyChange(e,n)):n=this.props.data[e],m.a.createElement(P.SelectField,{clearable:!1,placeholder:Object(T.t)("Select integration"),noResultsText:Object(T.t)("No integrations available"),name:e,value:n,choices:t.choices,key:e,style:{marginLeft:6,marginRight:6},onChange:function(t){return a.props.handlePropertyChange(e,t)}})}},{key:"getTextField",value:function(e,t){var n=this;return m.a.createElement(P.TextField,{name:e,value:this.props.data[e],placeholder:t.placeholder,key:e,style:{marginBottom:0},onChange:function(t){return n.props.handlePropertyChange(e,t)}})}},{key:"getNumberField",value:function(e,t){var n=this;return m.a.createElement(P.NumberField,{name:e,value:this.props.data[e],placeholder:t.placeholder.toString(),key:e,style:{marginBottom:0},onChange:function(t){return n.props.handlePropertyChange(e,t)}})}},{key:"getField",value:function(e,t){return{choice:this.getChoiceField.bind(this),number:this.getNumberField.bind(this),string:this.getTextField.bind(this)}[t.type](e,t)}},{key:"getComponent",value:function(e){var t=this,n=e.label,a=e.formFields;return n.split(/({\w+})/).map(function(e){if(!/^{\w+}$/.test(e))return e;var n=e.slice(1,-1);return a[n]?t.getField(n,a[n]):e})}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.node,a=this.getComponent(n);return m.a.createElement(J,null,m.a.createElement(I,null,m.a.createElement("input",{type:"hidden",name:"id",value:t.id}),a),m.a.createElement(_,null,m.a.createElement(D.default,{onClick:this.props.handleDelete,type:"button",tabIndex:"-1",size:"small",icon:"icon-trash"})))}}]),t}(m.a.Component);L.propTypes={data:C.a.object.isRequired,node:C.a.shape({label:C.a.string.isRequired,formFields:C.a.object}).isRequired,handleDelete:C.a.func.isRequired,handlePropertyChange:C.a.func.isRequired};var U=L,J=Object(S.default)("div",{target:"e1qnqozx0"})("display:flex;align-items:center;padding:0 15px;&:nth-child(odd){background-color:",function(e){return e.theme.offWhite},";}"),I=Object(S.default)("div",{target:"e1qnqozx1"})("display:flex;flex-wrap:wrap;flex:1;line-height:40px;margin:5px 12px 5px 0;align-items:center;.control-group{margin:0 6px;}.form-control{padding:3px 12px;}.Select{line-height:26px;min-width:150px;}.Select-placeholder{height:26px;line-height:26px;}.Select-control{height:24px;}.Select--single > .Select-control .Select-value{line-height:25px;}.Select-input{height:24px;input{line-height:20px;padding:2px 0;}}"),_=Object(S.default)("div",{target:"e1qnqozx2"})("margin-left:6px;"),H=function(e){function t(){var e,n;r()(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(n=c()(this,(e=u()(t)).call.apply(e,[this].concat(i)))).getNode=function(e){return n.props.nodes.find(function(t){return t.id===e})},n}return h()(t,e),l()(t,[{key:"render",value:function(){var e=this;return m.a.createElement("div",{className:this.props.className},m.a.createElement(W,null,this.props.items.map(function(t,n){return m.a.createElement(U,{key:n,node:e.getNode(t.id),handleDelete:function(){return e.props.handleDeleteRow(n)},data:t,handlePropertyChange:e.props.handlePropertyChange(n)})})),m.a.createElement("fieldset",null,m.a.createElement(B.a,{onChange:function(t){return e.props.handleAddRow(t?t.value:t)},style:{width:"100%"},options:this.props.nodes.filter(function(e){return e.enabled}).map(function(e){return{value:e.id,label:e.label}})})))}}]),t}(m.a.Component);H.propTypes={items:C.a.array,nodes:C.a.array.isRequired,handlePropertyChange:C.a.func.isRequired,handleAddRow:C.a.func.isRequired,handleDeleteRow:C.a.func.isRequired};var V=H,W=Object(S.default)("div",{target:"e17yy09u0"})("display:flex;flex-direction:column;margin-bottom:10px;"),$=n(187),G=n(15),K=[["5",Object(T.t)("5 minutes")],["10",Object(T.t)("10 minutes")],["30",Object(T.t)("30 minutes")],["60",Object(T.t)("60 minutes")],["180",Object(T.t)("3 hours")],["720",Object(T.t)("12 hours")],["1440",Object(T.t)("24 hours")],["10080",Object(T.t)("one week")],["43200",Object(T.t)("30 days")]],Q=[["all",Object(T.t)("all")],["any",Object(T.t)("any")],["none",Object(T.t)("none")]],X=Object(S.default)("h6",{target:"elb7f1e0"})("display:flex;align-items:center;"),Y=q()({displayName:"RuleEditor",propTypes:{actions:C.a.array.isRequired,conditions:C.a.array.isRequired,project:C.a.object.isRequired,organization:C.a.object.isRequired},mixins:[A.default],getInitialState:function(){return{rule:null,loading:!1,error:null}},componentDidMount:function(){this.fetchRule()},componentDidUpdate:function(){this.state.error&&O()(document.body).scrollTop(O()(this.formNode).offset().top)},fetchRule:function(){var e=this,t=this.props.params,n=t.ruleId,a=t.projectId,r=t.orgId;if(n){var i="/projects/".concat(r,"/").concat(a,"/rules/").concat(n,"/");this.api.request(i,{success:function(t){e.setState({rule:t})}})}else{var l={actionMatch:"all",actions:[],conditions:[],name:"",frequency:30,environment:k.e};this.setState({rule:l})}},handleSubmit:function(e){var t=this;e.preventDefault();var n=j()({},this.state.rule),a=!n.id,r=this.props,i=r.project,l=r.organization,o="/projects/".concat(l.slug,"/").concat(i.slug,"/rules/");n.id&&(o+=n.id+"/"),n.environment===k.e&&delete n.environment,Object(F.addMessage)(Object(T.t)("Saving...")),this.api.request(o,{method:a?"POST":"PUT",data:n,success:function(e){t.setState({error:null,loading:!1,rule:e}),a&&x.browserHistory.replace(Object($.a)("".concat(e.id,"/"),j()({},t.props,{stepBack:-1}))),Object(F.addSuccessMessage)(a?Object(T.t)("Created alert rule"):Object(T.t)("Updated alert rule"))},error:function(e){t.setState({error:e.responseJSON||{__all__:"Unknown error"},loading:!1}),Object(F.addErrorMessage)(Object(T.t)("An error occurred"))}})},hasError:function(e){var t=this.state.error;return!!t&&!!t[e]},handleEnvironmentChange:function(e){e===k.e?this.handleChange("environment",null):this.handleChange("environment",e)},handleChange:function(e,t){this.setState(function(n){var a=j()({},n.rule);return a[e]=t,{rule:a}})},handlePropertyChange:function(e){var t=this;return function(n){return function(a,r){var i=j()({},t.state.rule);i[e][n][a]=r,t.setState({rule:i})}}},handleAddRow:function(e){var t=this;return function(n){t.setState(function(t){return t.rule[e].push({id:n}),{rule:t.rule}})}},handleDeleteRow:function(e){var t=this;return function(n){t.setState(function(t){return t.rule[e].splice(n,1),{rule:t.rule}})}},render:function(){var e=this,t=M.a.getActive()||[],n=[[k.e,Object(T.t)("All Environments")]].concat(v()(t.map(function(e){return[e.name,e.displayName]})));if(!this.state.rule)return m.a.createElement(z.default,null);var a=this.state,r=a.rule,i=a.loading,l=a.error,o=r.actionMatch,c=r.actions,s=r.conditions,u=r.frequency,d=r.name,h=null===r.environment?k.e:r.environment;return m.a.createElement("form",{onSubmit:this.handleSubmit,ref:function(t){return e.formNode=t}},m.a.createElement(N.a,{className:"rule-detail"},m.a.createElement(N.e,null,r.id?"Edit Alert Rule":"New Alert Rule"),m.a.createElement(N.c,{disablePadding:!1},l&&m.a.createElement("div",{className:"alert alert-block alert-error"},m.a.createElement("p",null,Object(T.t)("There was an error saving your changes. Make sure all fields are valid and try again."))),m.a.createElement("h6",null,Object(T.t)("Rule name"),":"),m.a.createElement(P.TextField,{name:"name",defaultValue:d,required:!0,placeholder:Object(T.t)("My Rule Name"),onChange:function(t){return e.handleChange("name",t)}}),m.a.createElement("hr",null),m.a.createElement(X,null,Object(T.t)("Every time %s of these conditions are met:",m.a.createElement(P.SelectField,{clearable:!1,className:this.hasError("actionMatch")?" error":"",style:{marginBottom:0,marginLeft:5,marginRight:5,width:100},name:"actionMatch",value:o,required:!0,choices:Q,onChange:function(t){return e.handleChange("actionMatch",t)}}))),this.hasError("conditions")&&m.a.createElement("p",{className:"error"},this.state.error.conditions[0]),m.a.createElement(V,{nodes:this.props.conditions,items:s||[],className:"rule-condition-list",handlePropertyChange:this.handlePropertyChange("conditions"),handleAddRow:this.handleAddRow("conditions"),handleDeleteRow:this.handleDeleteRow("conditions")}),m.a.createElement("hr",null),m.a.createElement("h6",null,Object(T.t)("In this environment"),":"),m.a.createElement(P.SelectField,{clearable:!1,className:this.hasError("environment")?" error":"",style:{marginBottom:0,marginLeft:5,marginRight:5},name:"environment",value:h,required:!0,choices:n,onChange:function(t){return e.handleEnvironmentChange(t)}}),m.a.createElement("hr",null),m.a.createElement("h6",null,Object(T.t)("Take these actions:")),this.hasError("actions")&&m.a.createElement("p",{className:"error"},this.state.error.actions[0]),m.a.createElement(V,{nodes:this.props.actions,items:c||[],handlePropertyChange:this.handlePropertyChange("actions"),handleAddRow:this.handleAddRow("actions"),handleDeleteRow:this.handleDeleteRow("actions")}),m.a.createElement("hr",null),m.a.createElement(X,null,Object(T.t)("Perform these actions at most once every %s for an issue.",m.a.createElement(P.SelectField,{clearable:!1,name:"frequency",className:this.hasError("frequency")?" error":"",value:u,style:{marginBottom:0,marginLeft:5,marginRight:5,width:140},required:!0,choices:K,onChange:function(t){return e.handleChange("frequency",t)}}))),m.a.createElement(ee,null,m.a.createElement(Z,{to:Object($.a)("",j()({},this.props,{stepBack:-1}))},Object(T.t)("Cancel")),m.a.createElement(D.default,{priority:"primary",disabled:i},Object(T.t)("Save Rule"))))))}}),Z=Object(S.default)(D.default,{target:"elb7f1e1"})("margin-right:",Object(G.default)(1),";"),ee=Object(S.default)("div",{target:"elb7f1e2"})("display:flex;justify-content:flex-end;padding:",Object(G.default)(2),";border-top:1px solid ",function(e){return e.theme.borderLight},";margin:0 -",Object(G.default)(2)," -",Object(G.default)(2),";"),te=function(e){function t(){return r()(this,t),c()(this,u()(t).apply(this,arguments))}return h()(t,e),l()(t,[{key:"getEndpoints",value:function(){var e=this.props.params,t=e.orgId,n=e.projectId;return[["configs","/projects/".concat(t,"/").concat(n,"/rules/configuration/")]]}},{key:"renderBody",value:function(){var e=this.context,t=e.organization,n=e.project,a=this.state.configs,r=a.actions,i=a.conditions;return m.a.createElement(Y,{organization:t,project:n,actions:r,conditions:i,params:this.props.params,routes:this.props.routes})}}]),t}(g.default);te.contextTypes={organization:f.default.Organization,project:f.default.Project};t.default=te}}]);
//# sourceMappingURL=ProjectAlertRuleDetails.js.map