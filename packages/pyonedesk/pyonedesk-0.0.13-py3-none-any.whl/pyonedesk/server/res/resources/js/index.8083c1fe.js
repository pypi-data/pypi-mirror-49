(function(e){function t(t){for(var i,s,o=t[0],c=t[1],l=t[2],d=0,f=[];d<o.length;d++)s=o[d],r[s]&&f.push(r[s][0]),r[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(f.length)f.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(i=!1)}i&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},r={index:0},a=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("df31")},"01bd":function(e,t,n){"use strict";var i=n("b954"),r=n.n(i);r.a},"0372":function(e,t,n){"use strict";var i=n("18e4"),r=n.n(i);r.a},"09f0":function(e,t,n){"use strict";var i=n("fea1"),r=n.n(i);r.a},"18e4":function(e,t,n){},"1f7a":function(e,t,n){"use strict";var i=n("b38b"),r=n.n(i);r.a},2744:function(e,t,n){"use strict";var i=n("3729"),r=n.n(i);r.a},3729:function(e,t,n){},4230:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i="/admin/api",r={accountsList:i+"/accounts",createAccountID:i+"/account/create_id",addAccount:i+"/accounts/add",addAccountName:i+"/accounts/add",deleteAccount:i+"/accounts/delete",account:i+"/account",goCreateAppUrl:i+"/go_create_app",goGetCode:i+"/go_get_code",stylizes:i+"/stylizes",uploadFile:i+"/upload"}},"5b32":function(e,t,n){"use strict";var i=n("7294"),r=n.n(i);r.a},"6c2e":function(e,t,n){"use strict";var i=n("d968"),r=n.n(i);r.a},7294:function(e,t,n){},"9ad2":function(e,t,n){},"9d69":function(e,t,n){"use strict";var i=n("cd0a"),r=n.n(i);r.a},b38b:function(e,t,n){},b954:function(e,t,n){},bd9a:function(e,t,n){},bf2b:function(e,t,n){"use strict";var i=n("9ad2"),r=n.n(i);r.a},cd0a:function(e,t,n){},d968:function(e,t,n){},df31:function(e,t,n){"use strict";n.r(t);n("14c6"),n("08c1"),n("4842"),n("d9fc");var i=n("a026"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"desktop full",on:{dragover:function(e){e.preventDefault()},drop:function(e){e.preventDefault()}}},[e._l(e.users,function(e){return n("user-icon",{key:e.id,attrs:{user:e}})}),e._l(e.windows,function(e){return n("window",{key:e.id,attrs:{id:e.id,user:e.user,file:e.file,z:e.z,uploads:e.uploads}})}),n("contextmenu",{attrs:{x:e.menu.x,y:e.menu.y,file:e.menu.file,id:e.menu.id},model:{value:e.menu.show,callback:function(t){e.$set(e.menu,"show",t)},expression:"menu.show"}})],2)},a=[],s=(n("7f7f"),n("96cf"),n("3b8d")),o="",c={accounts:o+"/accounts",loadFile:o+"/path"},l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"window",class:{active:e.$store.state.activeID===e.id,dragging:e.dragging,loading:e.loading},style:{"z-index":e.z},attrs:{tabindex:e.z},on:{focus:e.focus,blur:e.blur}},[n("div",{staticClass:"window--head"},[n("div",{staticClass:"name"},[e._v(" "+e._s(e.current.name))]),n("div",{staticClass:"controller",staticStyle:{"margin-right":"10px"}},[n("svg",{staticClass:"icon",class:{disabled:e.loading},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.load(!0)}}},[n("use",{attrs:{"xlink:href":"#py_shuaxin"}})]),n("svg",{staticClass:"icon",class:{disabled:e.loading||e.historyIndex<=0},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.go()}}},[n("use",{attrs:{"xlink:href":"#py_houtui"}})]),n("svg",{staticClass:"icon",class:{disabled:e.loading||e.historyIndex>=e.history.length-1},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.go(1)}}},[n("use",{attrs:{"xlink:href":"#py_qianjin"}})])]),n("div",{staticClass:"controller"},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"},on:{click:e.close}},[n("use",{attrs:{"xlink:href":"#py_guanbi"}})])])]),n("div",{staticClass:"window--path"},[n("div",{staticClass:"path"},[e._v("\n            路径："+e._s(e.user.name)+e._s(e.current.path)+"\n        ")]),!1===e.loading&&e.showFolder?n("div",{staticClass:"controller"},[n("div",{on:{click:function(t){return e.upload("file")}}},[n("svg",{staticClass:"icon",class:{disabled:e.loading},attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan1"}})]),e._v("\n                文件\n            ")]),n("div",{on:{click:function(t){return e.upload("folder")}}},[n("svg",{staticClass:"icon",class:{disabled:e.loading},attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan1"}})]),e._v("\n                文件夹\n            ")])]):e._e()]),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.dragging,expression:"!dragging"}],staticClass:"window--body",class:{loading:e.loading}},[e.loading?n("window-loading"):e._e(),[e.showFolder?[n("window-folder",{ref:"content",attrs:{user:e.user,id:e.id,file:e.current},on:{open:e.open,loadFinish:e.loadFinish}})]:e.showEditor?[n("window-editor",{ref:"content",attrs:{user:e.user,file:e.current},on:{loadFinish:e.loadFinish}})]:e.showViewer?[n("window-viewer",{ref:"content",attrs:{user:e.user,file:e.current},on:{loadFinish:e.loadFinish}})]:e.showPlayer?[n("window-player",{ref:"content",attrs:{user:e.user,file:e.current},on:{loadFinish:e.loadFinish}})]:e._e()]],2)])},u=[],d=(n("7514"),n("c5f6"),n("d225")),f=n("b0b4"),h=(n("ac4d"),n("8a81"),n("0d6d"),n("2ef0")),p=Object.freeze({Normal:Symbol("normal"),Image:Symbol("image"),Audio:Symbol("audio"),Video:Symbol("video"),Text:Symbol("text"),Code:Symbol("code"),Word:Symbol("word"),Excel:Symbol("excel"),PPT:Symbol("ppt"),Zip:Symbol("zip"),Folder:Symbol("folder"),PDF:Symbol("pdf")}),m=Object.freeze({Normal:Symbol("normal"),Uploading:Symbol("uploading"),Waiting:Symbol("waiting"),Deleting:Symbol("deleting"),UploadFail:Symbol("uploadFail")}),v=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],g=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],w=["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"],y=["application/zip","application/x-7z-compressed","application/x-rar-compressed","application/x-tar","application/x-bzip","application/x-bzip2"];function b(e,t){for(var n=0;n<t.length;n++)if(-1!==e.lastIndexOf(t[n]))return!0;return!1}var x=[".py",".cs",".c",".htm",".js",".xml",".php",".jsp",".rb",".pl",".asp",".ini",".cg",".java",".as",".config",".hh",".hs",".css",".scss",".sass"],_=function(){function e(t,n,i){Object(d["a"])(this,e),this.name=t,this.mimeType=i,this.path=n,this.thumbnail=null,this.setType()}return Object(f["a"])(e,[{key:"setType",value:function(){this.mimeType?-1!==this.mimeType.indexOf("image/")?this.type=p.Image:-1!==this.mimeType.indexOf("audio/")?this.type=p.Audio:-1!==this.mimeType.indexOf("video/")?this.type=p.Video:b(name,x)?this.type=p.Code:-1!==v.indexOf(this.mimeType)?this.type=p.Word:-1!==g.indexOf(this.mimeType)?this.type=p.Excel:-1!==w.indexOf(this.mimeType)?this.type=p.PPT:-1!==y.indexOf(this.mimeType)?this.type=p.Zip:"text/plain"===this.mimeType?this.type=p.Text:"application/pdf"===this.mimeType?this.type=p.PDF:this.type=p.Normal:this.type=p.Folder}},{key:"setFromData",value:function(e){var t=Object(h["get"])(e,"thumbnails[0].small.url");t&&(this.thumbnail=t),this.mimeType=Object(h["get"])(e,"file.mimeType")}}]),e}(),k=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(d["a"])(this,e),this.id=t,this.name=n,this.lock=i},C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-editor-container"},[n("div",{staticClass:"text-editor"}),n("div",{staticClass:"saving",class:{show:e.saving}},[e._v("保存中")])])},F=[],O=(n("4917"),n("6b54"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")}),j=[],I={name:"window-base-content",data:function(){return{loading:!1}},methods:{load:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]&&n[0],!this.loading){e.next=3;break}return e.abrupt("return");case 3:if(this.loading=!0,!this.loadContent){e.next=7;break}return e.next=7,this.loadContent(t);case 7:this.loading=!1,this.$emit("loadFinish");case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.load()}},E=I,U=n("2877"),D=Object(U["a"])(E,O,j,!1,null,"05f4ddb7",null),S=D.exports,R={extends:S,name:"window-editor",props:["id","user","file"],data:function(){return{$cm:null,saving:!1}},methods:{loadContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,a,s,o,c,l,u,d=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]&&d[0],n=":"+this.file.path,e.next=4,this.$store.dispatch("load",{force:t,user:this.user,path:n});case 4:return i=e.sent,r=i.data,e.next=8,this.$http.get(r["@microsoft.graph.downloadUrl"]);case 8:a=e.sent,s=a.data,this.$cm.setValue(s.toString()),o=this.file.name.match(/.+\.([^.]+)$/),console.log("editor 1",o),o&&(u=CodeMirror.findModeByExtension(o[1]),u&&(c=u.mode,l=u.mime)),console.log("editor 2",c,l),c?(this.$cm.setOption("mode",l),CodeMirror.autoLoadMode(this.$cm,c)):this.$cm.setOption("mode","text/plain");case 16:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),save:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.loading&&!this.saving){e.next=2;break}return e.abrupt("return");case 2:return this.saving=!0,e.next=5,this.$http({method:"post",url:"/admin/api/upload/"+this.user.id,params:{path:this.file.path,type:"text"},data:this.$cm.getValue()});case 5:this.saving=!1;case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){CodeMirror.modeURL="https://cdn.bootcss.com/codemirror/5.48.0/mode/%N/%N.js",this.$cm=CodeMirror(this.$el.querySelector(".text-editor"),{lineNumbers:!0,extraKeys:{"Ctrl-S":this.save,"Cmd-S":this.save}})}},T=R,W=(n("0372"),Object(U["a"])(T,C,F,!1,null,null,null)),z=W.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image-viewer"},[e.loading?e._e():n("img",{attrs:{src:e.src,alt:"图片"}})])},L=[],N={extends:S,name:"window-viewer",props:["user","file"],data:function(){return{src:""}},methods:{loadContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,i,r,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=":"+this.file.path,e.next=3,this.$store.dispatch("load",{user:this.user,path:n,force:t});case 3:return i=e.sent,r=i.data,this.src=r["@microsoft.graph.downloadUrl"],a=new Image,a.src=this.src,e.next=10,new Promise(function(e){a.addEventListener("load",function(){e()}),setTimeout(function(){e()},1e4)});case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}},A=N,M=(n("2744"),Object(U["a"])(A,P,L,!1,null,"1916bc7c",null)),V=M.exports,Q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"player"})},q=[],B={extends:S,name:"window-player",props:["user","file"],data:function(){return{}},methods:{loadContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("player mounted"),n=":".concat(this.file.path),e.next=4,this.$store.dispatch("load",{user:this.user,path:n,force:t});case 4:i=e.sent,r=i.data,console.log("player",n,r),new DPlayer({container:this.$el,video:{url:r["@microsoft.graph.downloadUrl"]}});case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},mounted:function(){this.load()}},X=B,Y=(n("1f7a"),Object(U["a"])(X,Q,q,!1,null,"66043b1f",null)),Z=Y.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"folder-container",on:{dragenter:function(t){return t.preventDefault(),e.dragEnter(t)},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),e.dropFile(t)},paste:function(t){return t.preventDefault(),e.paste(t)}}},[e.isDragEnter?n("div",{ref:"dragLeave",staticClass:"upload-icon",on:{dragleave:function(t){return t.preventDefault(),e.dragLeave(t)}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"data-v-093dcf52":"","xlink:href":"#py_shangchuan1"}})]),e._m(0)]):e._e(),n("div",{staticClass:"folder"},e._l(e.files,function(t,i){return n("file-icon",{key:i,attrs:{parent:e.file,file:t,id:e.id},on:{dblclick:e.open}})}),1),e.uploading.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("\n            上传中，同时上传：\n            "),n("el-select",{attrs:{size:"small"},model:{value:e.queueConcurrency,callback:function(t){e.queueConcurrency=t},expression:"queueConcurrency"}},[n("el-option",{attrs:{value:"1"}},[e._v("1")]),n("el-option",{attrs:{value:"2"}},[e._v("2")]),n("el-option",{attrs:{value:"5"}},[e._v("5")]),n("el-option",{attrs:{value:"8"}},[e._v("8")]),n("el-option",{attrs:{value:"10"}},[e._v("10")])],1)],1),n("div",{staticClass:"folder"},e._l(e.uploading,function(t,i){return n("file-icon",{key:i,attrs:{parent:e.file,file:t.file,id:e.id}})}),1)]):e._e(),e.uploadFails.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("上传失败\n            "),n("el-button",{attrs:{type:"text"},on:{click:e.clearUploadFail}},[e._v("清空")])],1),n("div",{staticClass:"folder"},e._l(e.uploadFails,function(t,i){return n("file-icon",{key:i,attrs:{parent:e.file,file:t.file,id:e.id}})}),1)]):e._e(),e.waiting.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("等候上传\n            "),n("el-button",{attrs:{type:"text"},on:{click:e.clearWaiting}},[e._v("全部取消")])],1),n("div",{staticClass:"folder"},e._l(e.waiting,function(t,i){return n("file-icon",{key:i,attrs:{parent:e.file,file:t.file,id:e.id}})}),1)]):e._e(),n("input",{ref:"fileInput",staticClass:"hidden-file-input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:e.selectUploadFiles}})])},J=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v("\n            将文件上传到这个文件夹"),n("br"),e._v("\n            注意：通过拖拽文件夹上传有文件数量限制\n        ")])}],H=n("75fc"),K=(n("ac6a"),n("df7c")),ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"file",on:{dblclick:e.open,contextmenu:function(t){return t.preventDefault(),e.contextmenu(t)},click:e.click}},[n("div",{staticClass:"file-icon",class:{uploading:e.isUploading||e.isWaiting}},[e.image?n("img",{attrs:{src:e.file.thumbnail}}):n("svg",{staticClass:"icon file-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+e.icon}})]),!1===e.isNormal?n("div",{staticClass:"state-icon-container"},[e.isUploading?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan"}})]),n("div",[e._v("上传中")])]):e.isWaiting?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_yuyue-lishi-shijian"}})]),n("div",[e._v("等待上传")])]):e._e()]):e._e()]),n("div",{staticClass:"file-name"},[n("div",{staticClass:"file-name__ellipsis"},[e._v(e._s(e.file.name))]),n("div",{staticClass:"file-name__full"},[e._v(e._s(e.file.name))])])])},te=[],ne={props:{id:String,parent:_,file:_},data:function(){return{image:null}},computed:{icon:function(){switch(this.file.type){case p.Folder:return Icons["folder"];case p.Audio:return Icons["audio"];case p.Video:return Icons["video"];case p.Image:return Icons["image"];case p.Text:return Icons["text"];case p.Zip:return Icons["zip"];case p.PDF:return Icons["pdf"];case p.Word:return Icons["word"];case p.Excel:return Icons["excel"];case p.PPT:return Icons["ppt"];case p.Code:return Icons["code"];default:return Icons["default"]}},isNormal:function(){return this.file.state===m.Normal},isUploading:function(){return this.file.state===m.Uploading},isWaiting:function(){return this.file.state===m.Waiting},isUploadFail:function(){return this.file.state===m.UploadFail}},methods:{open:function(){console.log("open",this.file),this.file.state===m.Normal&&this.$emit("dblclick",this.file)},contextmenu:function(e){(this.isWaiting||this.isUploading)&&this.$store.commit("appendMenuItem",{name:"取消上传",click:this.click}),this.$store.commit("contextmenu",{e:e,id:this.id,file:this.file})},click:function(){var e=this;if(!this.isNormal&&!this.isUploading)if(console.log("file click",{isWaiting:this.isWaiting,isUploadFail:this.isUploadFail}),this.isWaiting)this.$confirm("取消上传 ".concat(this.file.name," ？")).then(function(){e.$store.commit("cancelUploadFile",e.file)}).catch(function(){});else if(this.isUploadFail){var t=this.file.reason||"";this.$confirm("上传失败原因：".concat(t),"再次尝试上传 ".concat(this.file.name," ？")).then(function(){var t=e.$store.getters.getUploadingDataByFile(e.file);t&&e.$store.commit("uploadQueuePush",t)}).catch(function(){})}},loadThumbnail:function(){var e=this;if(this.image=null,this.file.state===m.Normal&&this.file.type===p.Image&&this.file.thumbnail){var t=new Image;t.src=this.file.thumbnail,t.addEventListener("load",function(){e.image=e.file.thumbnail})}}},watch:{file:function(){this.loadThumbnail()}},mounted:function(){this.loadThumbnail()}},ie=ne,re=(n("fa96"),Object(U["a"])(ie,ee,te,!1,null,"3c391254",null)),ae=re.exports,se=Object.freeze({FileUploaded:Symbol("uploaded"),FileDeleted:Symbol("deleted")}),oe=function(){function e(t,n,i){Object(d["a"])(this,e),this.id=Date.now().toString(32),this.user=t,this.file=n,this.z=i,this.events={}}return Object(f["a"])(e,[{key:"addEventListener",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(this.events[e]){var n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}},{key:"trigger",value:function(e,t){this.events[e]&&this.events[e].forEach(function(e){return e(t)})}},{key:"clearEventListener",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?this.events[e]=[]:this.events={}}}]),e}();function ce(e,t){return le.apply(this,arguments)}function le(){return le=Object(s["a"])(regeneratorRuntime.mark(function e(t,n){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=n||"",i=[],!t.isFile){e.next=7;break}return e.next=5,new Promise(function(e){t.file(function(t){var n=new _(t.name,t.type);n.file=t,i.push(n),e()})});case 5:e.next=10;break;case 7:if(!t.isDirectory){e.next=10;break}return e.next=10,new Promise(function(e){t.createReader().readEntries(function(){var r=Object(s["a"])(regeneratorRuntime.mark(function r(a){var s;return regeneratorRuntime.wrap(function(r){while(1)switch(r.prev=r.next){case 0:s=0;case 1:if(!(s<a.length)){r.next=13;break}return r.t0=i.push,r.t1=i,r.t2=H["a"],r.next=7,ce(a[s],n+t.name+"/");case 7:r.t3=r.sent,r.t4=(0,r.t2)(r.t3),r.t0.apply.call(r.t0,r.t1,r.t4);case 10:s++,r.next=1;break;case 13:e();case 14:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())});case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}},e)})),le.apply(this,arguments)}var ue={extends:S,name:"window-folder",components:{FileIcon:ae},props:["id","user","file"],data:function(){return{loading:!1,isDragEnter:!1,files:[]}},watch:{file:function(){this.files.length=0,this.load()}},computed:{uploading:function(){return this.$store.getters.getUploading(this.user,this.file.path)},waiting:function(){return this.$store.getters.getUploading(this.user,this.file.path,m.Waiting)},uploadFails:function(){return this.$store.getters.getUploading(this.user,this.file.path,m.UploadFail)},queueConcurrency:{get:function(){return this.$store.getters.getUploadQueueConcurrency},set:function(e){console.log("改变队列数量",e),this.$store.commit("setUploadQueueConcurrency",e)}},uploadCount:function(){var e=this;return this.$store.state.uploading.filter(function(t){var n=t.path;return n===e.parent.path}).length}},methods:{paste:function(e){console.log("粘贴事件",e);var t=e.clipboardData||e.originalEvent.clipboardData;t.items&&console.log("粘贴板有内容",t.items.length)},dragEnter:function(){this.isDragEnter||(this.isDragEnter=!0)},dragLeave:function(e){e.target===this.$refs.dragLeave&&(this.isDragEnter=!1)},click_upload:function(e){var t=this.$refs.fileInput;"folder"===e?(t.setAttribute("webkitdirectory",""),t.setAttribute("directory","")):(t.removeAttribute("webkitdirectory"),t.removeAttribute("directory")),this.$refs.fileInput.click()},selectUploadFiles:function(e){for(var t=this,n="/"===this.file.path?this.file.path:this.file.path+"/",i=e.target.files,r=function(e){var r=i[e];console.log("input file",r);var a=new _(r.name,n+r.webkitRelativePath,r.type);a.file=r;var s=Object(h["findIndex"])(t.files,{path:r.path,name:r.name});s>-1&&t.$confirm("".concat(r.name," 已经存在，是否覆盖？")).then(function(){t.$store.commit("uploadFile",{id:t.id,path:t.file.path,file:r})}).catch(function(){}),t.$store.commit("uploadFile",{id:t.id,path:t.file.path,file:a})},a=0;a<i.length;a++)r(a)},dropFile:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,i,r,a,s,o,c,l=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.isDragEnter=!1,n="/"===this.file.path?this.file.path:this.file.path+"/",i=t.dataTransfer.items,r=[],a=0;case 4:if(!(a<i.length)){e.next=17;break}if(s=i[a].webkitGetAsEntry(),o=i[a].getAsFile(),!s){e.next=13;break}return e.next=9,ce(s,n);case 9:c=e.sent,c.forEach(function(e){r.push(e)}),e.next=14;break;case 13:o&&r.push(new _(o.name,n,o.type));case 14:a++,e.next=4;break;case 17:r.forEach(function(e){e.path=n+e.path,e.type=p.Normal,console.log("drop file 新文件",e.path,e.name);var t=Object(h["findIndex"])(l.files,{path:e.path,name:e.name});t>-1?l.$confirm("".concat(e.name," 已经存在，是否覆盖？")).then(function(){l.$store.commit("uploadFile",{id:l.id,path:l.file.path,file:e})}).catch(function(){}):l.$store.commit("uploadFile",{id:l.id,path:l.file.path,file:e})});case 18:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),open:function(e){this.$emit("open",e)},loadContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,a=this,s=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]&&s[0],n="","/"!==this.file.path&&(n=":".concat(this.file.path,":")),n+="/children?expand=thumbnails",e.next=6,this.$store.dispatch("load",{user:this.user,path:n,force:t});case 6:i=e.sent,r=i.data,this.files=r.value.map(function(e){var t=Object(K["join"])(a.file.path,e.name),n=new _(e.name,t);return n.state=m.Normal,n.setFromData(e),n.setType(),n});case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),removeFile:function(e){var t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)},fileUploaded:function(e){var t=Object(h["findIndex"])(this.files,{name:e.name});t>-1&&this.files.splice(t,1),this.files.push(e)},clearWaiting:function(){var e=this;this.$confirm("确认清空等待上传的任务？").then(function(){e.$store.commit("clearUploadingFile",m.Waiting)}).catch(function(){})},clearUploadFail:function(){var e=this;this.$confirm("确认清空上传失败的任务？").then(function(){e.$store.commit("clearUploadingFile",m.UploadFail)}).catch(function(){})}},mounted:function(){this.$store.state.windows[this.id].addEventListener(se.FileUploaded,this.fileUploaded),this.$store.state.windows[this.id].addEventListener(se.FileDeleted,this.removeFile)},beforeDestroy:function(){this.$store.state.windows[this.id]&&(this.$store.state.windows[this.id].removeEventListener(se.FileUploaded,this.fileUploaded),this.$store.state.windows[this.id].removeEventListener(se.FileDeleted,this.removeFile))}},de=ue,fe=(n("bf2b"),Object(U["a"])(de,G,J,!1,null,"1691d57e",null)),he=fe.exports,pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"loading"},[e._v("\n    读取中\n")])},me=[],ve={name:"window-loading"},ge=ve,we=(n("01bd"),Object(U["a"])(ge,pe,me,!1,null,"09339c0c",null)),ye=we.exports,be={components:{WindowLoading:ye,WindowFolder:he,WindowPlayer:Z,WindowViewer:V,WindowEditor:z},props:{id:String,user:k,file:_,z:Number},data:function(){return{loading:!1,dragging:!1,zIndex:0,active:!0,history:[],historyIndex:0}},methods:{upload:function(e){!1===this.loading&&this.$refs["content"].click_upload&&this.$refs["content"].click_upload(e)},close:function(){this.$store.commit("closeWindow",this.id)},focus:function(){this.$store.state.activeID!==this.id&&this.$store.commit("windowSetTop",this.id)},blur:function(){},loadFinish:function(){this.loading=!1},load:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n=this,i=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]&&i[0],this.loading=!0,this.$nextTick(function(){n.$refs["content"].load(t)});case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),open:function(e){this.loading||(this.history.splice(this.historyIndex+1),this.append(e),this.historyIndex++,this.load())},go:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(!this.loading){var t=this.historyIndex+e;t>=0&&t<this.history.length&&(this.historyIndex+=e)}},append:function(e){this.history.push(e)}},computed:{current:function(){return this.history[this.historyIndex]},showFolder:function(){return this.current.type===p.Folder},showPlayer:function(){return-1!==[p.Video,p.Audio].indexOf(this.current.type)},showEditor:function(){return-1!==[p.Code,p.Text].indexOf(this.current.type)},showViewer:function(){return-1!==[p.Image].indexOf(this.current.type)}},beforeMount:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.append(this.file),e.next=3,this.load();case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),watch:{},mounted:function(){var e=this,t=$(this.$el),n=t.find(".window--head");t.mousedown(function(){e.focus()}).draggable({handle:n,cancel:".controller",start:function(){e.focus(),e.dragging=!0},stop:function(){e.dragging=!1}}).resizable({minHeight:150,minWidth:200,start:function(){},stop:function(){e.dragging=!1}})}},xe=be,_e=(n("09f0"),Object(U["a"])(xe,l,u,!1,null,"3ccce272",null)),ke=_e.exports,$e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user",on:{dblclick:e.open}},[n("div",{staticClass:"user-icon"},[n("svg",{staticClass:"icon main-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+e.icon}})]),e.user.lock?n("svg",{staticClass:"icon lock-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_lock"}})]):e._e()]),n("div",{staticClass:"user-name"},[e._v(e._s(e.user.name))])])},Ce=[],Fe={props:{user:k},data:function(){return{icon:Icons["user"]}},methods:{open:function(){this.$store.commit("createWindow",{user:this.user,file:new _("/","/"),active:!0})}}},Oe=Fe,je=(n("5b32"),Object(U["a"])(Oe,$e,Ce,!1,null,"5cab2d21",null)),Ie=je.exports,Ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.value?n("div",{staticClass:"contextmenu full",style:{"z-index":e.$store.state.z},on:{click:e.hide,contextmenu:function(t){return t.preventDefault(),e.hide(t)}}},[n("div",{staticClass:"contextmenu-list",style:{left:e.offsetX,top:e.offsetY}},e._l(e.list,function(t,i){return n("div",{key:i,on:{click:t.click}},[e._v(e._s(t.name))])}),0)]):e._e()},Ue=[],De={name:"contextmenu",props:["value","x","y","id","file"],data:function(){return{list:[]}},methods:{hide:function(){this.$emit("input",!1),this.$store.state.menuExtraItems.length=0}},computed:{offsetX:function(){return this.x+2+"px"},offsetY:function(){return this.y+2+"px"}},watch:{file:function(){var e,t=this;this.list.length=0,this.file.state===m.Normal&&([p.Folder,p.Text,p.Code,p.Image,p.Video,p.Audio].indexOf(this.file.type)>-1&&this.list.push({name:"新窗口打开",click:function(){t.$store.commit("createWindowFromMenu",{file:t.file})}}),this.file.type!==p.Folder&&this.list.push({name:"下载文件",click:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:alert("下载文件");case 1:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()}),this.list.push({name:"删除文件",click:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.$confirm("确认删除文件 ".concat(t.file.name," ?")).then(Object(s["a"])(regeneratorRuntime.mark(function e(){var n,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.$store.state.windows[t.id],i=n.user,e.next=4,t.$http({method:"delete",url:"/admin/api/"+i.id+"?path="+t.file.path});case 4:r=e.sent,t.$notify.success("成功删除 ".concat(t.file.name)),200===r.status&&n.trigger(se.FileDeleted,t.file);case 7:case"end":return e.stop()}},e)}))).catch(function(){});case 1:case"end":return e.stop()}},e)}));function n(){return e.apply(this,arguments)}return n}()})),(e=this.list).push.apply(e,Object(H["a"])(this.$store.state.menuExtraItems))}}},Se=De,Re=(n("9d69"),Object(U["a"])(Se,Ee,Ue,!1,null,"52c0c62a",null)),Te=Re.exports,We={components:{Contextmenu:Te,UserIcon:Ie,Window:ke},data:function(){return{defaultProps:{children:"children",label:"label"},users:[]}},computed:{windows:function(){return this.$store.state.windows},menu:function(){return this.$store.state.menu}},methods:{},beforeMount:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.$store.commit("setVueInstance",this),e.next=3,this.$store.dispatch("api",{url:c.accounts});case 3:for(n in t=e.sent,this.users.length=0,t.data)i=t.data[n],r=new k(i.id,i.name),this.users.push(r);window.addEventListener("beforeunload",function(e){if(a.$store.state.uploadingLength>0){var t="\\o/";return(e||window.event).returnValue=t,t}});case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},ze=We,Pe=(n("6c2e"),Object(U["a"])(ze,r,a,!1,null,"246a2af6",null)),Le=Pe.exports,Ne=n("2f62"),Ae=n("4230"),Me=n("17d4"),Ve=n.n(Me),Qe=n("bc3a");i["default"].use(Ne["a"]);var qe,Be=Ve()(function(e,t){var n=e.user,i=e.file;i.state=e.state=m.Uploading;var r=new FormData,a=Ae["a"].uploadFile+"/"+n.id+"?type=file&path="+i.path+"/"+i.name;r.append("file",i.file),Qe({method:"post",url:a,data:r,headers:{"Content-Type":"multipart/form-data"}}).then(function(e){console.log("SUCCESS!!",e.data),i.setFromData(e.data),i.setType(),qe.$notify.success({title:"上传成功",message:i.name}),t&&t(!0)}).catch(function(e){console.log("FAILURE!!",e.response),i.reason=e.response.data,qe.$notify.error({title:"上传失败",message:i.name}),t&&t(!1)})},5),Xe=new Ne["a"].Store({state:{z:1,windows:{},menu:{show:!1,x:0,y:0,id:null,file:null},menuExtraItems:[],activeID:null,error:null,cache:{},uploading:[],uploadingLength:0,uploadQueueConcurrency:Be.concurrency},getters:{getUploading:function(e){return function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.Uploading;return e.uploading.filter(function(e){return e.user===t&&e.path===n&&e.state===i})}},getUploadingDataByFile:function(e){return function(t){var n=Object(h["findIndex"])(e.uploading,["file",t]);return n>-1?e.uploading[n]:null}},getUploadQueueConcurrency:function(e){return e.uploadQueueConcurrency}},mutations:{setVueInstance:function(e,t){qe=t},setUploadQueueConcurrency:function(e,t){e.uploadQueueConcurrency=t,Be.concurrency=t,console.log("改变后",Be.concurrency)},setError:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"错误";e.error={title:n,content:t.data}},setCache:function(e,t){var n=t.url,i=t.res;e.cache[n]=i},createWindow:function(e,t){var n=t.user,r=t.file,a=t.active,s=void 0!==a&&a;console.log("createWindow");var o=new oe(n,r,e.z);i["default"].set(e.windows,o.id,o),e.z++,s&&(e.activeID=o.id)},createWindowFromMenu:function(e,t){var n=t.file;this.commit("createWindow",{user:e.windows[e.menu.id].user,file:n,active:!0})},contextmenu:function(e,t){var n=t.e,i=t.id,r=t.file;console.log("右键",n,i,r),e.menu.show=!0,e.menu.x=n.clientX,e.menu.y=n.clientY,e.menu.file=r,e.menu.id=i},appendMenuItem:function(e,t){var n=t.name,i=t.click;e.menuExtraItems.push({name:n,click:i})},clearWindow:function(e){e.windows={}},closeWindow:function(e,t){e.windows[t].clearEventListener(),i["default"].delete(e.windows,t)},windowSetTop:function(e,t){e.activeID=t,e.windows[t].z=e.z;var n=Object(h["sortBy"])(e.windows,"z");n.forEach(function(e){var t=n.indexOf(e);e.z=t+1}),e.z=n.length+1},uploadFile:function(e,t){var n=t.id,i=t.path,r=t.file,a=e.windows[n].user,s={id:n,user:a,path:i,file:r,state:m.Waiting};this.commit("uploadQueuePush",s)},cancelUploadFile:function(e,t){var n=this.getters.getUploadingDataByFile(t);n>-1&&e.uploading.splice(n,1)},uploadQueuePush:function(e,t){var n=t.id,i=t.file,r=e.uploading.indexOf(t);r>-1&&e.uploading.splice(r,1),e.uploading.push(t),i.state=t.state=m.Waiting,Be.push(t,function(r){console.log("上传结果",i.path,r);var a=e.uploading.indexOf(t);a>-1&&e.uploading.splice(a,1),r?(i.state=m.Normal,e.windows[n].trigger(se.FileUploaded,i)):(i.state=t.state=m.UploadFail,e.uploading.push(t))})},clearUploadingFile:function(e,t){e.uploading=e.uploading.filter(function(e){var n=e.file;return n.state!==t})}},actions:{api:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Qe(n);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e["catch"](0),t.commit("setError",e.t0.response),e.abrupt("return",null);case 10:case"end":return e.stop()}},e,null,[[0,6]])}));function t(t,n){return e.apply(this,arguments)}return t}(),load:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t,n){var i,r,a,s,o,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=n.user,r=n.path,a=n.force,s=void 0!==a&&a,o=c.loadFile+"/"+i.id+"?path="+r,console.log("load",o,s),!t.state.cache[o]||s){e.next=5;break}return e.abrupt("return",t.state.cache[o]);case 5:return e.next=7,Qe.get(o);case 7:return l=e.sent,200===l.status&&t.commit("setCache",{url:o,res:l}),e.abrupt("return",l);case 10:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}()}}),Ye=(n("e008"),n("5c96")),Ze=n.n(Ye);n("0fae");i["default"].config.productionTip=!1,i["default"].use(Ze.a),i["default"].prototype.$http=n("bc3a"),new i["default"]({store:Xe,render:function(e){return e(Le)}}).$mount("#app")},e008:function(e,t,n){},fa96:function(e,t,n){"use strict";var i=n("bd9a"),r=n.n(i);r.a},fea1:function(e,t,n){}});