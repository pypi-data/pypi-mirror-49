(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{2368:function(t,e,a){"use strict";a.r(e);var s=a(11),i=a.n(s),r=a(177),n=a.n(r),o=a(1),c=a.n(o),h=a(0),l=a.n(h),d=a(18),u=a.n(d),g=a(17),p=a.n(g),f=a(9),m=a(225),v=a(340),S=a(189),I=a(243),b=a.n(I),y=a(44),L=a.n(y),j=a(10),P=a(181),D=a.n(P),C=a(34),E=a.n(C),q=a(97),T=a.n(q),O=a(84),A=a.n(O),k=a(25),N=a(36),Q=a(213),V=a(139),M=a(2),_=a(37),x=a(32),H=a(129),z=a(443),G=a(245),W=a(489),B=a(67),J=a(53),U=a(33),X=a(107),F=a(752),R=a(726),K=a(145),Y=a(750),Z=a(593),$=a(751),w=a(436),tt=a(242),et=a(217),at=a(14),st=new Set(["14d","24h"]),it=p()({displayName:"Stream",propTypes:{environment:f.default.Environment,tags:c.a.object,tagsLoading:c.a.bool},mixins:[u.a.listenTo(B.a,"onGroupChange"),_.default,m.a],getInitialState:function(){var t=this.props.params.searchId||null,e=this.getProject(),a=D.a.get("realtimeActive"),s=void 0===a?e&&!e.firstEvent:"true"===a,i=this.props.location.query||{},r="sort"in i?i.sort:"date",n="query"in i;return{groupIds:[],isDefaultSearch:!1,searchId:n?null:t,loading:!!t||!n,savedSearchLoading:!0,savedSearchList:[],selectAllActive:!1,multiSelected:!1,anySelected:!1,statsPeriod:st.has(i.statsPeriod)?i.statsPeriod:"24h",realtimeActive:s,pageLinks:"",queryCount:null,dataLoading:!0,error:!1,query:n?i.query:"",sort:r,isSidebarVisible:!1,environment:this.props.environment}},componentWillMount:function(){var t=this.getOrganization();if(new Set(t.features).has("sentry10")){var e=this.getProject(),a=this.props.location,s=A.a.parse(a.search);s.project=e.id,j.browserHistory.replace("/organizations/".concat(t.slug,"/issues/?").concat(A.a.stringify(s)))}this._streamManager=new at.default.StreamManager(B.a),this._poller=new at.default.CursorPoller({success:this.onRealtimePoll}),this.fetchSavedSearches(),this.state.loading||this.fetchData()},componentWillReceiveProps:function(t){t.environment!==this.props.environment&&this.setState({environment:t.environment},this.fetchData);var e=t.params.searchId,a=this.state.isDefaultSearch?void 0!==e:e!==this.props.params.searchId,s=A.a.parse(this.props.location.search),i=A.a.parse(t.location.search),r=!L()(n()(s,"environment"),n()(i,"environment"));(a||r)&&this.setState(this.getQueryState(t),this.fetchData)},componentDidUpdate:function(t,e){e.realtimeActive!==this.state.realtimeActive&&(this.state.realtimeActive?this.resumePolling():this._poller.disable())},componentWillUnmount:function(){this._poller.disable(),B.a.reset()},fetchSavedSearches:function(){var t=this;this.setState({savedSearchLoading:!0});var e=this.props.params,a=e.orgId,s=e.projectId,i=this.state.searchId;Object(G.b)(this.api,a,s).then(function(e){var a={isDefaultSearch:!1,savedSearchLoading:!1,savedSearchList:e,loading:!1},s=t.state.loading;if(i){var r=e.find(function(t){return t.id===i});r?a.query=r.query:t.setState({savedSearchLoading:!1,savedSearchList:e,searchId:null,isDefaultSearch:!0},t.transitionTo)}else if(!t.hasQuery()){var n=e.find(function(t){return t.isUserDefault})||e.find(function(t){return t.isDefault});if(n){var o=et.b.getQueryEnvironment(n.query),c=H.a.getByName(o);c&&Object(V.f)(c),a.searchId=n.id,a.query=et.b.getQueryStringWithoutEnvironment(n.query),a.isDefaultSearch=!0}}t.setState(a,s?t.fetchData:null)},function(e){Object(Q.logAjaxError)(e),t.setState({loading:!1,isDefaultSearch:null,searchId:null,savedSearchList:[],savedSearchLoading:!1,query:""})})},onSavedSearchCreate:function(t){var e=this.state.savedSearchList;e.push(t),this.setState({savedSearchList:b()(e,["name"]),searchId:t.id},this.transitionTo)},onSavedSearchSelect:function(t){this.setState({searchId:t.id},this.transitionTo)},getQueryState:function(t){var e=t.location.query||{},a="query"in e,s=a?null:t.params.searchId||this.state.searchId||null,i={sort:"sort"in e?e.sort:"date",statsPeriod:st.has(e.statsPeriod)?e.statsPeriod:"24h",query:a?e.query:"",searchId:s,isDefaultSearch:!1};if(s){var r=this.state.savedSearchList.find(function(t){return t.id===s});if(r){var n=et.b.getQueryEnvironment(r.query);if(n){var o=H.a.getByName(n);Object(V.f)(o)}i.query=et.b.getQueryStringWithoutEnvironment(r.query),this.state.searchId&&!t.params.searchId&&(i.isDefaultSearch=!0)}else i.searchId=null}else if(!a){var c=this.state.savedSearchList.find(function(t){return t.isDefault});c?(i.isDefaultSearch=!0,i.searchId=c.id,i.query=c.query):i.searchId=null}return i.loading=!1,i},hasQuery:function(t){return"query"in((t=t||this.props).location.query||{})},fetchData:function(){var t=this;B.a.loadInitialData([]),this.setState({dataLoading:!0,queryCount:null,error:!1});var e=this.getGroupListEndpoint(),a=et.b.formatQueryString(this.state.query),s=this.state.environment,i={query:a,limit:25,sort:this.state.sort,statsPeriod:this.state.statsPeriod,shortIdLookup:"1"},r=et.b.getQueryEnvironment(a);null!==r?i.environment=r:s&&(i.environment=s.name);var n=this.props.location.query||{};"cursor"in n&&(i.cursor=n.cursor),this.lastRequest&&this.lastRequest.cancel(),this._poller.disable(),this.lastRequest=this.api.request(e,{method:"GET",data:i,success:function(e,s,i){if("1"===i.getResponseHeader("X-Sentry-Direct-Hit")&&e&&e[0].matchingEventId){var r=e[0],n=r.project,o=r.id,c=r.matchingEventId,h=r.matchingEventEnvironment,l="/".concat(t.props.params.orgId,"/").concat(n.slug,"/issues/").concat(o,"/events/").concat(c,"/");return void 0!==h&&(Object(V.g)(h),l="".concat(l,"?").concat(A.a.stringify({environment:h}))),void j.browserHistory.replace(l)}t._streamManager.push(e);var d=i.getResponseHeader("X-Hits"),u=i.getResponseHeader("X-Max-Hits");t.setState({error:!1,dataLoading:!1,query:a,queryCount:void 0!==d&&parseInt(d,10)||0,queryMaxCount:void 0!==u&&parseInt(u,10)||0,pageLinks:i.getResponseHeader("Link")})},error:function(e){t.setState({error:Object(w.a)(e),dataLoading:!1})},complete:function(e){t.lastRequest=null,t.resumePolling()}})},resumePolling:function(){if(this.state.pageLinks){var t=Object(tt.a)(this.state.pageLinks);t&&!t.previous.results&&this.state.realtimeActive&&(this._poller.setEndpoint(t.previous.href),this._poller.enable())}},getGroupListEndpoint:function(){var t=this.props.params;return"/projects/"+t.orgId+"/"+t.projectId+"/issues/"},onRealtimeChange:function(t){D.a.set("realtimeActive",t.toString()),this.setState({realtimeActive:t})},onSelectStatsPeriod:function(t){t!=this.state.statsPeriod&&this.setState({statsPeriod:t},function(){this.transitionTo()})},onRealtimePoll:function(t,e){this._streamManager.unshift(t),at.default.valueIsEqual(this.state.pageLinks,e,!0)||this.setState({pageLinks:e})},onGroupChange:function(){var t=this._streamManager.getAllItems().map(function(t){return t.id});at.default.valueIsEqual(t,this.state.groupIds)||this.setState({groupIds:t})},onSearch:function(t){var e=this;if(t===this.state.query)this.fetchData();else{var a=et.b.getQueryEnvironment(t);if(null!==a){var s=H.a.getByName(a);Object(V.f)(s)}t=et.b.getQueryStringWithoutEnvironment(t),this.setState({query:t,searchId:null},this.transitionTo)}if(this.state.savedSearchList.map(function(t){return t.query==e.state.query}).length>0){var i=this.props.params,r=i.orgId,n=i.projectId;Object(N.b)("issue.search",{query:this.state.query,organization_id:r,project_id:n})}},onSortChange:function(t){this.setState({sort:t},this.transitionTo)},onSidebarToggle:function(){var t=this.getOrganization();this.setState({isSidebarVisible:!this.state.isSidebarVisible}),Object(N.b)("issue.search_sidebar_clicked",{org_id:parseInt(t.id,10)})},allResultsVisible:function(){if(!this.state.pageLinks)return!1;var t=Object(tt.a)(this.state.pageLinks);return t&&!t.previous.results&&!t.next.results},transitionTo:function(){var t={};this.props.location.query.environment&&(t.environment=this.props.location.query.environment),this.state.searchId||(t.query=this.state.query),"date"!==this.state.sort&&(t.sort=this.state.sort),"24h"!==this.state.statsPeriod&&(t.statsPeriod=this.state.statsPeriod);var e=this.props.params,a=this.state.searchId?"/".concat(e.orgId,"/").concat(e.projectId,"/searches/").concat(this.state.searchId,"/"):"/".concat(e.orgId,"/").concat(e.projectId,"/");j.browserHistory.push({pathname:a,query:t})},renderGroupNodes:function(t,e){var a=this,s=new Date(x.default.get("user").dateJoined),i=new Date;i.setDate(i.getDate()-30);var r=t[0],n=this.props.params.orgId,o=t.map(function(t){var o=s>i&&t===r;return l.a.createElement(Z.a,{key:t,id:t,orgId:n,statsPeriod:e,query:a.state.query,hasGuideAnchor:o})});return l.a.createElement(k.c,{className:"ref-group-list"},o)},renderAwaitingEvents:function(){var t=this.getOrganization(),e=this.getProject(),a=this.state.groupIds.length>0?this.state.groupIds[0]:"";return l.a.createElement(z.a,{org:t,project:e,sampleIssueId:a,gradient:!0})},renderEmpty:function(){var t=this.state.environment,e=t?Object(M.tct)("Sorry no events match your filters in the [env] environment.",{env:t.displayName}):Object(M.t)("Sorry, no events match your filters.");return l.a.createElement(K.a,null,l.a.createElement("p",null,e))},renderLoading:function(){return l.a.createElement(U.default,null)},renderStreamBody:function(){var t=this.getProject();return t.firstEvent&&x.default.set("sentFirstEvent",t.firstEvent),this.state.dataLoading?this.renderLoading():this.state.error?l.a.createElement(J.default,{message:this.state.error,onRetry:this.fetchData}):this.state.groupIds.length>0?this.renderGroupNodes(this.state.groupIds,this.state.statsPeriod):t.firstEvent?this.renderEmpty():this.renderAwaitingEvents()},tagValueLoader:function(t,e){var a=this.props.params.orgId,s=this.getProject();return Object(W.b)(this.api,a,s.slug,t,e)},render:function(){if(this.state.loading)return this.renderLoading();var t=["stream-row"];this.state.isSidebarVisible&&t.push("show-sidebar");var e=this.context.organization,a=this.state.searchId,s=this.getProjectFeatures(),i=this.getProject(),r={projects:[i.id],environments:this.state.environment?[this.state.environment.name]:[],datetime:{start:null,end:null,period:null,utc:null}};return l.a.createElement(T.a,{title:"Issues - ".concat(i.slug," - ").concat(e.name," - Sentry")},l.a.createElement("div",{className:E()(t)},l.a.createElement("div",{className:"stream-content"},l.a.createElement(Y.a,{organization:e,projectId:i.slug,query:this.state.query,sort:this.state.sort,searchId:a,queryCount:this.state.queryCount,queryMaxCount:this.state.queryMaxCount,onSortChange:this.onSortChange,onSearch:this.onSearch,onSavedSearchCreate:this.onSavedSearchCreate,onSavedSearchSelect:this.onSavedSearchSelect,onSavedSearchDelete:function(){},onSidebarToggle:this.onSidebarToggle,isSearchDisabled:this.state.isSidebarVisible,savedSearchList:this.state.savedSearchList,tagValueLoader:this.tagValueLoader,tags:this.props.tags}),l.a.createElement(k.a,null,l.a.createElement(R.a,{orgId:e.slug,projectId:i.slug,selection:r,hasReleases:s.has("releases"),latestRelease:this.context.project.latestRelease,environment:this.state.environment,query:this.state.query,queryCount:this.state.queryCount,onSelectStatsPeriod:this.onSelectStatsPeriod,onRealtimeChange:this.onRealtimeChange,realtimeActive:this.state.realtimeActive,statsPeriod:this.state.statsPeriod,groupIds:this.state.groupIds,allResultsVisible:this.allResultsVisible()}),l.a.createElement(k.c,null,l.a.createElement(F.a,{organization:e,projectIds:r.projects}),this.renderStreamBody())),l.a.createElement(X.default,{pageLinks:this.state.pageLinks})),l.a.createElement($.a,{loading:this.props.tagsLoading,tags:this.props.tags,query:this.state.query,onQueryChange:this.onSearch,orgId:e.slug,projectId:i.slug,tagValueLoader:this.tagValueLoader})))}}),rt=p()({displayName:"StreamContainer",propTypes:{environment:f.default.Environment,setProjectNavSection:c.a.func},mixins:[m.a,u.a.listenTo(v.a,"onTagsChange")],getInitialState:function(){return{tags:v.a.getAllTags(),tagsLoading:!0}},componentWillMount:function(){var t=this.props.params,e=t.orgId,a=t.projectId;this.props.setProjectNavSection("stream"),Object(W.c)(e,a)},onTagsChange:function(t){this.setState({tags:t,tagsLoading:!1})},filterTags:function(t){return n()(t,"environment")},render:function(){var t=this.filterTags(this.state.tags);return l.a.createElement(it,i()({tags:t,tagsLoading:this.state.tagsLoading},this.props))}});e.default=Object(S.a)(rt)}}]);
//# sourceMappingURL=Stream.js.map