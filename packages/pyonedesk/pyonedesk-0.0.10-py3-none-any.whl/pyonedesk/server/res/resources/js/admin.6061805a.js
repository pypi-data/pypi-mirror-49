(function(t){function e(e){for(var r,c,i=e[0],s=e[1],u=e[2],d=0,f=[];d<i.length;d++)c=i[d],a[c]&&f.push(a[c][0]),a[c]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);l&&l(e);while(f.length)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(r=!1)}r&&(o.splice(e--,1),t=c(c.s=n[0]))}return t}var r={},a={admin:0},o=[];function c(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=t,c.c=r,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)c.d(n,r,function(e){return t[e]}.bind(null,r));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=s;o.push([1,"chunk-vendors"]),n()})({"0c66":function(t,e,n){"use strict";var r=n("7ece"),a=n.n(r);a.a},1:function(t,e,n){t.exports=n("aa5a")},"277e":function(t,e,n){"use strict";var r=n("539f"),a=n.n(r);a.a},"32aa":function(t,e,n){},"539f":function(t,e,n){},"7ece":function(t,e,n){},aa5a:function(t,e,n){"use strict";n.r(e);n("14c6"),n("08c1"),n("4842"),n("d9fc");var r,a=n("a026"),o=n("8c4f"),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a",{attrs:{href:"https://github.com/gzlock/pyonedesk",target:"_blank"}},[n("el-button",{attrs:{type:"text"}},[t._v("Github项目")])],1)])},i=[],s={mounted:function(){}},u=s,l=n("2877"),d=Object(l["a"])(u,c,i,!1,null,"3c6a0730",null),f=d.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"container"},[n("el-form",{ref:"clientForm",attrs:{"label-width":"80px",model:t.form,rules:t.rules,"label-position":t.$store.state.labelPosition}},[n("el-form-item",{attrs:{label:"别名",prop:"name"}},[n("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"应用名称"}},[t._v("\n            "+t._s(t.appName)+"\n        ")]),n("el-form-item",[t._v("\n            没有【应用ID】和【应用机密钥匙】？立即\n            "),n("create-app-button",{attrs:{account:t.form}}),n("br"),t._v("\n            创建途中一定要记录下应用ID和应用机密钥匙，并填入到输入框。\n        ")],1),n("el-form-item",{attrs:{label:"应用 ID",prop:"client_id"}},[n("el-input",{ref:"client_id",model:{value:t.form.client_id,callback:function(e){t.$set(t.form,"client_id",e)},expression:"form.client_id"}},[n("el-button",{attrs:{slot:"prepend"},on:{click:function(e){return t.paste("client_id")}},slot:"prepend"},[t._v("粘贴")])],1)],1),n("el-form-item",{attrs:{label:"应用机密",prop:"client_secret"}},[n("el-input",{ref:"client_secret",model:{value:t.form.client_secret,callback:function(e){t.$set(t.form,"client_secret",e)},expression:"form.client_secret"}},[n("el-button",{attrs:{slot:"prepend"},on:{click:function(e){return t.paste("client_secret")}},slot:"prepend"},[t._v("粘贴")])],1)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",disabled:t.disabled},on:{click:t.submit}},[t._v("下一步")])],1)],1)],1)},m=[],h=(n("a481"),n("96cf"),n("3b8d")),v=(n("7f7f"),n("ac6a"),n("456d"),"/admin/api"),b={accountsList:v+"/accounts",createAccountID:v+"/account/create_id",addAccount:v+"/accounts/add",addAccountName:v+"/accounts/add",deleteAccount:v+"/accounts/delete",account:v+"/account",goCreateAppUrl:v+"/go_create_app",goGetCode:v+"/go_get_code"},_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-button",{attrs:{disabled:0===t.account.name.length},on:{click:t.open}},[t._v("创建微软应用")])},g=[],w={props:["account"],computed:{href:function(){return"".concat(b.goCreateAppUrl,"/").concat(this.account.id,"/").concat(this.account.name)}},methods:{open:function(){window.open(this.href)}}},y=w,x=Object(l["a"])(y,_,g,!1,null,"7ace1988",null),k=x.exports,$={components:{CreateAppButton:k},data:function(){var t=this;return{loading:!0,form:{id:"",name:"",client_id:"",client_secret:"",code:""},rules:{name:[{required:!0,message:"请输入账号别名",trigger:"blur"},{trigger:"blur",validator:function(e,n,r){n=n.trim(),console.log("account",t.accounts);var a=Object.keys(t.accounts);console.log("keys",a);for(var o=0;o<a.length;o++){var c=t.accounts[a[o]];if(c.name===n)return r(new Error("已经有相同别名的账号了"))}r()}}],client_id:[{required:!0,message:"请输入应用ID",trigger:"blur"}],client_secret:[{required:!0,message:"请输入应用机密钥匙",trigger:"blur"}]}}},computed:{accounts:function(){return this.$store.state.accounts},appName:function(){return"PyOneDrive-"+this.form.name},disabled:function(){return 0===this.form.name.length||0===this.form.client_id.length||0===this.form.client_secret.length||this.loading}},methods:{paste:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.clipboard.readText();case 2:this.form[e]=t.sent;case 3:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),submit:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.loading=!0,this.$refs["clientForm"].validate(function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(n){var r,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$store.dispatch("api",{url:b.addAccount,method:"post",data:e.form});case 4:r=t.sent,a=r.data,e.$store.state.accounts[a.id]=a,e.loading=!1,e.$message({message:"成功添加账号，但还有最后一步操作",type:"success"}),e.$router.replace({name:"edit",params:{id:a.id}});case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,this.$store.dispatch("api",{url:b.createAccountID});case 3:e=t.sent,n=e.data,this.form.id=n.id,this.loading=!1;case 7:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},O=$,j=(n("0c66"),Object(l["a"])(O,p,m,!1,null,"ca2735b0",null)),C=j.exports,S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[n("el-tabs",{attrs:{type:"border-card"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"账号容量",name:"quota",disabled:!t.account.has_token}},[n("el-form",{attrs:{"label-width":"120px"}},[n("el-form-item",{attrs:{label:"别名"}},[t._v(t._s(t.account.name))]),n("el-form-item",{attrs:{label:"账号状态"}},[t._v(t._s(t.account.quota.state))]),n("el-form-item",{attrs:{label:"总容量"}},[t._v(t._s(t.bytesToSize(t.account.quota.total)))]),n("el-form-item",{attrs:{label:"可用容量"}},[t._v(t._s(t.bytesToSize(t.account.quota.remaining)))]),n("el-form-item",{attrs:{label:"已经使用容量"}},[t._v(t._s(t.bytesToSize(t.account.quota.used)))]),n("el-form-item",{attrs:{label:"回收站占用容量"}},[t._v(t._s(t.bytesToSize(t.account.quota.deleted)))])],1)],1),n("el-tab-pane",{attrs:{label:"账号管理",name:"info"}},[n("el-form",{attrs:{"label-width":"100px","label-position":t.$store.state.labelPosition}},[n("el-form-item",{attrs:{label:"默认账号"}},[n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.account.default,callback:function(e){t.$set(t.account,"default",e)},expression:"account.default"}})],1),n("el-form-item",{attrs:{label:"别名"}},[t._v(t._s(t.account.name)+"\n                    "),n("a",{attrs:{href:"https://apps.dev.microsoft.com/#/application/"+t.account.client_id,target:"_blank"}},[n("el-button",{attrs:{type:"text"}},[t._v("前往微软网站管理应用")])],1)]),n("el-form-item",{attrs:{label:"应用名称"}},[t._v("PyOneDrive-"+t._s(t.account.name))]),n("el-form-item",{attrs:{label:"应用ID"}},[t._v(t._s(t.account.client_id))]),n("el-form-item",{attrs:{label:"应用机密钥匙"}},[n("el-input",{model:{value:t.account.client_secret,callback:function(e){t.$set(t.account,"client_secret",e)},expression:"account.client_secret"}})],1),n("el-form-item",{attrs:{label:"重定向URL"}},[t._v("\n                    "+t._s(t.account.url)+"\n                ")]),t.account.has_token?n("el-form-item",{attrs:{label:"refresh_token"}},[n("el-input",{attrs:{value:t.account.refresh_token,disabled:""}})],1):t._e(),n("el-form-item",[t.account.has_token?[t._v("\n                        重新获取Code"),n("br")]:[n("div",{staticClass:"red",attrs:{slot:"label"},slot:"label"},[t._v("最后一步")]),t._v("\n                        前往微软网站获取应用Code"),n("br")],n("get-code-view",{attrs:{account:t.account},on:{success:t.get_code_finish}})],2),n("el-form-item",{attrs:{label:"操作"}},[n("el-button",{attrs:{type:"danger"},on:{click:t.deleteAccount}},[t._v("⚠️删除账号")])],1)],1)],1)],1)],1)},R=[],M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[1===t.state?[n("i",{staticClass:"el-icon-loading"}),t._v("正在等待结果\n    ")]:2===t.state?[n("i",{staticClass:"el-icon-success",staticStyle:{color:"green"}}),t._v("接收 Code 成功！\n    ")]:[3===t.state?n("div",[n("i",{staticClass:"el-icon-error",staticStyle:{color:"red"}}),t._v("接收到的 Code 无效，请重试！\n        ")]):4===t.state?n("div",[n("i",{staticClass:"el-icon-error",staticStyle:{color:"red"}}),t._v("接收 Code 超时，请重试！\n        ")]):t._e(),n("el-button",{attrs:{type:"primary"},on:{click:t.addLocalStorageListener}},[t._v("前往微软网站获取Code")])]],2)},A=[],D=(n("c5f6"),{props:["account"],data:function(){return{state:0}},methods:{addLocalStorageListener:function(){var t,e=this;window.open(this.href),this.state=1,window.localStorage.removeItem(this.account.id);var n=function n(r){console.log("localstorage",r),"timeout"===r?e.state=4:r&&r.key===e.account.id&&1===Number(r.newValue)?(e.state=2,e.$emit("success")):e.state=3,window.removeEventListener("storage",n),clearTimeout(t)};window.addEventListener("storage",n),t=setTimeout(function(){n("timeout")},1e4)}},computed:{href:function(){return b.goGetCode+"/"+this.account.id}}}),E=D,T=Object(l["a"])(E,M,A,!1,null,"bc1f3220",null),q=T.exports,N={components:{GetCodeView:q},data:function(){return{loading:!0,activeName:"",account:{quota:{}},hideToken:!0}},computed:{id:function(){return this.$route.params.id},tokenString:function(){return JSON.stringify(this.account.token,null,4)}},watch:{"$route.params.id":function(){console.log("$route.params.id","有变化"),this.load()}},methods:{load:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){var e,n,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return r&&r(),this.loading=!0,t.next=4,this.$store.dispatch("api",{url:b.account+"/"+this.id});case 4:e=t.sent,e&&(this.account=e.data,n=this.$store.state.accounts,n[this.account.id]=this.account,this.$store.commit("setAccounts",n),this.loading=!1,this.activeName=this.account.has_token?"quota":"info",this.$nextTick(function(){r=a.$watch("account",Object(h["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a.$store.dispatch("api",{method:"post",url:b.account+"/"+a.account.id,data:a.account});case 2:e=a.account.default?a.account.id:"",a.$store.commit("updateDefaultAccount",e);case 4:case"end":return t.stop()}},t)})),{deep:!0})}));case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),bytesToSize:function(t){if(0===t)return"0 B";var e=1024,n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,r)).toPrecision(3)+" "+n[r]},deleteAccount:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$confirm("确认删除账号："+this.account.name+"?","请确认",{type:"warning"});case 3:return t.next=5,this.$store.dispatch("api",{url:b.deleteAccount+"/"+this.id});case 5:if(e=t.sent,e){t.next=8;break}return t.abrupt("return");case 8:this.$alert("成功删除账号："+this.account.name),delete this.$store.state.accounts[this.id],this.$router.replace("/"),t.next=15;break;case 13:t.prev=13,t.t0=t["catch"](0);case 15:case"end":return t.stop()}},t,this,[[0,13]])}));function e(){return t.apply(this,arguments)}return e}(),get_code_finish:function(){console.log("code有效，重新读取"),this.load()}},beforeMount:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.load();case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},P=N,I=(n("ac79"),Object(l["a"])(P,S,R,!1,null,"32c15955",null)),B=I.exports;a["default"].use(o["a"]);var L=new o["a"]({routes:[{path:"/",component:f,meta:{title:"首页"}},{name:"add",path:"/add",component:C,meta:{title:"添加新的OneDrive账号"},props:!0},{name:"edit",path:"/edit/:id",component:B,meta:{title:"账号信息"}}]}),H=(n("8615"),n("2f62")),z=n("bc3a");a["default"].use(H["a"]);var G=new H["a"].Store({state:{accounts:{},error:null,isMobile:document.body.clientWidth<700,labelPosition:document.body.clientWidth<700?"top":"right"},mutations:{setAccounts:function(t,e){t.accounts=e},updateDefaultAccount:function(t,e){Object.values(t.accounts).forEach(function(t){t.default=t.id===e})},setError:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"错误";t.error={title:n,content:e.data}}},actions:{api:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(e,n){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,z(n);case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t["catch"](0),e.commit("setError",t.t0.response),t.abrupt("return",null);case 10:case"end":return t.stop()}},t,null,[[0,6]])}));function e(e,n){return t.apply(this,arguments)}return e}()}}),U=n("5c96"),J=n.n(U),F=(n("0fae"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-container",{staticClass:"top-container"},[n("div",{staticClass:"left-menu",class:{hidden:t.hideMenu}},[n("el-aside",{attrs:{width:"200px"}},[n("div",{staticClass:"title"},[n("el-button",{attrs:{circle:"",size:"mini",icon:"el-icon-s-home",title:"首页"},on:{click:function(e){return t.open("/")}}}),t._v("\n                账号列表\n                "),n("el-button",{attrs:{title:"添加账号",type:"text",size:"mini",icon:"el-icon-plus"},nativeOn:{click:function(e){return t.open({name:"add"})}}})],1),t._l(t.accounts,function(e,r){return n("div",{key:r,staticClass:"item",class:{"el-button--text":e.id===t.openID},on:{click:function(e){return t.open({name:"edit",params:{id:r}})}}},[e.default?[t._v("*")]:t._e(),t._v("\n                "+t._s(e.name)+"\n                "),e.has_token?t._e():[t._v("(未完成)")]],2)})],2)],1),n("el-container",[n("el-header",[t.$store.state.isMobile?n("div",{directives:[{name:"show",rawName:"v-show",value:t.routerHeader,expression:"routerHeader"}],staticClass:"show-menu-button",on:{click:function(e){t.hideMenu=!1}}},[n("i",{staticClass:"el-icon-s-unfold"})]):t._e(),t._v("\n            "+t._s(t.routerHeader)+"\n        ")]),n("el-main",[n("router-view")],1)],1)],1)}),V=[],W={name:"App",data:function(){return{hideMenu:!1,routerHeader:"",openID:null}},watch:{$route:"updateHeader","$store.state.error":"watchError"},computed:{accounts:function(){return this.$store.state.accounts}},methods:{updateHeader:function(){this.$route.meta.title?this.routerHeader=this.$route.meta.title:this.routerHeader=null,"edit"===this.$route.name&&(this.openID=this.$route.params.id)},watchError:function(){var t=this.$store.state.error;t&&this.$alert(t.content,"⚠️"+t.title,{dangerouslyUseHTMLString:!0})},open:function(t){"edit"===t.name&&(this.openID=t.id),this.$router.push(t),this.hideMenu=!0}},beforeMount:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("api",{url:b.accountsList});case 2:e=t.sent,this.$store.commit("setAccounts",e.data);case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),mounted:function(){var t=this;this.updateHeader();var e=[document.querySelector(".left-menu"),document.querySelector(".left-menu .el-aside")];this.$store.state.isMobile&&document.querySelector(".left-menu").addEventListener("click",function(n){-1!==e.indexOf(n.target)&&(t.hideMenu=!0)})}},K=W,Y=(n("f19a"),n("277e"),Object(l["a"])(K,F,V,!1,null,"296e08d9",null)),Z=Y.exports;a["default"].use(J.a),a["default"].config.productionTip=!1,a["default"].prototype.$http=n("bc3a"),new a["default"]({render:function(t){return t(Z)},router:L,store:G}).$mount("#app")},ac79:function(t,e,n){"use strict";var r=n("32aa"),a=n.n(r);a.a},d49f:function(t,e,n){},f19a:function(t,e,n){"use strict";var r=n("d49f"),a=n.n(r);a.a}});