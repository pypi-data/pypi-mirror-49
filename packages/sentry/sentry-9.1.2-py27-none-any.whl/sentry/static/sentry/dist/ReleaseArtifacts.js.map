{"version":3,"sources":["webpack:///./app/views/releases/detail/shared/releaseArtifacts.jsx"],"names":["ReleaseArtifacts","_this","_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0___default","this","_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2___default","_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3___default","call","fetchData","setState","loading","error","props","api","request","getFilesEndpoint","method","data","lodash_omit__WEBPACK_IMPORTED_MODULE_5___default","location","query","Object","values","URL_PARAM","success","_","jqXHR","fileList","pageLinks","getResponseHeader","state","_this$props$params","params","orgId","projectId","version","encodedVersion","encodeURIComponent","concat","id","_this2","loadingIndicator","IndicatorStore","add","t","filter","file","duration","complete","remove","_this3","react__WEBPACK_IMPORTED_MODULE_8___default","a","createElement","app_components_loadingIndicator__WEBPACK_IMPORTED_MODULE_17__","app_components_loadingError__WEBPACK_IMPORTED_MODULE_16__","onRetry","length","app_components_panels__WEBPACK_IMPORTED_MODULE_9__","app_components_emptyStateWarning__WEBPACK_IMPORTED_MODULE_12__","access","Set","organization","grid_emotion__WEBPACK_IMPORTED_MODULE_6__","flex","pr","map","key","style","wordWrap","wordBreak","name","dist","className","justify","app_components_fileSize__WEBPACK_IMPORTED_MODULE_13__","bytes","size","align","has","href","baseUrl","app_components_tooltip__WEBPACK_IMPORTED_MODULE_20__","title","marginLeft","app_components_linkWithConfirmation__WEBPACK_IMPORTED_MODULE_15__","message","onConfirm","handleRemove","bind","app_components_pagination__WEBPACK_IMPORTED_MODULE_18__","React","Component","propTypes","SentryTypes","Organization","PropTypes","object","withOrganization","withApi"],"mappings":"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","file":"ReleaseArtifacts.js","sourcesContent":["import {Flex} from 'grid-emotion';\nimport {omit} from 'lodash';\nimport PropTypes from 'prop-types';\nimport React from 'react';\n\nimport {Panel, PanelHeader, PanelBody, PanelItem} from 'app/components/panels';\nimport {URL_PARAM} from 'app/components/organizations/globalSelectionHeader/constants';\nimport {t} from 'app/locale';\nimport EmptyStateWarning from 'app/components/emptyStateWarning';\nimport FileSize from 'app/components/fileSize';\nimport IndicatorStore from 'app/stores/indicatorStore';\nimport LinkWithConfirmation from 'app/components/linkWithConfirmation';\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport Pagination from 'app/components/pagination';\nimport SentryTypes from 'app/sentryTypes';\nimport Tooltip from 'app/components/tooltip';\nimport withApi from 'app/utils/withApi';\nimport withOrganization from 'app/utils/withOrganization';\n\nclass ReleaseArtifacts extends React.Component {\n  static propTypes = {\n    organization: SentryTypes.Organization,\n    api: PropTypes.object,\n  };\n\n  constructor() {\n    super();\n    this.state = {\n      loading: true,\n      error: false,\n      fileList: [],\n      pageLinks: null,\n    };\n  }\n\n  componentDidMount() {\n    this.fetchData();\n  }\n\n  getFilesEndpoint() {\n    const {orgId, projectId, version} = this.props.params;\n    const encodedVersion = encodeURIComponent(version);\n\n    return projectId\n      ? `/projects/${orgId}/${projectId}/releases/${encodedVersion}/files/`\n      : `/organizations/${orgId}/releases/${encodedVersion}/files/`;\n  }\n\n  fetchData = () => {\n    this.setState({\n      loading: true,\n      error: false,\n    });\n\n    this.props.api.request(this.getFilesEndpoint(), {\n      method: 'GET',\n      // We need to omit global selection header url params because they are not supported\n      data: omit(this.props.location.query, Object.values(URL_PARAM)),\n      success: (data, _, jqXHR) => {\n        this.setState({\n          error: false,\n          loading: false,\n          fileList: data,\n          pageLinks: jqXHR.getResponseHeader('Link'),\n        });\n      },\n      error: () => {\n        this.setState({\n          error: true,\n          loading: false,\n        });\n      },\n    });\n  };\n\n  handleRemove(id) {\n    const loadingIndicator = IndicatorStore.add(t('Removing artifact..'));\n\n    this.props.api.request(this.getFilesEndpoint() + `${id}/`, {\n      method: 'DELETE',\n      success: () => {\n        const fileList = this.state.fileList.filter(file => {\n          return file.id !== id;\n        });\n\n        this.setState({\n          fileList,\n        });\n\n        IndicatorStore.add(t('Artifact removed.'), 'success', {\n          duration: 4000,\n        });\n      },\n      error: () => {\n        IndicatorStore.add(t('Unable to remove artifact. Please try again.'), 'error', {\n          duration: 4000,\n        });\n      },\n      complete: () => {\n        IndicatorStore.remove(loadingIndicator);\n      },\n    });\n  }\n\n  render() {\n    if (this.state.loading) {\n      return <LoadingIndicator />;\n    } else if (this.state.error) {\n      return <LoadingError onRetry={this.fetchData} />;\n    } else if (this.state.fileList.length === 0) {\n      return (\n        <Panel>\n          <EmptyStateWarning>\n            <p>{t('There are no artifacts uploaded for this release.')}</p>\n          </EmptyStateWarning>\n        </Panel>\n      );\n    }\n\n    const access = new Set(this.props.organization.access);\n\n    // TODO(dcramer): files should allow you to download them\n    return (\n      <div>\n        <Panel>\n          <PanelHeader>\n            <Flex flex=\"7\" pr={2}>\n              {t('Name')}\n            </Flex>\n            <Flex flex=\"2\">{t('Distribution')}</Flex>\n            <Flex flex=\"3\">{t('Size')}</Flex>\n          </PanelHeader>\n          <PanelBody>\n            {this.state.fileList.map(file => {\n              return (\n                <PanelItem key={file.id}>\n                  <Flex\n                    flex=\"7\"\n                    pr={2}\n                    style={{wordWrap: 'break-word', wordBreak: 'break-all'}}\n                  >\n                    <strong>{file.name || '(empty)'}</strong>\n                  </Flex>\n                  <Flex flex=\"2\">\n                    {file.dist || <span className=\"text-light\">{t('None')}</span>}\n                  </Flex>\n                  <Flex flex=\"3\" justify=\"space-between\">\n                    <FileSize bytes={file.size} />\n                    <Flex align=\"center\">\n                      {access.has('project:write') ? (\n                        <a\n                          href={\n                            this.props.api.baseUrl +\n                            this.getFilesEndpoint() +\n                            `${file.id}/?download=1`\n                          }\n                          className=\"btn btn-sm btn-default\"\n                        >\n                          <span className=\"icon icon-open\" />\n                        </a>\n                      ) : (\n                        <Tooltip\n                          title={t(\n                            'You do not have the required permission to download this artifact.'\n                          )}\n                        >\n                          <div className=\"btn btn-sm btn-default disabled\">\n                            <span className=\"icon icon-open\" />\n                          </div>\n                        </Tooltip>\n                      )}\n                      <div style={{marginLeft: 5}}>\n                        <LinkWithConfirmation\n                          className=\"btn btn-sm btn-default\"\n                          title={t('Delete artifact')}\n                          message={t('Are you sure you want to remove this artifact?')}\n                          onConfirm={this.handleRemove.bind(this, file.id)}\n                        >\n                          <span className=\"icon icon-trash\" />\n                        </LinkWithConfirmation>\n                      </div>\n                    </Flex>\n                  </Flex>\n                </PanelItem>\n              );\n            })}\n          </PanelBody>\n        </Panel>\n        <Pagination pageLinks={this.state.pageLinks} />\n      </div>\n    );\n  }\n}\n\nexport {ReleaseArtifacts};\nexport default withOrganization(withApi(ReleaseArtifacts));\n"],"sourceRoot":""}