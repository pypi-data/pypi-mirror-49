
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Traversal &#8212; flatland 0.9.1.dev3+g27237b1.d20190726 documentation</title>
    <link rel="stylesheet" href="../_static/flatland.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Annotations &amp; Properties" href="properties.html" />
    <link rel="prev" title="Elements" href="schema.html" /> 
  </head><body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="traversal">
<h1>Traversal<a class="headerlink" href="#traversal" title="Permalink to this headline">¶</a></h1>
<p>Flatland supplies a rich set of tools for working with structured data.  For
this section, we’ll use the following schema as an example.  It is simple yet
has a bit of variety in its structure.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flatland</span> <span class="k">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Integer</span>

<span class="k">class</span> <span class="nc">Annotation</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A spot on a 2D surface.&quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">Dict</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">Integer</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">),</span>
                       <span class="n">Integer</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>

<span class="n">sample_data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Interesting Spot&#39;</span><span class="p">,</span>
  <span class="s1">&#39;flags&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
<span class="p">}</span>

<span class="n">ann1</span> <span class="o">=</span> <span class="n">Annotation</span><span class="p">(</span><span class="n">sample_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;ann1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="going-raw">
<h2>Going Raw<a class="headerlink" href="#going-raw" title="Permalink to this headline">¶</a></h2>
<p>You may not even need to use any of these traversal strategies in your
application.  An element’s <a class="reference internal" href="schema.html#flatland.schema.base.Element.value" title="flatland.schema.base.Element.value"><code class="xref py py-attr docutils literal notranslate"><span class="pre">value</span></code></a> is a full &amp; recursive
“export” of its native Python value.  Many times this is sufficient.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>     <span class="c1"># ann1 is a flatland structure</span>
<span class="go">&lt;String u&#39;title&#39;; value=u&#39;Interesting Spot&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ann1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>  <span class="c1"># but its .value is not</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">sample_data</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="python-syntax">
<h2>Python Syntax<a class="headerlink" href="#python-syntax" title="Permalink to this headline">¶</a></h2>
<p>Containers elements such as <code class="xref py py-class docutils literal notranslate"><span class="pre">Form</span></code>, <a class="reference internal" href="dicts.html#flatland.schema.containers.Dict" title="flatland.schema.containers.Dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>,
and <a class="reference internal" href="lists.html#flatland.schema.containers.List" title="flatland.schema.containers.List"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a> implement the Python methods you’d expect for
their type.  In most cases you may use them as if they were <code class="docutils literal notranslate"><span class="pre">dict</span></code> and
<code class="docutils literal notranslate"><span class="pre">list</span></code> instances- the difference being that they always contain
<a class="reference internal" href="schema.html#flatland.schema.base.Element" title="flatland.schema.base.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> instances.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">Form</span></code> and <code class="docutils literal notranslate"><span class="pre">Dict</span></code> can be indexed and used like <code class="docutils literal notranslate"><span class="pre">dict</span></code>:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="go">u&#39;Interesting Spot&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(u&#39;x&#39;, &lt;Integer u&#39;x&#39;; value=10&gt;), (u&#39;y&#39;, &lt;Integer u&#39;y&#39;; value=20&gt;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">u</span><span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">ann1</span>
<span class="go">True</span>
</pre></div>
</div>
<p>And <code class="docutils literal notranslate"><span class="pre">List</span></code> and similar types can be used like lists:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span>
<span class="go">[&lt;Integer None; value=1&gt;, &lt;Integer None; value=3&gt;, &lt;Integer None; value=5&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="go">[1, 3, 5]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Integer</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">3</span> <span class="ow">in</span> <span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The final example is of special note: the value in the expression is not an
<code class="docutils literal notranslate"><span class="pre">Element</span></code>.  Most containers will accept native Python values in these types
of expressions and convert them into a temporary <code class="docutils literal notranslate"><span class="pre">Element</span></code> for the
operation.  The example below is equivalent to the example above.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">member_schema</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="traversal-properties">
<h2>Traversal Properties<a class="headerlink" href="#traversal-properties" title="Permalink to this headline">¶</a></h2>
<p>Elements of all types support a core set of properties that allow navigation
to related elements: <a class="reference internal" href="schema.html#flatland.schema.base.Element.root" title="flatland.schema.base.Element.root"><code class="xref py py-attr docutils literal notranslate"><span class="pre">root</span></code></a>,
<a class="reference internal" href="schema.html#flatland.schema.base.Element.parents" title="flatland.schema.base.Element.parents"><code class="xref py py-attr docutils literal notranslate"><span class="pre">parents</span></code></a>, <a class="reference internal" href="schema.html#flatland.schema.base.Element.children" title="flatland.schema.base.Element.children"><code class="xref py py-attr docutils literal notranslate"><span class="pre">children</span></code></a>, and
<a class="reference internal" href="schema.html#flatland.schema.base.Element.all_children" title="flatland.schema.base.Element.all_children"><code class="xref py py-attr docutils literal notranslate"><span class="pre">all_children</span></code></a>.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=1&gt;, &lt;Integer None; value=3&gt;, &lt;Integer None; value=5&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>  <span class="c1"># title is a String and has no children</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">ann1</span><span class="o">.</span><span class="n">all_children</span> <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="go">[u&#39;flags&#39;, u&#39;location&#39;, u&#39;title&#39;, u&#39;x&#39;, u&#39;y&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parents</span><span class="p">]</span>
<span class="go">[u&#39;location&#39;, u&#39;ann1&#39;]</span>
</pre></div>
</div>
<p>Each of these properties (excepting <code class="docutils literal notranslate"><span class="pre">root</span></code>) returns an iterator of
elements.</p>
</div>
<div class="section" id="path-lookups">
<span id="id1"></span><h2>Path Lookups<a class="headerlink" href="#path-lookups" title="Permalink to this headline">¶</a></h2>
<p>Another option for operating on elements is the <a class="reference internal" href="schema.html#flatland.schema.base.Element.find" title="flatland.schema.base.Element.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code></a>
method.  <code class="docutils literal notranslate"><span class="pre">find</span></code> selects elements by <em>path</em>, a string that represents one or
more related elements.  Looking up elements by path is a powerful technique to
use when authoring flexible &amp; reusable validators.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>   <span class="c1"># find &#39;ann1&#39;s child named &#39;title&#39;</span>
<span class="go">[&lt;String u&#39;title&#39;; value=u&#39;Interesting Spot&#39;&gt;]</span>
</pre></div>
</div>
<p>Paths are evaluated relative to the element:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer u&#39;x&#39;; value=10&gt;]</span>
</pre></div>
</div>
<p>Referencing parents is possible with <code class="docutils literal notranslate"><span class="pre">..</span></code>:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;../../title&#39;</span><span class="p">)</span>
<span class="go">[&lt;String u&#39;title&#39;; value=u&#39;Interesting Spot&#39;&gt;]</span>
</pre></div>
</div>
<p>Absolute paths begin with a <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/title&#39;</span><span class="p">)</span>
<span class="go">[&lt;String u&#39;title&#39;; value=u&#39;Interesting Spot&#39;&gt;]</span>
</pre></div>
</div>
<p>Members of sequences can be selected like any other child (their index number
is their name), or you can use Python-like slicing:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/flags/0&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=1&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/flags[0]&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=1&gt;]</span>
</pre></div>
</div>
<p>Full Python slice notation is supported as well.  With slices, paths can
select more than one element.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/flags[:]&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=1&gt;, &lt;Integer None; value=3&gt;, &lt;Integer None; value=5&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ann1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/flags[1:]&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer None; value=3&gt;, &lt;Integer None; value=5&gt;]</span>
</pre></div>
</div>
<p>Further path operations are permissible after slices.  A richer schema is
needed to illustrate this:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Points</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">List</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">Dict</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">Integer</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">),</span>
<span class="gp">... </span>                                 <span class="n">Integer</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">))))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Points</span><span class="p">([[</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)],</span>
<span class="gp">... </span>            <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;[:][:]/x&#39;</span><span class="p">)</span>
<span class="go">[&lt;Integer u&#39;x&#39;; value=1&gt;, &lt;Integer u&#39;x&#39;; value=2&gt;, &lt;Integer u&#39;x&#39;; value=3&gt;]</span>
</pre></div>
</div>
<p>The equivalent straight Python to select the same set of elements is quite a
bit more wordy.</p>
<div class="section" id="path-syntax">
<h3>Path Syntax<a class="headerlink" href="#path-syntax" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">/</span></code> (leading slash)</dt><dd><p>Selects the root of the element tree</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">element</span></code></dt><dd><p>The name of a child element</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">element/child</span></code></dt><dd><p><code class="docutils literal notranslate"><span class="pre">/</span></code> separates path segments</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">..</span></code></dt><dd><p>Traverse to the parent element</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">element[0]</span></code></dt><dd><p>For a sequence container element, select the 0th child</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">element[:]</span></code></dt><dd><p>Select all children of a container element (need not be a sequence)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">element[1:5]</span></code></dt><dd><p>Select a slice of a sequence container’s children</p>
</dd>
</dl>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/flatland.png" alt="Logo"/>
            </a></p>
  <h3>Contents</h3>
  <ul>
    <li><ul>
<li><a class="reference internal" href="#">Traversal</a><ul>
<li><a class="reference internal" href="#going-raw">Going Raw</a></li>
<li><a class="reference internal" href="#python-syntax">Python Syntax</a></li>
<li><a class="reference internal" href="#traversal-properties">Traversal Properties</a></li>
<li><a class="reference internal" href="#path-lookups">Path Lookups</a><ul>
<li><a class="reference internal" href="#path-syntax">Path Syntax</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
  </ul>
<h3>Topics</h3>
<ul>
  <li><ul>
  <li><a href="index.html">Defining and Using Forms</a><ul>
      <li>Previous: <a href="schema.html" title="previous chapter">Elements</a></li>
      <li>Next: <a href="properties.html" title="next chapter">Annotations &amp; Properties</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2018, the flatland authors and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>