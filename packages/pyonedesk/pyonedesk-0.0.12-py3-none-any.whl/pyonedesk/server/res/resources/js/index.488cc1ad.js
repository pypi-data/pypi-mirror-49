(function(e){function t(t){for(var i,s,o=t[0],c=t[1],l=t[2],d=0,f=[];d<o.length;d++)s=o[d],r[s]&&f.push(r[s][0]),r[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(f.length)f.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(i=!1)}i&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},r={index:0},a=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("df31")},"0011":function(e,t,n){"use strict";var i=n("9707"),r=n.n(i);r.a},"01bd":function(e,t,n){"use strict";var i=n("b954"),r=n.n(i);r.a},"0372":function(e,t,n){"use strict";var i=n("18e4"),r=n.n(i);r.a},"06bf":function(e,t,n){},"18e4":function(e,t,n){},"1f7a":function(e,t,n){"use strict";var i=n("b38b"),r=n.n(i);r.a},2744:function(e,t,n){"use strict";var i=n("3729"),r=n.n(i);r.a},3729:function(e,t,n){},4230:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i="/admin/api",r={accountsList:i+"/accounts",createAccountID:i+"/account/create_id",addAccount:i+"/accounts/add",addAccountName:i+"/accounts/add",deleteAccount:i+"/accounts/delete",account:i+"/account",goCreateAppUrl:i+"/go_create_app",goGetCode:i+"/go_get_code",stylizes:i+"/stylizes",uploadFile:i+"/upload"}},"5b32":function(e,t,n){"use strict";var i=n("7294"),r=n.n(i);r.a},6114:function(e,t,n){"use strict";var i=n("e0a2"),r=n.n(i);r.a},7294:function(e,t,n){},8121:function(e,t,n){"use strict";var i=n("dab2"),r=n.n(i);r.a},9707:function(e,t,n){},b38b:function(e,t,n){},b954:function(e,t,n){},cd75:function(e,t,n){"use strict";var i=n("06bf"),r=n.n(i);r.a},d4b2:function(e,t,n){},dab2:function(e,t,n){},df31:function(e,t,n){"use strict";n.r(t);n("14c6"),n("08c1"),n("4842"),n("d9fc");var i=n("a026"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"desktop full"},[e._l(e.users,function(e){return n("user-icon",{key:e.id,attrs:{user:e}})}),e._l(e.windows,function(e){return n("window",{key:e.id,attrs:{id:e.id,user:e.user,file:e.file,z:e.z,uploads:e.uploads}})}),n("contextmenu",{attrs:{x:e.menu.x,y:e.menu.y,file:e.menu.file,id:e.menu.id},model:{value:e.menu.show,callback:function(t){e.$set(e.menu,"show",t)},expression:"menu.show"}})],2)},a=[],s=(n("7f7f"),n("96cf"),n("3b8d")),o="",c={accounts:o+"/accounts",loadFile:o+"/path"},l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"window",class:{active:e.$store.state.activeID===e.id,dragging:e.dragging},style:{"z-index":e.z},attrs:{tabindex:e.z},on:{focus:e.focus,blur:e.blur}},[n("div",{staticClass:"window--head"},[n("div",{staticClass:"name"},[e._v(" "+e._s(e.current.name))]),n("div",{staticClass:"controller",staticStyle:{"margin-right":"10px"}},[n("svg",{staticClass:"icon",class:{disabled:e.loading},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.load(!0)}}},[n("use",{attrs:{"xlink:href":"#py_shuaxin"}})]),n("svg",{staticClass:"icon",class:{disabled:e.loading||e.historyIndex<=0},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.go()}}},[n("use",{attrs:{"xlink:href":"#py_houtui"}})]),n("svg",{staticClass:"icon",class:{disabled:e.loading||e.historyIndex>=e.history.length-1},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.go(1)}}},[n("use",{attrs:{"xlink:href":"#py_qianjin"}})])]),n("div",{staticClass:"controller"},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"},on:{click:e.close}},[n("use",{attrs:{"xlink:href":"#py_guanbi"}})])])]),n("div",{staticClass:"window--path"},[n("div",{staticClass:"path"},[e._v("\n            路径："+e._s(e.user.name)+e._s(e.current.path)+"\n        ")]),!1===e.loading&&e.showFolder?n("div",{staticClass:"controller"},[n("div",{on:{click:function(t){return e.upload("file")}}},[n("svg",{staticClass:"icon",class:{disabled:e.loading},attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan1"}})]),e._v("\n                文件\n            ")]),n("div",{on:{click:function(t){return e.upload("folder")}}},[n("svg",{staticClass:"icon",class:{disabled:e.loading},attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan1"}})]),e._v("\n                文件夹\n            ")])]):e._e()]),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.dragging,expression:"!dragging"}],staticClass:"window--body",class:{loading:e.loading}},[e.loading?n("window-loading"):e._e(),[e.showFolder?[n("window-folder",{ref:"content",attrs:{user:e.user,id:e.id,file:e.current},on:{open:e.open,loadFinish:e.loadFinish}})]:e.showEditor?[n("window-editor",{ref:"content",attrs:{user:e.user,file:e.current},on:{loadFinish:e.loadFinish}})]:e.showViewer?[n("window-viewer",{ref:"content",attrs:{user:e.user,file:e.current},on:{loadFinish:e.loadFinish}})]:e.showPlayer?[n("window-player",{ref:"content",attrs:{user:e.user,file:e.current},on:{loadFinish:e.loadFinish}})]:e._e()]],2)])},u=[],d=(n("7514"),n("c5f6"),n("d225")),f=(n("ac4d"),n("8a81"),n("0d6d"),Object.freeze({Normal:Symbol("normal"),Image:Symbol("image"),Audio:Symbol("audio"),Video:Symbol("video"),Text:Symbol("text"),Code:Symbol("code"),Word:Symbol("word"),Excel:Symbol("excel"),PPT:Symbol("ppt"),Zip:Symbol("zip"),Folder:Symbol("folder"),PDF:Symbol("pdf")})),h=Object.freeze({Normal:Symbol("normal"),Uploading:Symbol("uploading"),Waiting:Symbol("waiting"),Deleting:Symbol("deleting")}),p=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],m=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],v=["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"],g=["application/zip","application/x-7z-compressed","application/x-rar-compressed","application/x-tar","application/x-bzip","application/x-bzip2"];function w(e,t){for(var n=0;n<t.length;n++)if(-1!==e.lastIndexOf(t[n]))return!0;return!1}var b=[".py",".cs",".c",".htm",".js",".xml",".php",".jsp",".rb",".pl",".asp",".ini",".cg",".java",".as",".config",".hh",".hs",".css",".scss",".sass"],x=function e(t,n,i,r){Object(d["a"])(this,e),this.name=t,this.mimeType=i,this.state=h.Normal,i?-1!==i.indexOf("image/")?this.type=f.Image:-1!==i.indexOf("audio/")?this.type=f.Audio:-1!==i.indexOf("video/")?this.type=f.Video:w(t,b)?this.type=f.Code:-1!==p.indexOf(i)?this.type=f.Word:-1!==m.indexOf(i)?this.type=f.Excel:-1!==v.indexOf(i)?this.type=f.PPT:-1!==g.indexOf(i)?this.type=f.Zip:this.type="text/plain"===i?f.Text:"application/pdf"===i?f.PDF:f.Normal:this.type=f.Folder,this.path=n,this.thumbnail=r},y=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(d["a"])(this,e),this.id=t,this.name=n,this.lock=i},k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-editor-container"},[n("div",{staticClass:"text-editor"}),n("div",{staticClass:"saving",class:{show:e.saving}},[e._v("保存中")])])},_=[],C=(n("4917"),n("6b54"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")}),O=[],F={name:"window-base-content",data:function(){return{loading:!1}},methods:{load:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]&&n[0],!this.loading){e.next=3;break}return e.abrupt("return");case 3:if(this.loading=!0,!this.loadContent){e.next=7;break}return e.next=7,this.loadContent(t);case 7:this.loading=!1,this.$emit("loadFinish");case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.load()}},j=F,I=n("2877"),U=Object(I["a"])(j,C,O,!1,null,"05f4ddb7",null),E=U.exports,S={extends:E,name:"window-editor",props:["id","user","file"],data:function(){return{$cm:null,saving:!1}},methods:{loadContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,a,s,o,c,l,u,d=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]&&d[0],n=":"+this.file.path,e.next=4,this.$store.dispatch("load",{force:t,user:this.user,path:n});case 4:return i=e.sent,r=i.data,e.next=8,this.$http.get(r["@microsoft.graph.downloadUrl"]);case 8:a=e.sent,s=a.data,this.$cm.setValue(s.toString()),o=this.file.name.match(/.+\.([^.]+)$/),console.log("editor 1",o),o&&(u=CodeMirror.findModeByExtension(o[1]),u&&(c=u.mode,l=u.mime)),console.log("editor 2",c,l),c?(this.$cm.setOption("mode",l),CodeMirror.autoLoadMode(this.$cm,c)):this.$cm.setOption("mode","text/plain");case 16:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),save:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.loading&&!this.saving){e.next=2;break}return e.abrupt("return");case 2:return this.saving=!0,e.next=5,this.$http({method:"post",url:"/admin/api/upload/"+this.user.id,params:{path:this.file.path,type:"text"},data:this.$cm.getValue()});case 5:this.saving=!1;case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){CodeMirror.modeURL="https://cdn.bootcss.com/codemirror/5.48.0/mode/%N/%N.js",this.$cm=CodeMirror(this.$el.querySelector(".text-editor"),{lineNumbers:!0,extraKeys:{"Ctrl-S":this.save,"Cmd-S":this.save}})}},R=S,z=(n("0372"),Object(I["a"])(R,k,_,!1,null,null,null)),W=z.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image-viewer"},[e.loading?e._e():n("img",{attrs:{src:e.src,alt:"图片"}})])},D=[],L={extends:E,name:"window-viewer",props:["user","file"],data:function(){return{src:""}},methods:{loadContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,i,r,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=":"+this.file.path,e.next=3,this.$store.dispatch("load",{user:this.user,path:n,force:t});case 3:return i=e.sent,r=i.data,this.src=r["@microsoft.graph.downloadUrl"],a=new Image,a.src=this.src,e.next=10,new Promise(function(e){a.addEventListener("load",function(){e()}),setTimeout(function(){e()},1e4)});case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}},T=L,N=(n("2744"),Object(I["a"])(T,P,D,!1,null,"1916bc7c",null)),A=N.exports,M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"player"})},V=[],B={extends:E,name:"window-player",props:["user","file"],data:function(){return{}},methods:{loadContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("player mounted"),n=":".concat(this.file.path),e.next=4,this.$store.dispatch("load",{user:this.user,path:n,force:t});case 4:i=e.sent,r=i.data,console.log("player",n,r),new DPlayer({container:this.$el,video:{url:r["@microsoft.graph.downloadUrl"]}});case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},mounted:function(){this.load()}},X=B,Y=(n("1f7a"),Object(I["a"])(X,M,V,!1,null,"66043b1f",null)),Z=Y.exports,q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"folder-container",on:{dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),e.dropFile(t)}}},[n("div",{staticClass:"folder"},e._l(e.files,function(t,i){return n("file-icon",{key:i,attrs:{file:t,id:e.id},on:{dblclick:e.open}})}),1),e.uploading.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("上传中")]),n("div",{staticClass:"folder"},e._l(e.uploading,function(t,i){return n("file-icon",{key:i,attrs:{file:t,id:e.id}})}),1)]):e._e(),e.waiting.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("等候上传")]),n("div",{staticClass:"folder"},e._l(e.waiting,function(t,i){return n("file-icon",{key:i,attrs:{file:t,id:e.id},on:{cancelUpload:e.cancelUpload}})}),1)]):e._e(),n("input",{ref:"fileInput",staticClass:"hidden-file-input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:e.selectUploadFiles}})])},G=[],J=(n("f386"),n("ac6a"),n("75fc")),H=n("df7c"),K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"file",on:{dblclick:e.open,contextmenu:function(t){return t.preventDefault(),e.contextmenu(t)},click:e.cancelUpload}},[n("div",{staticClass:"file-icon",class:{uploading:e.isUploading||e.isWaiting}},[e.image?n("img",{attrs:{src:e.file.thumbnail}}):n("svg",{staticClass:"icon file-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+e.icon}})]),!1===e.isNormal?n("div",{staticClass:"state-icon-container"},[e.isUploading?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan"}})]),n("div",[e._v("上传中")])]):e.isWaiting?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_yuyue-lishi-shijian"}})]),n("div",[e._v("等待上传")])]):e._e()]):e._e()]),n("div",{staticClass:"file-name"},[e._v(e._s(e.file.name))]),n("div",{staticClass:"file-name-full"},[e._v(e._s(e.file.name))])])},Q=[],ee={props:{id:String,file:x},data:function(){return{image:null}},computed:{icon:function(){switch(this.file.type){case f.Folder:return Icons["folder"];case f.Audio:return Icons["audio"];case f.Video:return Icons["video"];case f.Image:return Icons["image"];case f.Text:return Icons["text"];case f.Zip:return Icons["zip"];case f.PDF:return Icons["pdf"];case f.Word:return Icons["word"];case f.Excel:return Icons["excel"];case f.PPT:return Icons["ppt"];case f.Code:return Icons["code"];default:return Icons["default"]}},isNormal:function(){return this.file.state===h.Normal},isUploading:function(){return this.file.state===h.Uploading},isWaiting:function(){return this.file.state===h.Waiting}},methods:{open:function(){this.file.state===h.Normal&&this.$emit("dblclick",this.file)},contextmenu:function(e){(this.isWaiting||this.isUploading)&&this.$store.commit("appendMenuItem",{name:"取消上传",click:this.cancelUpload}),this.$store.commit("contextmenu",{e:e,id:this.id,file:this.file})},cancelUpload:function(){if(!this.isNormal&&!this.isUploading&&confirm("取消上传 ".concat(this.file.name," ?"))){var e=this.$store.state.windows[this.id].user;this.$store.commit("cancelUploadByFile",{user:e,file:this.file})}}},mounted:function(){var e=this;if(this.file.type===f.Image){var t=new Image;t.src=this.file.thumbnail,t.addEventListener("load",function(){e.image=e.file.thumbnail})}}},te=ee,ne=(n("6114"),Object(I["a"])(te,K,Q,!1,null,"16d80419",null)),ie=ne.exports,re=n("b0b4"),ae=Object.freeze({FileUploaded:Symbol("uploaded"),FileDeleted:Symbol("deleted")}),se=function(){function e(t,n,i){Object(d["a"])(this,e),this.id=Date.now().toString(32),this.user=t,this.file=n,this.z=i,this.events={}}return Object(re["a"])(e,[{key:"addEventListener",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(this.events[e]){var n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}},{key:"trigger",value:function(e,t){this.events[e]&&this.events[e].forEach(function(e){return e(t)})}},{key:"clearEventListener",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?this.events[e]=[]:this.events={}}}]),e}();function oe(e,t){return ce.apply(this,arguments)}function ce(){return ce=Object(s["a"])(regeneratorRuntime.mark(function e(t,n){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=n||"",i=[],!t.isFile){e.next=7;break}return e.next=5,new Promise(function(e){t.file(function(t){var r=new x(t.name,n+t.name,t.type);r.file=t,i.push(r),e()})});case 5:e.next=10;break;case 7:if(!t.isDirectory){e.next=10;break}return e.next=10,new Promise(function(e){t.createReader().readEntries(function(){var r=Object(s["a"])(regeneratorRuntime.mark(function r(a){var s;return regeneratorRuntime.wrap(function(r){while(1)switch(r.prev=r.next){case 0:s=0;case 1:if(!(s<a.length)){r.next=13;break}return r.t0=i.push,r.t1=i,r.t2=J["a"],r.next=7,oe(a[s],n+t.name+"/");case 7:r.t3=r.sent,r.t4=(0,r.t2)(r.t3),r.t0.apply.call(r.t0,r.t1,r.t4);case 10:s++,r.next=1;break;case 13:e();case 14:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())});case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}},e)})),ce.apply(this,arguments)}var le={extends:E,name:"window-folder",components:{FileIcon:ie},props:["id","user","file"],data:function(){return{loading:!1,files:[]}},watch:{file:function(){this.load()}},computed:{uploading:function(){return this.$store.getters.getUploading(this.user,this.file.path)},waiting:function(){return this.$store.getters.getUploading(this.user,this.file.path,h.Waiting)}},methods:{click_upload:function(e){var t=this.$refs.fileInput;"folder"===e?(t.setAttribute("webkitdirectory",""),t.setAttribute("directory","")):(t.removeAttribute("webkitdirectory"),t.removeAttribute("directory")),this.$refs.fileInput.click()},selectUploadFiles:function(e){for(var t="/"===this.file.path?this.file.path:this.file.path+"/",n=e.target.files,i=0;i<n.length;i++){var r=n[i];console.log("input file",r);var a=new x(r.name,t+r.webkitRelativePath+r.name,r.type);a.file=r,this.$store.commit("addUploadFile",{id:this.id,user:this.user,path:this.file.path,file:a})}},dropFile:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,i,r,a,s,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n="/"===this.file.path?this.file.path:this.file.path+"/",i=t.dataTransfer.items,r=[],a=0;case 3:if(!(a<i.length)){e.next=17;break}if(s=i[a].webkitGetAsEntry(),!s){e.next=14;break}return e.t0=r.push,e.t1=r,e.t2=J["a"],e.next=11,oe(s);case 11:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 14:a++,e.next=3;break;case 17:console.log("拖拽文件",i.length,r.length),r.forEach(function(e){e.path=n+e.path,o.$store.commit("addUploadFile",{id:o.id,user:o.user,path:o.file.path,file:e})});case 19:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),open:function(e){this.$emit("open",e)},loadContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,a=this,s=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]&&s[0],n="","/"!==this.file.path&&(n=":".concat(this.file.path,":")),n+="/children?expand=thumbnails",e.next=6,this.$store.dispatch("load",{user:this.user,path:n,force:t});case 6:i=e.sent,r=i.data,this.files=r.value.map(function(e){var t=Object(H["join"])(a.file.path,e.name),n=e.file?e.file.mimeType:null,i=new x(e.name,t,n);return i.type===f.Image&&(i.thumbnail=e.thumbnails[0]["small"]["url"]),i});case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),cancelUpload:function(e){this.$store.commit("cancelUploadFile",{user:this.user,path:this.file.path,file:e})},removeFile:function(e){var t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)},fileUploaded:function(e){this.files.push(e)}},mounted:function(){this.$store.state.windows[this.id].addEventListener(ae.FileUploaded,this.fileUploaded),this.$store.state.windows[this.id].addEventListener(ae.FileDeleted,this.removeFile)},destroyed:function(){this.$store.state.windows[this.id].removeEventListener(ae.FileUploaded,this.fileUploaded),this.$store.state.windows[this.id].removeEventListener(ae.FileDeleted,this.removeFile)}},ue=le,de=(n("cd75"),Object(I["a"])(ue,q,G,!1,null,"bdcfa6c4",null)),fe=de.exports,he=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"loading"},[e._v("\n    读取中\n")])},pe=[],me={name:"window-loading"},ve=me,ge=(n("01bd"),Object(I["a"])(ve,he,pe,!1,null,"09339c0c",null)),we=ge.exports,be={components:{WindowLoading:we,WindowFolder:fe,WindowPlayer:Z,WindowViewer:A,WindowEditor:W},props:{id:String,user:y,file:x,z:Number},data:function(){return{loading:!1,dragging:!1,zIndex:0,active:!0,history:[],historyIndex:0}},methods:{upload:function(e){!1===this.loading&&this.$refs["content"].click_upload&&this.$refs["content"].click_upload(e)},close:function(){this.$store.commit("closeWindow",this.id)},focus:function(){this.$store.state.activeID!==this.id&&this.$store.commit("windowSetTop",this.id)},blur:function(){},loadFinish:function(){this.loading=!1},load:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n=this,i=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]&&i[0],this.loading=!0,this.$nextTick(function(){n.$refs["content"].load(t)});case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),open:function(e){this.loading||(this.history.splice(this.historyIndex+1),this.append(e),this.historyIndex++,this.load())},go:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(!this.loading){var t=this.historyIndex+e;t>=0&&t<this.history.length&&(this.historyIndex+=e)}},append:function(e){this.history.push(e)}},computed:{current:function(){return this.history[this.historyIndex]},showFolder:function(){return this.current.type===f.Folder},showPlayer:function(){return-1!==[f.Video,f.Audio].indexOf(this.current.type)},showEditor:function(){return-1!==[f.Code,f.Text].indexOf(this.current.type)},showViewer:function(){return-1!==[f.Image].indexOf(this.current.type)}},beforeMount:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.append(this.file),e.next=3,this.load();case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),watch:{},mounted:function(){var e=this,t=$(this.$el),n=t.find(".window--head");t.mousedown(function(){e.focus()}).draggable({handle:n,cancel:".controller",start:function(){e.focus(),e.dragging=!0},stop:function(){e.dragging=!1}}).resizable({minHeight:150,minWidth:200,start:function(){},stop:function(){e.dragging=!1}})}},xe=be,ye=(n("0011"),Object(I["a"])(xe,l,u,!1,null,"2b4c2ff2",null)),ke=ye.exports,_e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user",on:{dblclick:e.open}},[n("div",{staticClass:"user-icon"},[n("svg",{staticClass:"icon main-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+e.icon}})]),e.user.lock?n("svg",{staticClass:"icon lock-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_lock"}})]):e._e()]),n("div",{staticClass:"user-name"},[e._v(e._s(e.user.name))])])},Ce=[],$e={props:{user:y},data:function(){return{icon:Icons["user"]}},methods:{open:function(){this.$store.commit("createWindow",{user:this.user,file:new x("/","/"),active:!0})}}},Oe=$e,Fe=(n("5b32"),Object(I["a"])(Oe,_e,Ce,!1,null,"5cab2d21",null)),je=Fe.exports,Ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.value?n("div",{staticClass:"contextmenu full",style:{"z-index":e.$store.state.z},on:{click:e.hide,contextmenu:function(t){return t.preventDefault(),e.hide(t)}}},[n("div",{staticClass:"contextmenu-list",style:{left:e.offsetX,top:e.offsetY}},e._l(e.list,function(t,i){return n("div",{key:i,on:{click:t.click}},[e._v(e._s(t.name))])}),0)]):e._e()},Ue=[],Ee={name:"contextmenu",props:["value","x","y","id","file"],data:function(){return{list:[]}},methods:{hide:function(){this.$emit("input",!1),this.$store.state.menuExtraItems.length=0}},computed:{offsetX:function(){return this.x+2+"px"},offsetY:function(){return this.y+2+"px"}},watch:{file:function(){var e,t=this;this.list.length=0,this.file.state===h.Normal&&([f.Folder,f.Text,f.Code,f.Image,f.Video,f.Audio].indexOf(this.file.type)>-1&&this.list.push({name:"新窗口打开",click:function(){t.$store.commit("createWindowFromMenu",{file:t.file})}}),this.file.type!==f.Folder&&this.list.push({name:"下载文件",click:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:alert("下载文件");case 1:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()}),this.list.push({name:"删除文件",click:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var n,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(confirm("确认删除文件 ".concat(t.file.name," ?"))){e.next=2;break}return e.abrupt("return");case 2:return n=t.$store.state.windows[t.id],i=n.user,e.next=6,t.$http({method:"delete",url:"/admin/api/"+i.id+"?path="+t.file.path});case 6:r=e.sent,200===r.status&&n.trigger(ae.FileDeleted,t.file);case 8:case"end":return e.stop()}},e)}));function n(){return e.apply(this,arguments)}return n}()})),(e=this.list).push.apply(e,Object(J["a"])(this.$store.state.menuExtraItems))}}},Se=Ee,Re=(n("f3ed"),Object(I["a"])(Se,Ie,Ue,!1,null,"e277a8d8",null)),ze=Re.exports,We={components:{Contextmenu:ze,UserIcon:je,Window:ke},data:function(){return{defaultProps:{children:"children",label:"label"},users:[]}},computed:{windows:function(){return this.$store.state.windows},menu:function(){return this.$store.state.menu}},methods:{},beforeMount:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("api",{url:c.accounts});case 2:for(n in t=e.sent,this.users.length=0,t.data)i=t.data[n],r=new y(i.id,i.name),this.users.push(r);window.addEventListener("beforeunload",function(e){if(a.$store.state.uploadingLength>0){var t="\\o/";return(e||window.event).returnValue=t,t}});case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},Pe=We,De=(n("8121"),Object(I["a"])(Pe,r,a,!1,null,"46d01d6d",null)),Le=De.exports,Te=(n("8615"),n("2f62")),Ne=n("4230"),Ae=n("2ef0"),Me=n("17d4"),Ve=n.n(Me),Be=n("bc3a");i["default"].use(Te["a"]);var Xe=Ve()(function(e,t){var n=e.user,i=e.file,r=new FormData,a=Ne["a"].uploadFile+"/"+n.id+"?type=file&path="+i.path;i.state=h.Uploading,r.append("file",i.file),Be({method:"post",url:a,data:r,headers:{"Content-Type":"multipart/form-data"}}).then(function(e){console.log("SUCCESS!!",e),t&&t()}).catch(function(){console.log("FAILURE!!"),t&&t()})},1),Ye=new Te["a"].Store({state:{z:1,windows:{},menu:{show:!1,x:0,y:0,id:null,file:null},menuExtraItems:[],activeID:null,error:null,cache:{},uploading:{},uploadingLength:0},getters:{getUploading:function(e){return function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.Uploading;return console.log("getters getUploading",t,n,i),e.uploading[t.id]&&e.uploading[t.id][n]?e.uploading[t.id][n].filter(function(e){return e.state===i}):[]}}},mutations:{setError:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"错误";e.error={title:n,content:t.data}},setCache:function(e,t){var n=t.url,i=t.res;e.cache[n]=i},createWindow:function(e,t){var n=t.user,r=t.file,a=t.active,s=void 0!==a&&a;console.log("createWindow");var o=new se(n,r,e.z);i["default"].set(e.windows,o.id,o),e.z++,s&&(e.activeID=o.id)},createWindowFromMenu:function(e,t){var n=t.file;this.commit("createWindow",{user:e.windows[e.menu.id].user,file:n,active:!0})},contextmenu:function(e,t){var n=t.e,i=t.id,r=t.file;console.log("右键",n,i,r),e.menu.show=!0,e.menu.x=n.clientX,e.menu.y=n.clientY,e.menu.file=r,e.menu.id=i},appendMenuItem:function(e,t){var n=t.name,i=t.click;e.menuExtraItems.push({name:n,click:i})},clearWindow:function(e){e.windows={}},closeWindow:function(e,t){e.windows[t].clearEventListener(),i["default"].delete(e.windows,t)},windowSetTop:function(e,t){e.activeID=t,e.windows[t].z=e.z;var n=Object(Ae["sortBy"])(e.windows,"z");n.forEach(function(e){var t=n.indexOf(e);e.z=t+1}),e.z=n.length+1},addUploadFile:function(e,t){var n=t.id,r=t.user,a=t.path,s=t.file;e.uploading[r.id]||i["default"].set(e.uploading,r.id,{}),e.uploading[r.id][a]||i["default"].set(e.uploading[r.id],a,[]),e.uploading[r.id][a].push(s),s.state=h.Waiting,e.uploadingLength++,Xe.push({user:r,file:s},function(){console.log("上传完成",s.path),e.uploadingLength--,s.state=h.Normal,e.windows[n].trigger(ae.FileUploaded,s)})},cancelUploadFile:function(e,t){var n=t.user,i=t.path,r=t.file;if(e.uploading[n.id]&&e.uploading[n.id][i]){var a=e.uploading[n.id][i].indexOf(r);a>-1&&(e.uploading[n.id][i].splice(a,1),e.uploadingLength--)}},cancelUploadByFile:function(e,t){var n=t.user,i=t.file;if(e.uploading[n.id])for(var r=Object.values(e.uploading[n.id]),a=0;a<r.length;a++){var s=r[a].indexOf(i);if(s>-1){r[a].splice(s,1);break}}}},actions:{api:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Be(n);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e["catch"](0),t.commit("setError",e.t0.response),e.abrupt("return",null);case 10:case"end":return e.stop()}},e,null,[[0,6]])}));function t(t,n){return e.apply(this,arguments)}return t}(),load:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t,n){var i,r,a,s,o,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=n.user,r=n.path,a=n.force,s=void 0!==a&&a,o=c.loadFile+"/"+i.id+"?path="+r,console.log("load",o,s),!t.state.cache[o]||s){e.next=5;break}return e.abrupt("return",t.state.cache[o]);case 5:return e.next=7,Be.get(o);case 7:return l=e.sent,200===l.status&&t.commit("setCache",{url:o,res:l}),e.abrupt("return",l);case 10:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}()}});n("e008");i["default"].config.productionTip=!1,i["default"].prototype.$http=n("bc3a"),new i["default"]({store:Ye,render:function(e){return e(Le)}}).$mount("#app")},e008:function(e,t,n){},e0a2:function(e,t,n){},f3ed:function(e,t,n){"use strict";var i=n("d4b2"),r=n.n(i);r.a}});