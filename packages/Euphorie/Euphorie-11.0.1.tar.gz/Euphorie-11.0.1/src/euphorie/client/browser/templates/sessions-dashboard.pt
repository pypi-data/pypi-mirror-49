<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:meta="http://xml.zope.org/namespaces/meta"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="context/@@shell/macros/shell"
      i18n:domain="euphorie"
>
  <metal:slot fill-slot="content"
    tal:define="language view/portal/plone_portal_state/language;
                my_sessions view/get_ordered_sessions;">
  <tal:block replace="tile:statusmessages" />
  <div id="content-pane">
    <article id="screen-intro">
      <h1>
        OiRA
      </h1>
      <p class="byline">
        ${view/tool_byline}
      </p>
    </article>
    <div class="row pat-masonry"
         id="dashboard"
         data-pat-masonry="column-width: .grid-sizer; gutter: 0; item-selector: .portlet; stamp: .stamp;"
    >
      <div class="grid-sizer"></div>

      <div class="portlet span-3" tal:condition="python:len(my_sessions)>0">
        <div class="content">
          <h2 class="portlet-title"
              i18n:translate=""
          >My risk assessments</h2>
          <article>
          <p i18n:translate="info_select_session">Select an earlier session to complete or review or
            <a href="${webhelpers/session_overview_url}/new-session.html#document-content"
               i18n:name="start_session"
               i18n:translate="link_start_session"
               class="pat-modal icon-plus-circle">start a new session</a>.
          </p>
        </article>
          <ul class="ras">
            <li tal:repeat="session my_sessions"
              class="ra">

              <a href="${request/getURL}?action=continue&amp;session=${session/id}"
                class="pat-inject follow"
                data-pat-inject="source: #content; target: #content; &amp;&amp; source: #osc; target: #osc; history: record"
              >
                <h4 class="name field">${session/title}</h4>
                <p class="date field">
                  <span class="last-saved">
                    <tal:i18n i18n:translate="">Last saved</tal:i18n>
                    <time class="pat-display-time"
                        datetime="${value}"
                        data-pat-display-time="from-now: true; locale: ${language}"
                        tal:define="value session/modified/isoformat|nothing;"
                    >${value}</time>
                  </span>
                </p>
              </a>

              <a class="more-menu iconified icon-ellipsis pat-tooltip inactive"
                 href="${here/absolute_url}/@@more_menu?sessionid=${session/id}#more-menu"
                 data-pat-tooltip="source: ajax; position-list: tr"
                 i18n:translate=""
              >More</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="portlet span-3">
        <div class="content">
          <h2 class="portlet-title"
              i18n:translate=""
          >
            Available OiRA tools
          </h2>
          <form class="pat-inject"
                action="${here/absolute_url}/@@new-session.html"
          >
            <article class="pat-rich">
              <p i18n:translate="label_select_new_session">
                Start a new session by choosing one of the following sectoral tools.
              </p>
            </article>

            <fieldset class="tool-list">
              <fieldset class="department">
                <fieldset class="tools pat-checklist radio">
                  <label class="tool"
                         tal:repeat="survey view/surveys"
                  >
                    <input name="survey"
                           type="radio"
                           value="${survey/id}"
                    />
                    <strong class="field name">${survey/title}</strong>
                  </label>
                </fieldset>
              </fieldset>
            </fieldset>

            <p class="button-bar">
              <button class="small pat-button pat-depends"
                      type="submit"
                      data-pat-depends="condition: survey; action: enable"
                      i18n:translate="button_start_session"
              >Start session</button>
            </p>

            <input name="action"
                   type="hidden"
                   value="new"
            />
          </form>
        </div>
      </div>

    </div>
    </div>

  </metal:slot>

  <metal:slot fill-slot="splash_message_slot">
    <div class="splash-message" id="splash-message">
    <tal:splash condition="python:splash_message is not None">
      <hr class="trigger pat-switch"
          data-pat-switch="selector: body; remove: splash-on-motd*; add: splash-off-${splash_message/id}; store: local"
      />
      <article class="pat-rich content">
        <p>
          <img src="${base_url}/++resource++euphorie.media/oira-logo-colour.svg"
               width="20%"
          />
        </p>
        <h1 tal:content="structure splash_message/title">Message of the day!</h1>
        <tal:content content="structure splash_message/text" />
      </article>
    </tal:splash>
    </div>
  </metal:slot>

    <metal:slot fill-slot="aside-header">
      <header id="osc-header">
          <tal:if condition="python:is_anonymous and webhelpers.allow_guest_accounts">
              <a tal:condition="is_outside_of_survey" href="${base_url}/new-session-test.html?${came_from_param}#document-content" id="button-new-session"
                  data-pat-modal="class: large" class="pat-modal icon-plus-circle" i18n:attributes="title " title="Start test session" i18n:translate="">Start test session</a>
              <a tal:condition="not:is_outside_of_survey" href="${base_url}/@@tryout?${came_from_param}#document-content" title="Start a new test session" id="button-new-session" class="icon-plus-circle" i18n:translate="">Start test session</a>
          </tal:if>

          <tal:if condition="not:is_anonymous">
              <tal:if condition="not:is_outside_of_survey">
                  <a href="${webhelpers/country_url}/session-browser-sidebar?groupid=${webhelpers/get_session_group_id}&zodb_path=${webhelpers/survey_zodb_path}"
                     data-pat-inject="source: #osc-header; target: #osc-header && source: #osc; target: #osc"
                     class="back-button pat-inject">Back</a>
              </tal:if>
              <a href="${webhelpers/session_overview_url}/new-session.html#document-content" id="button-new-session-quick"
                  data-pat-modal="class: large" class="no-label pat-modal iconified icon-plus-circle" title="Start a new session" i18n:attributes="title link_start_session" i18n:translate="New">New</a>
          </tal:if>
      </header>
    </metal:slot>


</html>
