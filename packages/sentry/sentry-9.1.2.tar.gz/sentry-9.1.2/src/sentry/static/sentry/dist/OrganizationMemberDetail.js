(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{2305:function(e,t,a){"use strict";a.r(t);var n=a(12),r=a.n(n),i=a(4),l=a.n(i),o=a(6),s=a.n(o),c=a(7),m=a.n(c),u=a(5),d=a.n(u),b=a(8),f=a.n(b),h=a(28),v=a(10),g=a(0),p=a.n(g),E=a(261),O=a(39),y=a(2),j=a(153),w=a(24),S=a(110),N=a(190),R=a(479),z=a(30),I=a(394),k=a(25),T=a(392),A=a(9),C=a(99),x=a(615),B=a(29),M=a(187),q=a(754),P=Object(y.t)("Not enrolled in two-factor authentication"),L=Object(y.t)("You do not have permission to perform this action"),F=Object(y.t)("Cannot be reset since two-factor is required for this organization"),J=Object(y.t)("Cannot be reset since user is in more than one organization"),G=function(e){function t(){var e,a;l()(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=m()(this,(e=d()(t)).call.apply(e,[this].concat(i)))).handleSave=function(){var e=a.getOrganization().slug,t=a.props.params,n=z.default.add("Saving...");a.setState({busy:!0}),Object(E.d)(a.api,{orgId:e,memberId:t.memberId,data:a.state.member}).then(function(){z.default.addSuccess("Saved"),a.redirectToMemberPage()}).catch(function(){return z.default.addError("Could not save...")}).then(function(){z.default.remove(n),a.setState({busy:!1})})},a.handleInvite=function(e){var t=a.getOrganization().slug,n=a.props.params,i=z.default.add("Sending invite...");a.setState({busy:!0}),Object(E.c)(a.api,{orgId:t,memberId:n.memberId,regenerate:e}).then(function(t){z.default.add("Sent invite!","success",{duration:5e3}),e&&a.setState(function(e){return{member:r()({},e.member,t)}})}).catch(function(){return z.default.add("Could not send invite","error",{duration:5e3})}).then(function(){z.default.remove(i),a.setState({busy:!1})})},a.handleAddTeam=function(e){var t=a.state.member;t.teams.includes(e.slug)||t.teams.push(e.slug),a.setState({member:t})},a.handleRemoveTeam=function(e){var t=a.state.member;a.setState({member:r()({},t,{teams:t.teams.filter(function(t){return t!==e})})})},a.handle2faReset=function(){var e=a.state.member.user,t=a.getOrganization().slug,n=e.authenticators.map(function(t){return Object(T.c)(a.api,e.id,t.id)});Promise.all(n).then(function(){a.props.router.push("/settings/".concat(t,"/members/")),Object(O.addSuccessMessage)(Object(y.t)("All authenticators have been removed"))}).catch(function(e){Object(O.addErrorMessage)(Object(y.t)("Error removing authenticators")),h.captureException(e)})},a.showResetButton=function(){var e=a.state.member,t=a.getOrganization().require2FA,n=e.user;return!(!n||!n.authenticators||t)&&(n.authenticators.length>=1&&n.canReset2fa)},a.getTooltip=function(){var e=a.state.member,t=a.getOrganization().require2FA,n=e.user;return n?n.authenticators?n.authenticators.length?n.canReset2fa?t?F:"":J:P:L:""},a.state=r()({},a.state,{roleList:[],selectedRole:"",member:null}),a}return f()(t,e),s()(t,[{key:"getEndpoints",value:function(){var e=this.getOrganization().slug,t=this.props.params;return[["member","/organizations/".concat(e,"/members/").concat(t.memberId,"/")]]}},{key:"getOrganization",value:function(){return this.context.organization}},{key:"redirectToMemberPage",value:function(){var e=Object(M.a)("members/",{routes:this.props.routes,params:this.props.params,stepBack:-2});v.browserHistory.push(e)}},{key:"renderBody",value:function(){var e=this,t=this.state,a=t.error,n=t.member,i=this.getOrganization(),l=i.access;if(!n)return p.a.createElement(I.a,null);var o=n.invite_link,s=l.includes("org:write"),c=n.email,m=!n.expired,u=!n.pending;return p.a.createElement("div",null,p.a.createElement(C.default,{title:p.a.createElement("div",null,p.a.createElement("div",{style:{fontSize:"1.4em"}},n.name),p.a.createElement("div",null,p.a.createElement("small",{style:{opacity:.6,fontSize:"0.8em",fontWeight:"normal"}},Object(y.t)("Member Settings"))))}),a&&a.role&&p.a.createElement("p",{className:"error alert-error"},a.role),p.a.createElement(k.a,null,p.a.createElement(k.e,null,Object(y.t)("Basics")),p.a.createElement(k.c,null,p.a.createElement(k.f,{direction:"column"},p.a.createElement("div",{className:"row",style:{width:"100%"}},p.a.createElement("div",{className:"col-md-6"},p.a.createElement("div",{className:"control-group"},p.a.createElement("label",null,Object(y.t)("Email")),p.a.createElement("div",{className:"controls"},p.a.createElement("a",{href:"mailto:".concat(c)},c)))),p.a.createElement("div",{className:"col-md-3"},p.a.createElement("div",{className:"control-group"},p.a.createElement("label",null,Object(y.t)("Status")),p.a.createElement("div",{className:"controls","data-test-id":"member-status"},n.expired?p.a.createElement("em",null,"Invitation Expired"):n.pending?p.a.createElement("em",null,"Invitation Pending"):"Active"))),p.a.createElement("div",{className:"col-md-3"},p.a.createElement("div",{className:"control-group"},p.a.createElement("label",null,Object(y.t)("Added")),p.a.createElement("div",{className:"controls"},p.a.createElement(N.default,{dateOnly:!0,date:n.dateCreated}))))),o&&p.a.createElement("div",{className:"form-actions"},p.a.createElement("div",{className:"control-group"},p.a.createElement("label",null,Object(y.t)("Invite Link")),p.a.createElement("div",{className:"controls"},p.a.createElement("code",{className:"auto-select form-control",style:{overflow:"auto"}},o)),p.a.createElement("p",{className:"help-block"},"This unique invite link may only be used by this member.")),p.a.createElement("div",{className:"align-right"},p.a.createElement(w.default,{style:{marginRight:10},onClick:function(){return e.handleInvite(!0)}},Object(y.t)("Generate New Invite")),m&&p.a.createElement(w.default,{"data-test-id":"resend-invite",onClick:function(){return e.handleInvite(!1)}},Object(y.t)("Resend Invite"))))))),u&&p.a.createElement(k.a,null,p.a.createElement(k.e,null,Object(y.t)("Authentication")),p.a.createElement(k.c,null,p.a.createElement(R.default,{alignRight:!0,flexibleControlStateSize:!0,label:Object(y.t)("Reset two-factor authentication"),help:Object(y.t)("Resetting two-factor authentication will remove all two-factor authentication methods for this member.")},p.a.createElement(B.default,{"data-test-id":"reset-2fa-tooltip",disabled:this.showResetButton(),title:this.getTooltip()},p.a.createElement(S.default,{disabled:!this.showResetButton(),message:Object(y.tct)("Are you sure you want to disable all two-factor authentication methods for [name]?",{name:n.name?n.name:"this member"}),onConfirm:this.handle2faReset,"data-test-id":"reset-2fa-confirm"},p.a.createElement(w.default,{"data-test-id":"reset-2fa",priority:"danger"},Object(y.t)("Reset two-factor authentication"))))))),p.a.createElement(q.a,{enforceAllowed:!1,disabled:!s,roleList:n.roles,selectedRole:n.role,setRole:function(t){return e.setState({member:r()({},n,{role:t})})}}),p.a.createElement(x.a,{organization:i,selectedTeams:n.teams,disabled:!s,onAddTeam:this.handleAddTeam,onRemoveTeam:this.handleRemoveTeam}),p.a.createElement(w.default,{priority:"primary",busy:this.state.busy,className:"invite-member-submit",onClick:this.handleSave,disabled:!s},Object(y.t)("Save Member")))}}]),t}(j.default);G.contextTypes={organization:A.default.Organization},t.default=G}}]);
//# sourceMappingURL=OrganizationMemberDetail.js.map