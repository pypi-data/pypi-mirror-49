(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{1711:function(e,t){var a="Expected a function";e.exports=function(e){if("function"!=typeof e)throw new TypeError(a);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},2201:function(e,t,a){var n=a(224),r=a(1711),o=a(316);e.exports=function(e,t){return o(e,r(n(t)))}},2352:function(e,t,a){"use strict";a.r(t);var n=a(96),r=a.n(n),o=a(12),i=a.n(o),s=a(13),l=a.n(s),u=a(4),c=a.n(u),d=a(6),p=a.n(d),g=a(7),m=a.n(g),f=a(5),v=a.n(f),h=a(8),y=a.n(h),b=a(44),E=a.n(b),j=a(28),D=a(16),O=a(1),z=a.n(O),k=a(0),w=a.n(k),T=a(3),P=a(10),q=a(39),S=a(25),R=a(2),C=a(114),x=a(153),L=a(117),N=a(107),U=a(9),M=a(14),A=a(56),J=a(599),H=a(11),I=a.n(H),B=a(50),F=a.n(B),Z=a(1608),W=a(1864),X=a(1695),G=a(1680),K=a(1869),Q=a(63),V=a(381),Y=a(26),$=a.n(Y),_=a(31),ee=a.n(_),te=a(52),ae=a.n(te),ne=a(2201),re=a.n(ne),oe=1080;function ie(e,t){return!!e&&(!(t&&Object(M.parsePeriodToHours)(t)>oe)&&e)}var se=a(1733),le=function(e,t){var a=t.organization,n=t.project,r=t.environment,o=t.period,s=t.start,l=t.end,u=t.interval,c=t.includePrevious,d=(t.limit,t.query),p=ie(c,o),g={interval:u,project:n,environment:r,query:d},m=Object(se.a)({period:o,start:s,end:l},{shouldDoublePeriod:p});return e.requestPromise("".concat("/organizations/".concat(a.slug,"/events-stats/")),{query:i()({},g,m)})},ue=["api","children","organization","loading"],ce=function(e){return re()(e,function(e,t){return ue.includes(t)})},de=function(e){function t(e){var a;return c()(this,t),(a=m()(this,v()(t).call(this,e))).fetchData=ae()(ee.a.mark(function e(){var t,n,r,o;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.api,r=l()(t,["api"]),a.setState(function(e){return{reloading:null!==e.timeseriesData}}),e.prev=2,e.next=5,le(n,r);case 5:o=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),e.t0&&e.t0.responseJSON&&e.t0.responseJSON.detail?Object(q.addErrorMessage)(e.t0.responseJSON.detail):Object(q.addErrorMessage)(Object(R.t)("Error loading chart data")),o=null;case 12:if(!a.unmounting){e.next=14;break}return e.abrupt("return");case 14:a.setState({reloading:!1,timeseriesData:o});case 15:case"end":return e.stop()}},e,this,[[2,8]])})),a.getData=function(e){var t=a.props,n=t.period,r=t.includePrevious;if(!e)return{previous:null,current:null};var o=ie(r,n),i=Math.floor(e.length/2);return{previous:o?e.slice(0,i):null,current:o?e.slice(i):e}},a.calculateTotalsPerTimestamp=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 1e3*e};return e.map(function(e,a){var n=$()(e,2),r=n[0],o=n[1];return{name:t(r,o,a),value:o.reduce(function(e,t){return e+t.count},0)}})},a.transformPreviousPeriodData=function(e,t){return t?{seriesName:"Previous Period",data:a.calculateTotalsPerTimestamp(t,function(t,a,n){return 1e3*e[n][0]})}:null},a.transformAggregatedTimeseries=function(e,t){return e?{seriesName:t,data:a.calculateTotalsPerTimestamp(e)}:null},a.transformTimeseriesData=function(e){return[{seriesName:"Events",data:e.map(function(e){var t=$()(e,2);return{name:1e3*t[0],value:t[1].reduce(function(e,t){return e+t.count},0)}})}]},a.transformData=function(e){return e?a.transformTimeseriesData(e):null},a.state={reloading:e.loading,timeseriesData:null},a}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentDidUpdate",value:function(e){E()(ce(e),ce(this.props))||this.fetchData()}},{key:"componentWillUnmount",value:function(){this.unmounting=!0}},{key:"processData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,a=e.totals,n=this.props,r=n.includeTransformedData,o=n.includeTimeAggregation,i=n.timeAggregationSeriesName,s=this.getData(t),l=s.current,u=s.previous;return{data:r?this.transformData(l):null,allData:t,originalData:l,totals:a,originalPreviousData:u,previousData:r?this.transformPreviousPeriodData(l,u):null,timeAggregatedData:o?this.transformAggregatedTimeseries(l,i):null}}},{key:"render",value:function(){var e=this.props,t=e.children,a=e.showLoading,n=l()(e,["children","showLoading"]),r=this.state,o=r.timeseriesData,s=r.reloading,u=this.props.loading||null===o;if(a&&u)return w.a.createElement(G.b,{"data-test-id":"events-request-loading"});var c=o&&this.processData(o,!0)||{},d=c.data,p=c.allData,g=c.originalData,m=c.totals,f=c.originalPreviousData,v=c.previousData,h=c.timeAggregatedData;return t(i()({loading:u,reloading:s,timeseriesData:d,allTimeseriesData:p,originalTimeseriesData:g,timeseriesTotals:m,originalPreviousTimeseriesData:f,previousTimeseriesData:v,timeAggregatedData:h},n))}}]),t}(w.a.PureComponent);de.propTypes={api:z.a.object.isRequired,organization:U.default.Organization.isRequired,project:z.a.arrayOf(z.a.number),environment:z.a.arrayOf(z.a.string),period:z.a.string,start:z.a.instanceOf(Date),end:z.a.instanceOf(Date),interval:z.a.string,includePrevious:z.a.bool,limit:z.a.number,includeTransformedData:z.a.bool,includeTimeAggregation:z.a.bool,timeAggregationSeriesName:z.a.string,loading:z.a.bool,showLoading:z.a.bool},de.defaultProps={period:null,start:null,end:null,interval:"1d",limit:15,getCategory:function(e){return e},query:"",includePrevious:!0,includeTransformedData:!0};var pe,ge,me=de,fe=function(){return Object(R.t)("Events")},ve=function(e){function t(){return c()(this,t),m()(this,v()(t).apply(this,arguments))}return y()(t,e),p()(t,[{key:"shouldComponentUpdate",value:function(e){return!(e.reloading||!e.timeseriesData)&&(!E()(this.props.timeseriesData,e.timeseriesData)||!E()(this.props.releaseSeries,e.releaseSeries))}},{key:"render",value:function(){var e=this.props,t=(e.loading,e.reloading,e.releaseSeries),a=e.zoomRenderProps,n=e.timeseriesData,r=e.previousTimeseriesData,o=l()(e,["loading","reloading","releaseSeries","zoomRenderProps","timeseriesData","previousTimeseriesData"]);return w.a.createElement(X.a,I()({},o,a,{series:[].concat(F()(n),F()(t)),seriesOptions:{showSymbol:!1},previousPeriod:r?[r]:null,grid:{left:"30px",right:"18px"}}))}}]),t}(w.a.Component);ve.propTypes={loading:z.a.bool,reloading:z.a.bool,releaseSeries:z.a.array,zoomRenderProps:z.a.object,timeseriesData:z.a.array,previousTimeseriesData:z.a.object};var he=function(e){function t(){return c()(this,t),m()(this,v()(t).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.api,n=t.period,r=t.utc,o=t.query,i=t.router,s=l()(t,["api","period","utc","query","router"]);return w.a.createElement(W.a,I()({router:i,period:n,utc:r},s),function(t){t.interval;var i=l()(t,["interval"]);return w.a.createElement(me,I()({},s,{api:a,period:n,interval:Object(Z.a)(e.props,!0),showLoading:!1,query:o,getCategory:fe,includePrevious:!!n}),function(e){var t=e.loading,n=e.reloading,o=e.timeseriesData,s=e.previousTimeseriesData;return w.a.createElement(K.a,{utc:r,api:a},function(e){var a=e.releaseSeries;return t&&!n?w.a.createElement(G.b,{"data-test-id":"events-request-loading"}):w.a.createElement(w.a.Fragment,null,w.a.createElement(be,{visible:n}),w.a.createElement(ve,I()({},i,{loading:t,reloading:n,utc:r,releaseSeries:a,timeseriesData:o,previousTimeseriesData:s})))})})})}}]),t}(w.a.Component);he.propTypes={api:z.a.object,period:z.a.string,query:z.a.string,utc:z.a.bool,router:z.a.object};var ye=Object(V.a)(Object(Q.default)((ge=pe=function(e){function t(){return c()(this,t),m()(this,v()(t).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props,t=e.selection,a=l()(e,["selection"]),n=t.datetime,r=t.projects,o=t.environments;return w.a.createElement(he,I()({},n,{project:r||[],environment:o||[]},a))}}]),t}(w.a.Component),pe.propTypes={selection:U.default.GlobalSelection},ge))),be=Object(T.default)(G.a,{target:"e1pro75r0"})(function(e){return!e.visible&&"display: none;"}," opacity:0.4;z-index:1;"),Ee=a(190),je=a(145),De=a(154),Oe=a(33),ze=a(123),ke=a(15),we=function(e){function t(){return c()(this,t),m()(this,v()(t).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props,t=e.events,a=e.organization,n=e.utc,r=e.projectsMap;return t.map(function(e,t){var o=r.get(e.projectID),i=e.title||e.message.split("\n")[0].substr(0,100),s=new Set(a.features).has("sentry10"),l=s?"/organizations/".concat(a.slug,"/projects/").concat(o.slug,"/events/").concat(e.eventID,"/"):"/".concat(a.slug,"/").concat(o.slug,"/events/").concat(e.eventID,"/"),u=w.a.createElement(De.a,{project:o,avatarSize:16,displayName:w.a.createElement("span",null,o.slug),avatarProps:{consistentWidth:!0}});return w.a.createElement(Ce,{key:"".concat(o.slug,"-").concat(e.eventID),first:0==t},w.a.createElement(xe,null,w.a.createElement(Le,null,w.a.createElement(P.Link,{to:l},i))),w.a.createElement(xe,null,s?u:w.a.createElement(Ne,{to:"/".concat(a.slug,"/").concat(o.slug,"/")},u)),w.a.createElement(xe,null,w.a.createElement(De.a,{user:e.user,hideEmail:!0,avatarSize:16})),w.a.createElement(xe,null,w.a.createElement(Ue,{utc:n,date:new Date(e.dateCreated)})))})}}]),t}(w.a.PureComponent);we.propTypes={events:z.a.array,organization:U.default.Organization,utc:z.a.bool,projectsMap:z.a.object};var Te=function(e){function t(){return c()(this,t),m()(this,v()(t).apply(this,arguments))}return y()(t,e),p()(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.reloading!==e.reloading||this.props.zoomChanged!==e.zoomChanged||this.props.loading!==e.loading||(this.props.organization!==e.organization||this.props.events!==e.events)}},{key:"componentDidUpdate",value:function(e){this.props.onUpdateComplete&&e.zoomChanged&&this.props.reloading&&this.props.onUpdateComplete()}},{key:"render",value:function(){var e=this.props,t=e.events,a=e.organization,n=e.loading,r=e.reloading,o=e.zoomChanged,i=e.utc,s=t&&!!t.length;return w.a.createElement(S.a,null,w.a.createElement(S.e,null,w.a.createElement(Se,null,w.a.createElement("div",null,Object(R.t)("Event")),w.a.createElement("div",null,Object(R.t)("Project")),w.a.createElement("div",null,Object(R.t)("User")),w.a.createElement("div",null,Object(R.t)("Time")))),n&&w.a.createElement(Oe.default,null),!n&&!s&&w.a.createElement(je.a,null,w.a.createElement("p",null,"No events")),s&&w.a.createElement(qe,null,(r||o)&&w.a.createElement(Re,{overlay:!0}),w.a.createElement(we,{projectsMap:this.projectsMap,events:t,organization:a,utc:i})))}},{key:"projectsMap",get:function(){var e=this.props,t=e.organization,a=e.projects||t.projects;return new Map(a.map(function(e){return[e.id,e]}))}}]),t}(w.a.Component);Te.propTypes={loading:z.a.bool,reloading:z.a.bool,zoomChanged:z.a.bool,events:z.a.array,organization:U.default.Organization,projects:z.a.arrayOf(U.default.Project),utc:z.a.bool,onUpdateComplete:z.a.func};var Pe=Object(P.withRouter)(Te),qe=Object(T.default)(S.c,{target:"e1k5wers0"})("overflow-x:auto;padding:0;"),Se=Object(T.default)("div",{target:"e1k5wers1"})("display:grid;grid-template-columns:0.8fr 0.15fr 0.25fr 200px;grid-column-gap:",Object(ke.default)(1.5),";width:100%;"),Re=Object(T.default)(Oe.default,{target:"e1k5wers2"})("padding-top:10vh;z-index:1;&.loading.overlay{align-items:flex-start;}"),Ce=Object(T.default)(Se,{target:"e1k5wers3"})("font-size:",function(e){return e.theme.fontSizeMedium},";border-top:1px solid ",function(e){return e.first?"transparent":e.theme.borderLight},";align-items:center;padding:",Object(ke.default)(1)," ",Object(ke.default)(2),";"),xe=Object(T.default)("div",{target:"e1k5wers4"})("overflow:hidden;/* enables overflow-ellipsis on child container */"),Le=Object(T.default)(xe,{target:"e1k5wers5"})("padding-right:",Object(ke.default)(2),";",ze.a,";"),Ne=Object(T.default)(P.Link,{target:"e1k5wers6"})("display:flex;color:",function(e){return e.theme.gray4},";",ze.a,";"),Ue=Object(T.default)(Ee.default,{target:"e1k5wers7"})("color:",function(e){return e.theme.gray2},";",ze.a,";");a.d(t,"OrganizationEvents",function(){return Je}),a.d(t,"parseRowFromLinks",function(){return Me});var Me=function(e,t){if(!(e=M.default.parseLinkHeader(e)).previous.results)return"1-".concat(t);var a=(e.previous.cursor.split(":")[1]+e.next.cursor.split(":")[1])/2+1;return"".concat(a,"-").concat(a+t-1)},Ae=function(e){function t(){return c()(this,t),m()(this,v()(t).apply(this,arguments))}return y()(t,e),p()(t,[{key:"getEndpoints",value:function(){var e=this.props,t=e.organization,a=e.location.query,n=a.statsPeriod,r=l()(a,["statsPeriod"]);return[["eventsMeta","/organizations/".concat(t.slug,"/events-meta/"),{query:Object(J.a)(i()({statsPeriod:n},r))}]]}},{key:"onRequestError",value:function(e){j.captureException(new Error('Unable to fetch "total event count"'))}},{key:"renderError",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return null}},{key:"renderBody",value:function(){var e=this.state.eventsMeta,t=this.props,a=t.isAllResults,n=t.numRows,r=a?n:e.count;return Object(R.t)(" of ".concat(r.toLocaleString()).concat(a?"":" (estimated)"))}}]),t}(C.default);Ae.propTypes={organization:U.default.Organization.isRequired,location:z.a.object.isRequired,isAllResults:z.a.bool.isRequired,numRows:z.a.number.isRequired};var Je=function(e){function t(){var e,a;c()(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=m()(this,(e=v()(t)).call.apply(e,[this].concat(r)))).shouldReload=!0,a.handleZoom=function(){return a.setState({zoomed:!0})},a.handleTableUpdateComplete=function(){return a.setState({zoomed:!1})},a}return y()(t,e),p()(t,[{key:"shouldComponentUpdate",value:function(e,t){var a=this;return this.state!==t||!!["path","search"].find(function(t){return!E()(a.props.location[t],e.location[t])})}},{key:"getEndpoints",value:function(){var e=this.props,t=e.organization,a=e.location.query,n=a.statsPeriod,r=l()(a,["statsPeriod"]);return[["events","/organizations/".concat(t.slug,"/events/"),{query:Object(J.a)(i()({statsPeriod:n},r))}]]}},{key:"getTitle",value:function(){return"Events - ".concat(this.props.organization.slug)}},{key:"onRequestSuccess",value:function(e){var t=e.data,a=e.jqXHR,n=this.props.organization;if("1"===a.getResponseHeader("X-Sentry-Direct-Hit")){var r=t[0],o=n.projects.find(function(e){return e.id===r.projectID});P.browserHistory.replace("/organizations/".concat(n.slug,"/projects/").concat(o.slug,"/events/").concat(r.eventID,"/"))}}},{key:"onRequestError",value:function(e,t){e&&e.responseJSON&&e.responseJSON.detail&&Object(q.addErrorMessage)(e.responseJSON.detail)}},{key:"renderRowCounts",value:function(){var e=this.state,t=e.events,a=e.eventsPageLinks;return a?Me(a,t.length):null}},{key:"renderError",value:function(){return this.renderBody()}},{key:"renderLoading",value:function(){return this.renderBody()}},{key:"renderBody",value:function(){var e=this.props,a=e.organization,n=e.location,o=e.router,i=this.state,s=i.error,l=i.loading,u=i.reloading,c=i.events,d=i.eventsPageLinks,p=l||s||!d?{}:M.default.parseLinkHeader(d);return w.a.createElement(w.a.Fragment,null,s&&r()(v()(t.prototype),"renderError",this).call(this,new Error("Unable to load all required endpoints"),!1,!0),w.a.createElement(S.a,null,w.a.createElement(ye,{router:o,query:n.query.query,organization:a,onZoom:this.handleZoom})),w.a.createElement(Pe,{loading:!u&&l,reloading:u,zoomChanged:this.state.zoomed,events:c,organization:a,onUpdateComplete:this.handleTableUpdateComplete}),!l&&!u&&!s&&w.a.createElement(D.Flex,{align:"center",justify:"space-between"},w.a.createElement(He,null,c.length?Object(R.t)("Results ".concat(this.renderRowCounts())):Object(R.t)("No Results"),!!c.length&&d&&w.a.createElement(L.a,{features:["internal-catchall"]},w.a.createElement(Ae,{organization:a,location:n,isAllResults:!p.previous.results&&!p.next.results,numRows:c.length}))),w.a.createElement(N.default,{pageLinks:d,className:""})))}}]),t}(x.default);Je.propTypes={organization:U.default.Organization};var He=Object(T.default)("div",{target:"e141q4en0"})("color:",function(e){return e.theme.gray6},";");t.default=Object(A.a)(Je)}}]);
//# sourceMappingURL=OrganizationEvents.js.map